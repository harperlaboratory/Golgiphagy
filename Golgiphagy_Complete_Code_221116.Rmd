---
title: "Golgiphagy_Complete_Code"
author: "Ian Smith"
date: "11/16/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Golgiphagy

```{r}
library(tidyverse)
dplyr::filter
library(ggpubr)
library(pheatmap)
library(RColorBrewer)
library(cowplot)
library(ggrepel)
library(purrr)

'%!in%' <- function(x,y)!('%in%'(x,y))

```

## Figure 1 : Volcano and Rank plots

### Heeson's data figure 1

```{r}
fig1a_data<- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/fig1a_minAA_Torin_atg7ko_wt_HA.csv")

fig1a_data1<-fig1a_data %>%
  tidyr::gather("Compartment_Cond", "Value",1:12)%>%
  dplyr::filter(!is.na(Value))%>%
  dplyr::mutate(Condition = dplyr::if_else(stringr::str_detect(Compartment_Cond, "torin"),"Tor1","-AA"),
         Locale = dplyr::if_else(stringr::str_detect(Compartment_Cond,"ER"),"ER",dplyr::if_else(stringr::str_detect(Compartment_Cond,"Golgi"),"Golgi","Total")),
         CellLine= dplyr::if_else(stringr::str_detect(Compartment_Cond,"atg"),"ATG7 KO","WT"))

fig1a_data1$Condition<-factor(fig1a_data1$Condition, levels=c("-AA","Tor1"))
fig1a_data1$Locale<-factor(fig1a_data1$Locale, levels=c("Total","Golgi","ER"))
fig1a_data1$CellLine <- factor(fig1a_data1$CellLine , levels=c("WT","ATG7 KO"))

fig1a<-ggplot(fig1a_data1, aes(Locale,Value,group=Compartment_Cond,alpha=Condition, fill=CellLine))+
  geom_hline(yintercept = 0, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = 0.5, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = -0.5, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = 1, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = -1, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = 1.5, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = -1.5, linetype="dashed",alpha=0.3)+geom_violin(draw_quantiles = c(0.25,0.75),size=0.35)+geom_violin(draw_quantiles = c(0.5),size=1)+ylim(c(-1.5,1.5))+theme_classic()+scale_alpha_manual(values=c(0.15,0.35))+scale_fill_manual(values=c("purple4","lightblue"))+scale_y_continuous(breaks=c(-1,-0.5,0,0.5,1),limits=c(-1,1))+labs(x="",y="Log2(-AA or Tor1/UT)")+theme(axis.title = element_text(size = 18), axis.text=element_text(size=16), legend.title = element_blank())
#,width=0.90
fig1a
```


### Heeson supp fig1

```{r}
suppfig1a_data<- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/suppfig1a_organelle_minAA_compartment.csv")

suppfig1a_data1<-suppfig1a_data %>%
  tidyr::gather("Compartment_Cond", "Value",1:14)%>%
  dplyr::filter(!is.na(Value))%>%
  dplyr::mutate(Condition = dplyr::if_else(stringr::str_detect(Compartment_Cond, "torin"),"Tor1","-AA"),
         Locale = dplyr::if_else(stringr::str_detect(Compartment_Cond,"ER"),"ER",dplyr::if_else(stringr::str_detect(Compartment_Cond,"Golgi"),"Golgi",dplyr::if_else(stringr::str_detect(Compartment_Cond,"Mito"),"Mito",dplyr::if_else(stringr::str_detect(Compartment_Cond,"Endosome"),"Endosome",dplyr::if_else(stringr::str_detect(Compartment_Cond,"Lysosome"),"Lysosome",dplyr::if_else(stringr::str_detect(Compartment_Cond,"PM"),"PM","Nucleus")))))),
         CellLine= dplyr::if_else(stringr::str_detect(Compartment_Cond,"atg"),"ATG7 KO","WT"))

suppfig1a_data1$Condition<-factor(suppfig1a_data1$Condition, levels=c("-AA","Tor1"))
suppfig1a_data1$Locale<-factor(suppfig1a_data1$Locale, levels=c("Golgi","ER","Endosome","Lysosome","Mito","Nucleus","PM"))
suppfig1a_data1$CellLine <- factor(suppfig1a_data1$CellLine , levels=c("WT","ATG7 KO"))

suppfig1a_data1$Compartment_Cond <- factor(suppfig1a_data1$Compartment_Cond, levels=c("Golgi.control","Golgi.atg7ko","ER","ER.atg7ko" ,     "Endosome","Endosome.atg7ko", "Lysosome","Lysosome.atg7ko","Mito" , "Mito.atg7ko", "Nucleus","Nucleus.atg7ko","PM" ,"PM.atg7ko" ))


suppfig1a<-ggplot(suppfig1a_data1, aes(Locale,Value,group=Compartment_Cond, fill=CellLine))+
  geom_hline(yintercept = 0, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = 0.5, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = -0.5, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = 1, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = -1, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = 1.5, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = -1.5, linetype="dashed",alpha=0.3)+geom_violin(draw_quantiles = c(0.25,0.75),size=0.5,width=0.75,alpha=0.25)+geom_violin(draw_quantiles = c(0.5),size=1.25,width=0.75,alpha=0.25)+ylim(c(-1.5,1.5))+theme_classic()+scale_fill_manual(values=c("purple4","lightblue"))+scale_y_continuous(breaks=c(-1,-0.5,0,0.5,1),limits=c(-1,1))+labs(x="",y="Log2(-AA/UT)")+theme(axis.title = element_text(size = 18), axis.text=element_text(size=16), legend.title = element_blank())
suppfig1a
```



### Volcano plots

```{r}


# fig1_hela_data <- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/result_files/HeLa-18h-EBSS_secondrun_control_ATG7KO.csv")

fig1_hela_data <- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/HeLa-18h_EBSS.csv")

helalist<-c("NCOA4","CCPG1","TEX264","GABARAPL2", "MAP1LC3B2", "YIPF4", "YIPF3", "SQSTM1", "CALCOCO1")

helalist<-c("NCOA4","CCPG1","TEX264","GABARAPL2", "MAP1LC3B2", "YIPF4", "YIPF3", "SQSTM1", "CALCOCO1", "ULK1","WIPI2","TAX1BP1","SQSTM1","RB1CC1","GABARAP","ZFYVE1")



supp1c<-ggplot()+
  geom_vline(xintercept = -log2(1.5),linetype="dashed")+geom_vline(xintercept = log2(1.5),linetype="dashed")+geom_hline(yintercept = -log10(0.05),linetype="dashed")+
  geom_point(data= fig1_hela_data%>%dplyr::filter(Gene.Symbol %!in% helalist ), aes(log2FC_1_control_EBSS.0_control,-log10(q.val_1_control_EBSS.0_control)),alpha=0.1,size=2)+
  geom_point(data=fig1_hela_data %>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control,-log10(q.val_1_control_EBSS.0_control)),color = "black", shape=21,fill="lightblue",size=2)+
  geom_label_repel(data=fig1_hela_data%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control,-log10(q.val_1_control_EBSS.0_control),label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+
  # annotate(geom="text",label = "HeLa", x=-3,y=0.1,size=8)+
  theme_classic()+xlim(c(-4,4))+ylim(c(-0,2.5))+
  labs(x="WT Log2(18hr EBSS/UT)", y="-Log10(q-value)",title="HeLa")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))

supp1c

supp1e<-ggplot()+
  geom_vline(xintercept = -log2(1.5),linetype="dashed")+geom_vline(xintercept = log2(1.5),linetype="dashed")+geom_hline(yintercept = -log10(0.05),linetype="dashed")+
  geom_point(data= fig1_hela_data%>%dplyr::filter(Gene.Symbol %!in% helalist ), aes(log2FC_3_ATG7.KO_EBSS.2_ATG7.KO,-log10(q.val_3_ATG7.KO_EBSS.2_ATG7.KO)),alpha=0.1,size=2)+
  geom_point(data=fig1_hela_data %>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_3_ATG7.KO_EBSS.2_ATG7.KO,-log10(q.val_3_ATG7.KO_EBSS.2_ATG7.KO)),color = "black", shape=21,fill="lightblue",size=2)+
  geom_label_repel(data=fig1_hela_data%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_3_ATG7.KO_EBSS.2_ATG7.KO,-log10(q.val_3_ATG7.KO_EBSS.2_ATG7.KO),label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+
  # annotate(geom="text",label = "HeLa", x=-3,y=0.1,size=8)+
  theme_classic()+xlim(c(-4,4))+ylim(c(-0,2.5))+
  labs(x="ATG7-/- Log2(18hr EBSS/UT)", y="-Log10(q-value)",title="HeLa")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))
  
supp1e
```



```{r}

fig1_hek_data <- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/HEK293_12h_EBSS.csv")

heklist<-c("NCOA4","CCPG1","TEX264","GABARAPL2", "MAP1LC3B2", "YIPF4", "YIPF3", "SQSTM1", "CALCOCO1")

heklist<-c("NCOA4","CCPG1","TEX264","GABARAPL2", "MAP1LC3B2", "YIPF4", "YIPF3", "SQSTM1", "CALCOCO1", "ULK1","WIPI2","TAX1BP1","SQSTM1","RB1CC1","GABARAP","ZFYVE1")

supp1d<-ggplot()+
  geom_vline(xintercept = -log2(1.5),linetype="dashed")+geom_vline(xintercept = log2(1.5),linetype="dashed")+geom_hline(yintercept = -log10(0.05),linetype="dashed")+
  geom_point(data= fig1_hek_data%>%dplyr::filter(Gene.Symbol %!in% heklist ), aes(log2FC_1_control_EBSS.0_control,-log10(q.val_1_control_EBSS.0_control)),alpha=0.1,size=2)+
  geom_point(data=fig1_hek_data %>%dplyr::filter(Gene.Symbol %in% heklist ), aes(log2FC_1_control_EBSS.0_control,-log10(q.val_1_control_EBSS.0_control)),color = "black", shape=21,fill="lightblue",size=2)+
  geom_label_repel(data=fig1_hek_data%>%dplyr::filter(Gene.Symbol %in% heklist ), aes(log2FC_1_control_EBSS.0_control,-log10(q.val_1_control_EBSS.0_control),label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+
  # annotate(geom="text",label = "HeLa", x=-3,y=0.1,size=8)+
  theme_classic()+xlim(c(-4,4))+ylim(c(-0,2.5))+
  labs(x="WT Log2(12hr EBSS/UT)", y="-Log10(q-value)",title="HEK293")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))
supp1d


supp1f<-ggplot()+
  geom_vline(xintercept = -log2(1.5),linetype="dashed")+geom_vline(xintercept = log2(1.5),linetype="dashed")+geom_hline(yintercept = -log10(0.05),linetype="dashed")+
  geom_point(data= fig1_hek_data%>%dplyr::filter(Gene.Symbol %!in% heklist ), aes(log2FC_3_ATG7.KO_EBSS.2_ATG7.KO,-log10(q.val_3_ATG7.KO_EBSS.2_ATG7.KO)),alpha=0.1,size=2)+
  geom_point(data=fig1_hek_data %>%dplyr::filter(Gene.Symbol %in% heklist ), aes(log2FC_3_ATG7.KO_EBSS.2_ATG7.KO,-log10(q.val_3_ATG7.KO_EBSS.2_ATG7.KO)),color = "black", shape=21,fill="lightblue",size=2)+
  geom_label_repel(data=fig1_hek_data%>%dplyr::filter(Gene.Symbol %in% heklist ), aes(log2FC_3_ATG7.KO_EBSS.2_ATG7.KO,-log10(q.val_3_ATG7.KO_EBSS.2_ATG7.KO),label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+
  # annotate(geom="text",label = "HEK", x=-3,y=0.1,size=8)+
  theme_classic()+xlim(c(-4,4))+ylim(c(-0,2.5))+
  labs(x="ATG7-/- Log2(12hr EBSS/UT)", y="-Log10(q-value)",title="HEK293")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))
supp1f
```

### Starvation dependent fluxers HeLa

```{r}
fig1_hela_data_rankUse<-fig1_hela_data%>%
  dplyr::mutate(focus_quad = dplyr::if_else(log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control > 0,dplyr::if_else(log2FC_1_control_EBSS.0_control <0,"focus","other" ),"other"),
         AutoKOaccum = log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control ,
         priority = dplyr::if_else(focus_quad == "focus",dplyr::if_else(abs(AutoKOaccum)>abs(log2FC_1_control_EBSS.0_control),abs(log2FC_1_control_EBSS.0_control),abs(AutoKOaccum)),0))

fig1_hela_data<-fig1_hela_data%>%
  dplyr::mutate(focus_quad = dplyr::if_else(log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control > 0,dplyr::if_else(log2FC_1_control_EBSS.0_control <0,"focus","other" ),"other"),
         AutoKOaccum = log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control ,
         priority = dplyr::if_else(focus_quad == "focus",dplyr::if_else(abs(AutoKOaccum)>abs(log2FC_1_control_EBSS.0_control),abs(log2FC_1_control_EBSS.0_control),abs(AutoKOaccum)),0))%>%
  dplyr::filter(log2FC_1_control_EBSS.0_control>-3.5)
# %>%
#   dplyr::filter(LDSloss>-3)

supp1g<-ggplot()+geom_vline(xintercept = 0,linetype="dashed")+geom_hline(yintercept = 0,linetype="dashed")+
  geom_point(data=fig1_hela_data%>%dplyr::filter(focus_quad == "other"), aes(log2FC_1_control_EBSS.0_control,  log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control),alpha=0.5,color="grey")+
    geom_point(data=fig1_hela_data%>%dplyr::filter(focus_quad != "other"), aes(log2FC_1_control_EBSS.0_control,  log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control,color=priority),alpha=0.4)+
  geom_point(data=fig1_hela_data%>% dplyr::filter(Gene.Symbol%in% helalist), aes(log2FC_1_control_EBSS.0_control, log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control),color = "black", shape=21,fill="orange",size=3)+
  geom_label_repel(data=fig1_hela_data%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control, log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control,label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+theme_classic()+
  labs(x="WT Log2(EBSS/UT)", y="ATG7-/- Log2(EBBS/UT) - WT Log2(EBBS/UT)",title="HeLa")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))+scale_color_viridis_c()+xlim(c(-3,3))+ylim(c(-2,2))

supp1g

fig1e<-ggplot()+geom_vline(xintercept = 0,linetype="dashed")+geom_hline(yintercept = 0,linetype="dashed")+
  geom_point(data=fig1_hela_data%>%dplyr::filter(focus_quad == "other"), aes(log2FC_1_control_EBSS.0_control,  log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control),alpha=0.5,color="grey")+
    geom_point(data=fig1_hela_data%>%dplyr::filter(focus_quad != "other"), aes(log2FC_1_control_EBSS.0_control,  log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control,color=priority),alpha=0.4)+
  geom_point(data=fig1_hela_data%>% dplyr::filter(Gene.Symbol%in% helalist), aes(log2FC_1_control_EBSS.0_control, log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control),color = "black", shape=21,fill="orange",size=3)+
  geom_label_repel(data=fig1_hela_data%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control, log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control,label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+theme_classic()+
  labs(x="WT Log2(EBSS/UT)", y="ATG7-/- Log2(EBBS/UT) - WT Log2(EBBS/UT)",title="HeLa")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))+scale_color_viridis_c()+xlim(c(-3,0))+ylim(c(0,2))
  
fig1e
```


### Starvation dependent fluxers HEK293

```{r}
fig1_hek_data_rankUse<-fig1_hek_data%>%
  dplyr::mutate(focus_quad = dplyr::if_else(log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control > 0,dplyr::if_else(log2FC_1_control_EBSS.0_control <0,"focus","other" ),"other"),
         AutoKOaccum = log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control ,
         priority = dplyr::if_else(focus_quad == "focus",dplyr::if_else(abs(AutoKOaccum)>abs(log2FC_1_control_EBSS.0_control),abs(log2FC_1_control_EBSS.0_control),abs(AutoKOaccum)),0))

fig1_hek_data<-fig1_hek_data%>%
  dplyr::mutate(focus_quad = dplyr::if_else(log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control > 0,dplyr::if_else(log2FC_1_control_EBSS.0_control <0,"focus","other" ),"other"),
         AutoKOaccum = log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control ,
         priority = dplyr::if_else(focus_quad == "focus",dplyr::if_else(abs(AutoKOaccum)>abs(log2FC_1_control_EBSS.0_control),abs(log2FC_1_control_EBSS.0_control),abs(AutoKOaccum)),0))%>%
  dplyr::filter(log2FC_1_control_EBSS.0_control>-3.5)
# %>%
#   dplyr::filter(LDSloss>-3)

supp1h<-ggplot()+geom_vline(xintercept = 0,linetype="dashed")+geom_hline(yintercept = 0,linetype="dashed")+
  geom_point(data=fig1_hek_data%>%dplyr::filter(focus_quad == "other"), aes(log2FC_1_control_EBSS.0_control,  log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control),alpha=0.5,color="grey")+
    geom_point(data=fig1_hek_data%>%dplyr::filter(focus_quad != "other"), aes(log2FC_1_control_EBSS.0_control,  log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control,color=priority),alpha=0.4)+
  geom_point(data=fig1_hek_data%>% dplyr::filter(Gene.Symbol%in% helalist), aes(log2FC_1_control_EBSS.0_control, log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control),color = "black", shape=21,fill="orange",size=3)+
  geom_label_repel(data=fig1_hek_data%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control, log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control,label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+theme_classic()+
  labs(x="WT Log2(EBSS/UT)", y="ATG7-/- Log2(EBBS/UT) - WT Log2(EBBS/UT)",title="HEK293")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))+scale_color_viridis_c()+xlim(c(-3,3))+ylim(c(-2,2))

supp1h

fig1f<-ggplot()+geom_vline(xintercept = 0,linetype="dashed")+geom_hline(yintercept = 0,linetype="dashed")+
  geom_point(data=fig1_hek_data%>%dplyr::filter(focus_quad == "other"), aes(log2FC_1_control_EBSS.0_control,  log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control),alpha=0.5,color="grey")+
    geom_point(data=fig1_hek_data%>%dplyr::filter(focus_quad != "other"), aes(log2FC_1_control_EBSS.0_control,  log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control,color=priority),alpha=0.4)+
  geom_point(data=fig1_hek_data%>% dplyr::filter(Gene.Symbol%in% helalist), aes(log2FC_1_control_EBSS.0_control, log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control),color = "black", shape=21,fill="orange",size=3)+
  geom_label_repel(data=fig1_hek_data%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control, log2FC_3_ATG7.KO_EBSS.2_ATG7.KO - log2FC_1_control_EBSS.0_control,label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+theme_classic()+
  labs(x="WT Log2(EBSS/UT)", y="ATG7-/- Log2(EBBS/UT) - WT Log2(EBBS/UT)",title="HEK293")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))+scale_color_viridis_c()+xlim(c(-3,0))+ylim(c(0,2))
  
fig1f
```


### Compartment comparison

```{r}
ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")
### produce organelle annotation in a tidy format for mapping to data
ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")%>%
  dplyr::distinct()

###add filter
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  ,"Cytosol")

ss_organelle_list<-ss_organelle_list%>%
  dplyr::filter(Compartment_ss %in% list_compartments)

fig1_hela_data_locale <- left_join(fig1_hela_data, ss_organelle_list , by="Gene.Symbol")%>%
  dplyr::mutate(locale = Compartment_ss)

fig1_hela_data_locale2<-fig1_hela_data_locale%>%
  dplyr::mutate(locale = "Total")

fig1_hela_data_locale3 <- dplyr::bind_rows(fig1_hela_data_locale, fig1_hela_data_locale2)%>%
  dplyr::select(Gene.Symbol, Reference, locale, log2FC_1_control_EBSS.0_control,log2FC_3_ATG7.KO_EBSS.2_ATG7.KO)%>%
  dplyr::group_by(Gene.Symbol, Reference, locale)%>%
  tidyr::gather("CellLine","Log2FC_EBSS_UT",4:5)%>%
  dplyr::mutate(CellLine = if_else(stringr::str_detect(CellLine, "ATG7"), "ATG7 KO","WT"))

fig1d_slim<-fig1_hela_data_locale3%>%
  dplyr::filter(locale %in% c("ER","Golgi","Total"))

fig1d_slim$locale <- factor(fig1d_slim$locale , levels=c("Total","Golgi","ER"))

fig1d_slim$CellLine <- factor(fig1d_slim$CellLine , levels=c("WT","ATG7 KO"))

fig1d<-ggplot()+
  geom_hline(yintercept = 0, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = 0.5, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = -0.5, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = 1, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = -1, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = 1.5, linetype="dashed",alpha=0.3)+
  geom_hline(yintercept = -1.5, linetype="dashed",alpha=0.3)+
  geom_violin(data=fig1d_slim, aes(locale,Log2FC_EBSS_UT,fill=CellLine),draw_quantiles = c(0.25,0.75),alpha=0.35,size=0.35)+
  geom_violin(data=fig1d_slim, aes(locale,Log2FC_EBSS_UT,fill=CellLine),draw_quantiles = c(0.5),alpha=0.35,size=1)+scale_fill_manual(values=c("purple4","lightblue"))+theme_classic()+
  labs(y="Log2(EBSS/UT)",x="")+
  theme(axis.title = element_text(size=18),axis.text = element_text(size=16),legend.position = "none")+scale_y_continuous(breaks=c(-1.5,-1,-0.5,0,0.5,1,1.5),limits=c(-1.5,1.5))
#,legend.title = element_blank()

fig1d
```




### figure 1 generation

```{r}

row1_supp1 <- cowplot::plot_grid(suppfig1a,NULL, align="hv", labels=c("A","B"),nrow=1)
row2_supp1 <- cowplot::plot_grid(supp1c,supp1d, align="hv", labels=c("C","D"),nrow=1)
row3_supp1 <- cowplot::plot_grid(supp1e,supp1f, align="hv", labels=c("E","F"),nrow=1)
row4_supp1 <- cowplot::plot_grid(supp1g,supp1h, align="hv", labels=c("G","H"),nrow=1)

supp1_plot<- cowplot::plot_grid(row1_supp1,row2_supp1,row3_supp1,row4_supp1, align = "hv",nrow=4,rel_heights = c(1,1.5,1.5,1.5))

supp1_plot

# ggsave(supp1_plot,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/supp1_HeLa_HEK293_starveAutoDep_v2.pdf", width = 13,height = 55/3)

fig1_row1 <- cowplot::plot_grid(fig1a,NULL, labels=c("A","B"), align = "hv",nrow=1)
fig1_row2 <- cowplot::plot_grid(NULL,fig1d,NULL, labels=c("C","D",""),rel_widths = c(1,1,2),align="hv",nrow=1)
fig1_row3 <- cowplot::plot_grid(fig1e,fig1f,  labels = c("E","F"),align="hv",nrow=1)
fig1_plot<- cowplot::plot_grid(fig1_row1,fig1_row2,fig1_row3,align="hv",nrow=3,rel_heights = c(0.6,0.6,1))
fig1_plot


# ggsave(fig1_plot,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/fig1_hek293_hela_starveAutoDep_v2.pdf", width = 13,height = 12)
```


### Candidate Starve/Autophagy Substrate Priority list

```{r}
LIR_database<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/LIR_human_all.csv")

fig1_hek_data_rankUse<-fig1_hek_data_rankUse%>%
  dplyr::arrange(dplyr::desc(priority))%>%
  tibble::rownames_to_column("Rank")%>%
  dplyr::mutate(Rank = as.numeric(as.character(Rank))/dim(fig1_hek_data)[[1]])


fig1_hek_data_LIRmatch <- fig1_hek_data_rankUse%>%
  dplyr::select(Rank, Gene.Symbol, Reference)%>%
  tidyr::separate(Reference,sep="\\|", into=c("type","uniprot_id","extra_desc"))%>%
  dplyr::left_join(.,LIR_database, by = "uniprot_id")
  
fig1_hela_data_rankUse<-fig1_hela_data_rankUse%>%
  dplyr::arrange(dplyr::desc(priority))%>%
  tibble::rownames_to_column("Rank")%>%
  dplyr::mutate(Rank = as.numeric(as.character(Rank))/dim(fig1_hela_data)[[1]])

fig1_hela_data_LIRmatch <- fig1_hela_data_rankUse%>%
  dplyr::select(Rank, Gene.Symbol, Reference)%>%
  tidyr::separate(Reference,sep="\\|", into=c("type","uniprot_id","extra_desc"))%>%
  dplyr::left_join(.,LIR_database, by = "uniprot_id")

fig1_hek_data_slim <- fig1_hek_data_rankUse%>%
  dplyr::select(Rank,Gene.Symbol,log2FC_1_control_EBSS.0_control,AutoKOaccum,priority)

fig1_hela_data_slim <- fig1_hela_data_rankUse%>%
  dplyr::select(Rank,Gene.Symbol,log2FC_1_control_EBSS.0_control,AutoKOaccum,priority)


```


## Figure 2: APEX ATG8

### Apex LC3 and GABARAPL2

```{r}

fig2_lc3 <- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/LC3B-apex.csv")

helalist<-c("NCOA4","CCPG1","TEX264","GABARAPL2", "MAP1LC3B2", "YIPF4", "YIPF3", "SQSTM1", "CALCOCO1", "ULK1","WIPI2","TAX1BP1","SQSTM1","RB1CC1","GABARAP","ZFYVE1")



supp2b<-ggplot()+geom_vline(xintercept = -log2(1.5),linetype="dashed")+geom_vline(xintercept = log2(1.5),linetype="dashed")+geom_hline(yintercept = -log10(0.05),linetype="dashed")+
  geom_point(data= fig2_lc3%>%dplyr::filter(Gene.Symbol %!in% helalist ), aes(log2FC_1_control_EBSS.0_control_UT,-log10(q.val_1_control_EBSS.0_control_UT)),alpha=0.1,size=2)+
  geom_point(data=fig2_lc3 %>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control_UT,-log10(q.val_1_control_EBSS.0_control_UT)),color = "black", shape=21,fill="lightblue",size=2)+
  geom_label_repel(data=fig2_lc3%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control_UT,-log10(q.val_1_control_EBSS.0_control_UT),label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+
  theme_classic()+xlim(c(-4,4))+ylim(c(-0,3))+
  labs(x="WT Log2(EBSS+BafA/UT)", y="-Log10(q-value)",title="APEX2-MAP1LC3B")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))

supp2b

supp2d<-ggplot()+geom_vline(xintercept = -log2(1.5),linetype="dashed")+geom_vline(xintercept = log2(1.5),linetype="dashed")+geom_hline(yintercept = -log10(0.05),linetype="dashed")+
  geom_point(data= fig2_lc3%>%dplyr::filter(Gene.Symbol %!in% helalist ), aes(log2FC_2_LIR_EBSS.2_LIR_UT,-log10(q.val_2_LIR_EBSS.2_LIR_UT)),alpha=0.1,size=2)+
  geom_point(data=fig2_lc3 %>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_2_LIR_EBSS.2_LIR_UT,-log10(q.val_2_LIR_EBSS.2_LIR_UT)),color = "black", shape=21,fill="lightblue",size=2)+
  geom_label_repel(data=fig2_lc3%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_2_LIR_EBSS.2_LIR_UT,-log10(q.val_2_LIR_EBSS.2_LIR_UT),label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+
  theme_classic()+xlim(c(-4,4))+ylim(c(-0,3))+
  labs(x="MAP1LC3B K51AG120A Log2(EBSS+BafA/UT)", y="-Log10(q-value)",title="APEX2-MAP1LC3B")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))

supp2d
```


### Apex GABARAPL2

```{r}

fig2_GABARAPL2 <- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/GABARAPL2-apex.csv")

helalist<-c("NCOA4","CCPG1","TEX264","GABARAPL2", "MAP1LC3B2", "YIPF4", "YIPF3", "SQSTM1", "CALCOCO1", "ULK1","WIPI2","TAX1BP1","SQSTM1","RB1CC1","GABARAP","ZFYVE1")



supp2a<-ggplot()+  geom_vline(xintercept = -log2(1.5),linetype="dashed")+geom_vline(xintercept = log2(1.5),linetype="dashed")+geom_hline(yintercept = -log10(0.05),linetype="dashed")+
  geom_point(data= fig2_GABARAPL2%>%dplyr::filter(Gene.Symbol %!in% helalist ), aes(log2FC_1_control_EBSS.0_control_UT,-log10(q.val_1_control_EBSS.0_control_UT)),alpha=0.1,size=2)+
  geom_point(data=fig2_GABARAPL2 %>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control_UT,-log10(q.val_1_control_EBSS.0_control_UT)),color = "black", shape=21,fill="lightblue",size=2)+
  geom_label_repel(data=fig2_GABARAPL2%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control_UT,-log10(q.val_1_control_EBSS.0_control_UT),label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+
  theme_classic()+xlim(c(-4,4))+ylim(c(-0,2.6))+
  labs(x="WT Log2(EBSS+BafA/UT)", y="-Log10(q-value)",title="APEX2-GABARAPL2")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))

supp2a

supp2c<-ggplot()+geom_vline(xintercept = -log2(1.5),linetype="dashed")+geom_vline(xintercept = log2(1.5),linetype="dashed")+geom_hline(yintercept = -log10(0.05),linetype="dashed")+
  geom_point(data= fig2_GABARAPL2%>%dplyr::filter(Gene.Symbol %!in% helalist ), aes(log2FC_2_LIR_EBSS.2_LIR_UT,-log10(q.val_2_LIR_EBSS.2_LIR_UT)),alpha=0.1,size=2)+
  geom_point(data=fig2_GABARAPL2 %>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_2_LIR_EBSS.2_LIR_UT,-log10(q.val_2_LIR_EBSS.2_LIR_UT)),color = "black", shape=21,fill="lightblue",size=2)+
  geom_label_repel(data=fig2_GABARAPL2%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_2_LIR_EBSS.2_LIR_UT,-log10(q.val_2_LIR_EBSS.2_LIR_UT),label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+
  theme_classic()+xlim(c(-4,4))+ylim(c(-0,2.6))+
  labs(x="GABARAPL2 Y49AL50A Log2(EBSS+BafA/UT)", y="-Log10(q-value)",title="APEX2-GABARAPL2")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))

supp2c

```





### Rank compares


```{r}


fig2_GABARAPL2_rankUse<-fig2_GABARAPL2%>%
  dplyr::mutate(focus_quad = dplyr::if_else(log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT < 0,dplyr::if_else(log2FC_1_control_EBSS.0_control_UT >0,"focus","other" ),"other"),
         LDSloss = log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,
         priority = dplyr::if_else(focus_quad == "focus",dplyr::if_else(abs(LDSloss)>abs(log2FC_1_control_EBSS.0_control_UT),abs(log2FC_1_control_EBSS.0_control_UT),abs(LDSloss)),0))

fig2_GABARAPL2<-fig2_GABARAPL2%>%
  dplyr::mutate(focus_quad = if_else(log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT < 0,dplyr::if_else(log2FC_1_control_EBSS.0_control_UT >0,"focus","other" ),"other"),
         LDSloss = log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,
         priority = dplyr::if_else(focus_quad == "focus",dplyr::if_else(abs(LDSloss)>abs(log2FC_1_control_EBSS.0_control_UT),abs(log2FC_1_control_EBSS.0_control_UT),abs(LDSloss)),0))%>%
  dplyr::filter(LDSloss>-3)



supp2e<-ggplot()+geom_vline(xintercept = 0,linetype="dashed")+geom_hline(yintercept = 0,linetype="dashed")+
  geom_point(data=fig2_GABARAPL2%>%dplyr::filter(focus_quad == "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),alpha=0.5,color="grey")+
    geom_point(data=fig2_GABARAPL2%>%dplyr::filter(focus_quad != "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,color=priority),alpha=0.4)+
  geom_point(data=fig2_GABARAPL2%>% dplyr::filter(Gene.Symbol%in% helalist), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),color = "black", shape=21,fill="orange",size=3)+
  geom_label_repel(data=fig2_GABARAPL2%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+xlim(c(-3,3))+ylim(c(-2,2))+theme_classic()+
  labs(x="WT Log2(EBSS+BafA/UT)", y="GABARAPL2 Y49AL50A Log2(EBBS+BafA/UT) - WT Log2(EBBS+BafA/UT)",title="APEX2-GABARAPL2")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))+scale_color_viridis_c()

supp2e
  
## zoom
p2c<-ggplot()+geom_vline(xintercept = 0,linetype="dashed")+geom_hline(yintercept = 0,linetype="dashed")+geom_point(data=fig2_GABARAPL2%>%dplyr::filter(focus_quad == "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),alpha=0.5,color="grey")+
    geom_point(data=fig2_GABARAPL2%>%dplyr::filter(focus_quad != "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,color=priority),alpha=0.4)+
  geom_point(data=fig2_GABARAPL2%>% dplyr::filter(Gene.Symbol%in% helalist), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),color = "black", shape=21,fill="orange",size=3)+
  geom_label_repel(data=fig2_GABARAPL2%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+xlim(c(0,3))+ylim(c(-2,0))+theme_classic()+
  labs(x="WT Log2(EBSS+BafA/UT)", y="GABARAPL2 Y49AL50A Log2(EBBS+BafA/UT) - WT Log2(EBBS+BafA/UT)",title="APEX2-GABARAPL2")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))+scale_color_viridis_c()
  
p2c


### lc3b
fig2_lc3_rankUse<-fig2_lc3%>%
  dplyr::mutate(focus_quad = dplyr::if_else(log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT < 0,dplyr::if_else(log2FC_1_control_EBSS.0_control_UT >0,"focus","other" ),"other"),
         LDSloss = log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,
         priority = if_else(focus_quad == "focus",if_else(abs(LDSloss)>abs(log2FC_1_control_EBSS.0_control_UT),abs(log2FC_1_control_EBSS.0_control_UT),abs(LDSloss)),0))


fig2_lc3<-fig2_lc3%>%
  dplyr::mutate(focus_quad = dplyr::if_else(log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT < 0,if_else(log2FC_1_control_EBSS.0_control_UT >0,"focus","other" ),"other"),
         LDSloss = log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,
         priority = dplyr::if_else(focus_quad == "focus",dplyr::if_else(abs(LDSloss)>abs(log2FC_1_control_EBSS.0_control_UT),abs(log2FC_1_control_EBSS.0_control_UT),abs(LDSloss)),0))%>%
  dplyr::filter(LDSloss>-3)


supp2f<-ggplot()+geom_vline(xintercept = 0,linetype="dashed")+geom_hline(yintercept = 0,linetype="dashed")+
  geom_point(data=fig2_lc3%>%dplyr::filter(focus_quad == "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),alpha=0.5,color="grey")+
    geom_point(data=fig2_lc3%>%dplyr::filter(focus_quad != "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,color=priority),alpha=0.4)+
  geom_point(data=fig2_lc3%>% dplyr::filter(Gene.Symbol%in% helalist), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),color = "black", shape=21,fill="orange",size=3)+
  geom_label_repel(data=fig2_lc3%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+xlim(c(-3,3))+ylim(c(-2,2))+theme_classic()+
  labs(x="WT Log2(EBSS+BafA/UT)", y="LC3B K51AG120A Log2(EBBS+BafA/UT)- WT Log2(EBBS+BafA/UT)",title="APEX2-MAP1LC3B")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))+scale_color_viridis_c()
  
supp2f

## zoom
p2d <-ggplot()+  geom_vline(xintercept = 0,linetype="dashed")+geom_hline(yintercept = 0,linetype="dashed")+geom_point(data=fig2_lc3%>%dplyr::filter(focus_quad == "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),alpha=0.5,color="grey")+
    geom_point(data=fig2_lc3%>%dplyr::filter(focus_quad != "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,color=priority),alpha=0.4)+
  geom_point(data=fig2_lc3%>% dplyr::filter(Gene.Symbol%in% helalist), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),color = "black", shape=21,fill="orange",size=3)+
  geom_label_repel(data=fig2_lc3%>%dplyr::filter(Gene.Symbol %in% helalist ), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+xlim(c(0,3))+ylim(c(-2,0))+theme_classic()+
  labs(x="WT Log2(EBSS+BafA/UT)", y="LC3B K51AG120A Log2(EBBS+BafA/UT)- WT Log2(EBBS+BafA/UT)",title="APEX2-MAP1LC3B")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))+scale_color_viridis_c()

p2d

# plot_grid(p1,p2,nrow=1)


top_sup2<-cowplot::plot_grid(supp2a,supp2b,align="hv", labels=c("A","B"),nrow=1)
mid_sup2<-cowplot::plot_grid(supp2c,supp2d,align="hv", labels=c("C","D"),nrow=1)
bottom_sup2 <- cowplot::plot_grid(supp2e,supp2f,align="hv", labels=c("E","F"),nrow=1 )
sup2<-cowplot::plot_grid(top_sup2,mid_sup2,bottom_sup2,nrow = 3,align="hv")

sup2

# ggsave(sup2,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/supp2_lc3b_GABARAPL2_apex_v2.pdf", width = 13,height = 15)


fig2_plot<-cowplot::plot_grid(p2c,p2d, align="hv", labels = c("C","D"))

fig2_plot

# ggsave(fig2_plot,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/fig2_lc3b_GABARAPL2_apex_zoomLDSmut_v2.pdf", width = 13,height = 5)




```





### Subcellular Compartment Localization flux

```{r}
### organelle annotations
ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")
### produce organelle annotation in a tidy format for mapping to data
ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")%>%
  dplyr::distinct()

###add filter
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  ,"Cytosol")

ss_organelle_list<-ss_organelle_list%>%
  dplyr::filter(Compartment_ss %in% list_compartments)

fig2_GABARAPL2_locale <- dplyr::left_join(fig2_GABARAPL2_rankUse, ss_organelle_list , by="Gene.Symbol")
fig2_lc3_locale <- dplyr::left_join(fig2_lc3_rankUse, ss_organelle_list , by="Gene.Symbol")


fig2_GABARAPL2_locale<-fig2_GABARAPL2_locale%>%
  dplyr::mutate(general_locale = dplyr::if_else(Compartment_ss %!in% c("Golgi","ER","Lysosome"),"Other",Compartment_ss))

fig2_lc3_locale<-fig2_lc3_locale%>%
  dplyr::mutate(general_locale = dplyr::if_else(Compartment_ss %!in% c("Golgi","ER","Lysosome"),"Other",Compartment_ss))

fig2_lc3_locale$general_locale <- factor(fig2_lc3_locale$general_locale , levels=c("Other","ER","Golgi","Lysosome"))

fig2_GABARAPL2_locale$general_locale <- factor(fig2_GABARAPL2_locale$general_locale , levels=c("Other","ER","Golgi","Lysosome"))


p3G<-ggplot(fig2_lc3_locale, aes(general_locale,log2FC_1_control_EBSS.0_control_UT,fill=general_locale ))+geom_violin(draw_quantiles = c(0.25,.75),alpha=0.2,size=0.35)+
  geom_violin(draw_quantiles = c(0.5),alpha=0.2,size=0.5)+ylim(c(-2,2))+scale_color_viridis_d(end=0.8)+scale_fill_viridis_d(end=0.8)+theme_classic()+geom_hline(yintercept = 0,linetype="dashed")+labs(y="WT Log2(EBSS/UT)",title = "APEX-MAP1LC3B")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5),legend.position =  "none",axis.title.x = element_blank())


p3H<-ggplot(fig2_GABARAPL2_locale, aes(general_locale,log2FC_1_control_EBSS.0_control_UT,fill=general_locale ))+geom_violin(draw_quantiles = c(0.25,.75),alpha=0.2,size=0.35)+
  geom_violin(draw_quantiles = c(0.5),alpha=0.2,size=0.5)+ylim(c(-2,2))+scale_color_viridis_d(end=0.8)+scale_fill_viridis_d(end=0.8)+theme_classic()+geom_hline(yintercept = 0,linetype="dashed")+labs(y="WT Log2(EBSS/UT)",title = "APEX-GABARAPL2")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5),legend.position = "none",axis.title.x = element_blank())


p3x<-plot_grid(p3H,p3G, align="hv", labels = c("E","F"))

p3x

# ggsave(p3x,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/fig2ef_lc3b_GABARAPL2_apex_localeEnrich_50perc.pdf", height = 3.75,width = 13*0.58)

```



### Figure 2: Ranks


```{r}
LIR_database<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/LIR_human_all.csv")

fig2_lc3_rankUse<-fig2_lc3_rankUse%>%
  dplyr::arrange(desc(priority))%>%
  tibble::rownames_to_column("Rank")%>%
  dplyr::mutate(Rank = as.numeric(as.character(Rank))/dim(fig2_lc3)[[1]])

fig2_lc3_LIRmatch <- fig2_lc3_rankUse%>%
  dplyr::select(Rank, Gene.Symbol, Reference)%>%
  tidyr::separate(Reference,sep="\\|", into=c("type","uniprot_id","extra_desc"))%>%
  dplyr::left_join(.,LIR_database, by = "uniprot_id")


fig2_GABARAPL2_rankUse<-fig2_GABARAPL2_rankUse%>%
  dplyr::arrange(desc(priority))%>%
  tibble::rownames_to_column("Rank")%>%
  dplyr::mutate(Rank = as.numeric(as.character(Rank))/dim(fig2_GABARAPL2)[[1]])

fig2_GABARAPL2_LIRmatch <- fig2_GABARAPL2_rankUse%>%
  dplyr::select(Rank, Gene.Symbol, Reference)%>%
  tidyr::separate(Reference,sep="\\|", into=c("type","uniprot_id","extra_desc"))%>%
  dplyr::left_join(.,LIR_database, by = "uniprot_id")


fig2_lc3_slim <- fig2_lc3_rankUse%>%
  dplyr::select(Rank,Gene.Symbol,log2FC_1_control_EBSS.0_control_UT,LDSloss,priority)

fig2_GABARAPL2_slim <- fig2_GABARAPL2_rankUse%>%
  dplyr::select(Rank,Gene.Symbol,log2FC_1_control_EBSS.0_control_UT,LDSloss,priority)



```



## Combine Fig1_Fig2



### min and at least in 1

```{r}
fig1_combined2<-dplyr::full_join(fig1_hela_data_slim,fig1_hek_data_slim,by="Gene.Symbol",suffix=c("_hela","_hek"))

fig1_combined2<-fig1_combined2%>%
  dplyr::mutate(MinRank= dplyr::if_else(is.na(Rank_hela), Rank_hek, dplyr::if_else(is.na(Rank_hek), Rank_hela, dplyr::if_else(Rank_hela < Rank_hek , Rank_hela, Rank_hek))))%>%
  dplyr::arrange(MinRank)


fig1_combined_min2<-fig1_combined2%>%
  dplyr::group_by(Gene.Symbol)%>%
  dplyr::mutate(prot_MinRank = min(MinRank))%>%
  dplyr::filter(MinRank == prot_MinRank)


fig2_combined2<-dplyr::full_join(fig2_lc3_slim,fig2_GABARAPL2_slim,by="Gene.Symbol",suffix=c("_lc3b","_GABARAPL2"))

fig2_combined2<-fig2_combined2%>%
  dplyr::mutate(MinRank= dplyr::if_else(is.na(Rank_GABARAPL2), Rank_lc3b, dplyr::if_else(is.na(Rank_lc3b), Rank_GABARAPL2, dplyr::if_else(Rank_GABARAPL2 < Rank_lc3b , Rank_GABARAPL2, Rank_lc3b))))%>%
  #MinRank= if_else(Rank_lc3b<Rank_GABARAPL2,Rank_lc3b,Rank_GABARAPL2))%>%
  dplyr::arrange(MinRank)


fig2_combined_min2<-fig2_combined2%>%
  dplyr::group_by(Gene.Symbol)%>%
  dplyr::mutate(prot_MinRank = min(MinRank))%>%
  dplyr::filter(MinRank == prot_MinRank)



fig1_combined_MinRank2 <- fig1_combined_min2%>%
  dplyr::arrange(MinRank)%>%
  tibble::rownames_to_column("MinRank_rerank")%>%
  dplyr::mutate(MinRank_rerank = as.numeric(as.character(MinRank_rerank))/dim(fig1_combined_min2)[[1]])
  
fig2_combined_MinRank2<-fig2_combined_min2 %>%
  dplyr::arrange(MinRank)%>%
  tibble::rownames_to_column("MinRank_rerank")%>%
  dplyr::mutate(MinRank_rerank = as.numeric(as.character(MinRank_rerank))/dim(fig2_combined_min2)[[1]])

fig1_combined_MinRank2_export<-fig1_combined_MinRank2%>%
  dplyr::select(MinRank_rerank ,Gene.Symbol,Rank_hela,Rank_hek,log2FC_1_control_EBSS.0_control_hela,AutoKOaccum_hela,priority_hela,log2FC_1_control_EBSS.0_control_hek,AutoKOaccum_hek,priority_hek,prot_MinRank)%>%
  dplyr::rename(ATG7minWT_EBSStoUT_HeLa = AutoKOaccum_hela,
              WT_EBSStoUT_HeLa = log2FC_1_control_EBSS.0_control_hela,
              ScaledRank_HeLa =Rank_hela,
              priority_HeLa= priority_hela,
              ATG7minWT_EBSStoUT = AutoKOaccum_hek,
              WT_EBSStoUT_HEK293 = log2FC_1_control_EBSS.0_control_hek,
              ScaledRank_HEK293=Rank_hek,
              priority_HEK293= priority_hek)
# write.csv(fig1_combined_MinRank2_export,"C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/Fig1_Ranks_AutophagyStarveFluxers.csv",row.names = F)

fig2_combined_MinRank2_export<-fig2_combined_MinRank2%>%
  dplyr::select(MinRank_rerank ,Gene.Symbol,Rank_lc3b,Rank_GABARAPL2,log2FC_1_control_EBSS.0_control_UT_lc3b,LDSloss_lc3b,priority_lc3b,log2FC_1_control_EBSS.0_control_UT_GABARAPL2,LDSloss_GABARAPL2,priority_GABARAPL2,prot_MinRank)%>%
  dplyr::rename(LDSminWT_EBSSBafAtoUT_LC3B = LDSloss_lc3b,
              WT_EBSSBafAtoUT_LC3B = log2FC_1_control_EBSS.0_control_UT_lc3b,
              ScaledRank_LC3B =Rank_lc3b,
              priority_LC3B= priority_lc3b,
              LDSminWT_EBSSBafAtoUT_GABARAPL2 = LDSloss_GABARAPL2,
              WT_EBSSBafAtoUT_GABARAPL2 = log2FC_1_control_EBSS.0_control_UT_GABARAPL2,
              ScaledRank_GABARAPL2=Rank_GABARAPL2,
              priority_GABARAPL2= priority_GABARAPL2)

# write.csv(fig2_combined_MinRank2_export,"C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/Fig2_Ranks_ATG8proximity.csv",row.names = F)


fig1_fig2_combined2<-dplyr::full_join(fig1_combined_MinRank2 ,fig2_combined_MinRank2 ,by="Gene.Symbol",
                              suffix=c("_Auto","_Prox"))%>%
  dplyr::mutate(Fig1and2_SumRank = MinRank_rerank_Auto + MinRank_rerank_Prox)%>%
  dplyr::arrange(Fig1and2_SumRank)%>%
  dplyr::group_by(Gene.Symbol)%>%
  dplyr::mutate(min_Fig1and2_SumRank = min(Fig1and2_SumRank))%>%
  dplyr::filter(min_Fig1and2_SumRank == Fig1and2_SumRank)


fig1_fig2_combined_final2<-fig1_fig2_combined2%>%
  dplyr::distinct(Gene.Symbol,MinRank_rerank_Auto,MinRank_rerank_Prox,Fig1and2_SumRank)%>%
  dplyr::select(Gene.Symbol,MinRank_rerank_Auto,MinRank_rerank_Prox,Fig1and2_SumRank)%>%
  tibble::rownames_to_column("Fig1and2_Final_Rank")%>%
  dplyr::mutate(Fig1and2_Final_Rank = as.numeric(as.character(Fig1and2_Final_Rank)))





### organelle annotations
ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")
### produce organelle annotation in a tidy format for mapping to data
ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")%>%
  dplyr::distinct()

###add filter
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  ,"Cytosol")

ss_organelle_list<-ss_organelle_list%>%
  dplyr::filter(Compartment_ss %in% list_compartments)

fig1_fig2_combined_final_ann2 <- dplyr::left_join(fig1_fig2_combined_final2, ss_organelle_list , by="Gene.Symbol")

# 
# write.csv(fig1_fig2_combined_final_ann2,"C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/result_files/Fig1and2_topCandidates_foundLeast1Each.csv")

```

### Map LIR domain 

```{r}
a_map<-fig1_hek_data_LIRmatch%>%dplyr::filter(!is.na(pattern))%>%dplyr::select(Gene.Symbol)%>%dplyr::mutate(LIR="LIR")
b_map<-fig1_hela_data_LIRmatch%>%dplyr::filter(!is.na(pattern))%>%dplyr::select(Gene.Symbol)%>%dplyr::mutate(LIR="LIR")
c_map<-fig2_GABARAPL2_LIRmatch%>%dplyr::filter(!is.na(pattern))%>%dplyr::select(Gene.Symbol)%>%dplyr::mutate(LIR="LIR")
d_map<-fig2_lc3_LIRmatch%>%dplyr::filter(!is.na(pattern))%>%dplyr::select(Gene.Symbol)%>%dplyr::mutate(LIR="LIR")

combine_lir_map <- dplyr::bind_rows(a_map,b_map,c_map,d_map)%>%dplyr::distinct()


fig1_fig2_combined_final_ann2_LIR <- dplyr::left_join(fig1_fig2_combined_final_ann2,combine_lir_map, by="Gene.Symbol")%>%
  dplyr::mutate(LIR= if_else(is.na(LIR), "None","LIR"))




# write.csv(fig1_fig2_combined_final_ann2_LIR,"C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/result_files/Fig1and2_topCandidates_foundLeast1Each_LIRadded.csv")


list_autophagy <- c(
  "ACBD5","AMBRA1","ATG10","ATG101","ATG12",
  "ATG13","ATG14","ATG16L1","ATG2A","ATG2B",
  "ATG3","ATG4A","ATG4B","ATG4C","ATG5",
  "ATG7","ATG9A","BAG3","BCL2L13","BECN1",
  "BNIP3L","CALCOCO2","CCPG1","CDK5RAP3","CHMP2B",
  "CHMP4B","EGFR","EIF4G1","ERBB2","FUNDC1",
  "FYCO1","GABARAP","GABARAPL2","GOPC","HDAC6",
  "HGS","HIF1A","HSPA8","ITGB1","LGALS3",
  "LGALS8","MAP1LC3A","MAP1LC3B","MTOR","NBR1",
  "NCOA4","NLRX1","OPTN","PEX13","PEX14",
  "PEX3","PEX5","PIK3C3","PIK3R4","PINK1",
  "PLEKHM1","PRKN","PTEN","RAB11A","RAB1A",
  "RAB24","RAB33B","RAB5A","RAB7A","RAC1",
  "RB1CC1","RETREG1","RPTOR","RUBCN","SH3GLB1",
  "SIRT1","SIRT2","SQSTM1","STBD1","STK11",
  "STX17","TAX1BP1","TBK1","TEX264","TM9SF1",
  "TOLLIP","TRIM5","TSC2","ULK1","ULK2",
  "UVRAG","WDFY3","WDR45","WDR45B","WIPI1",
  "WIPI2","ZFYVE1")

fig1_fig2_combined_final_ann2_LIR_autophagyAnn<-fig1_fig2_combined_final_ann2_LIR%>%
  dplyr::mutate(known_autophagy = dplyr::if_else(Gene.Symbol %in% list_autophagy, "autophagy","No"))%>%
  dplyr::mutate(LIR=dplyr::if_else(Gene.Symbol %in% c("CALCOCO1","SEC62"),"LIR*",LIR))

# write.csv(fig1_fig2_combined_final_ann2_LIR_autophagyAnn,"C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/Fig1and2_topCandidates_foundLeast1Each_LIRadded_KnownAutophagyAdded.csv",row.names = F)



```




## Figure 3

### YIPF3 proximity

```{r}
# fig3_yip3 <- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/result_files/APEX-YIPF3_ut-3hEBSS_wt-LIRmut.csv")

#fig3_yip3 <- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/result_files/APEX-YIPF3-median-norm.csv")

##PA
fig3_yip3 <- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/YIPF3-apex.csv")

yipf3_list<-c("GABARAPL1", "CALCOCO1", "SQSTM1", "WIPI2", "CALCOCO2", "OPTN", "TAX1BP1", "ATG4B", "ATG3")
  
  # c("NCOA4","CCPG1","TEX264","GABARAPL2", "MAP1LC3B2", "YIPF4", "YIPF3", "SQSTM1", "CALCOCO1", "ULK1","WIPI2","TAX1BP1","SQSTM1","RB1CC1","GABARAP","ZFYVE1","GABARAPL1")



supp3a <- ggplot()+geom_vline(xintercept = -log2(1.5),linetype="dashed")+geom_vline(xintercept = log2(1.5),linetype="dashed")+geom_hline(yintercept = -log10(0.05),linetype="dashed")+
  geom_point(data= fig3_yip3%>%dplyr::filter(Gene.Symbol %!in% yipf3_list ), aes(log2FC_1_control_EBSS.0_control_UT,-log10(q.val_1_control_EBSS.0_control_UT)),alpha=0.1,size=2)+
  geom_point(data=fig3_yip3 %>%dplyr::filter(Gene.Symbol %in% yipf3_list ), aes(log2FC_1_control_EBSS.0_control_UT,-log10(q.val_1_control_EBSS.0_control_UT)),color = "black", shape=21,fill="lightblue",size=2)+
  geom_label_repel(data=fig3_yip3%>%dplyr::filter(Gene.Symbol %in% yipf3_list ), aes(log2FC_1_control_EBSS.0_control_UT,-log10(q.val_1_control_EBSS.0_control_UT),label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+
  theme_classic()+xlim(c(-4,4))+ylim(c(-0,3))+
  labs(x="WT Log2(EBSS+BafA/UT)", y="-Log10(q-value)",title="APEX2-YIPF3")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))

supp3a

supp3c <-  ggplot()+geom_vline(xintercept = -log2(1.5),linetype="dashed")+geom_vline(xintercept = log2(1.5),linetype="dashed")+geom_hline(yintercept = -log10(0.05),linetype="dashed")+
  geom_point(data= fig3_yip3%>%dplyr::filter(Gene.Symbol %!in% yipf3_list ), aes(log2FC_2_LIR_EBSS.2_LIR_UT,-log10(q.val_2_LIR_EBSS.2_LIR_UT)),alpha=0.1,size=2)+
  geom_point(data=fig3_yip3 %>%dplyr::filter(Gene.Symbol %in% yipf3_list ), aes(log2FC_2_LIR_EBSS.2_LIR_UT,-log10(q.val_2_LIR_EBSS.2_LIR_UT)),color = "black", shape=21,fill="lightblue",size=2)+
  geom_label_repel(data=fig3_yip3%>%dplyr::filter(Gene.Symbol %in% yipf3_list ), aes(log2FC_2_LIR_EBSS.2_LIR_UT,-log10(q.val_2_LIR_EBSS.2_LIR_UT),label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+
  theme_classic()+xlim(c(-4,4))+ylim(c(-0,3))+
  labs(x="YIPF3 F47A Log2(EBSS+BafA/UT)", y="-Log10(q-value)",title="APEX2-YIPF3")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))

supp3c
```


### YIPF3 lir dep

```{r}

fig3_yip3_rankUse<-fig3_yip3%>%
  dplyr::mutate(focus_quad = dplyr::if_else(log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT < 0,dplyr::if_else(log2FC_1_control_EBSS.0_control_UT >0,"focus","other" ),"other"),
         LDSloss = log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,
         priority = dplyr::if_else(focus_quad == "focus",dplyr::if_else(abs(LDSloss)>abs(log2FC_1_control_EBSS.0_control_UT),abs(log2FC_1_control_EBSS.0_control_UT),abs(LDSloss)),0))

fig3_yip3<-fig3_yip3%>%
  dplyr::mutate(focus_quad = dplyr::if_else(log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT < 0,dplyr::if_else(log2FC_1_control_EBSS.0_control_UT >0,"focus","other" ),"other"),
         LDSloss = log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,
         priority = dplyr::if_else(focus_quad == "focus",dplyr::if_else(abs(LDSloss)>abs(log2FC_1_control_EBSS.0_control_UT),abs(log2FC_1_control_EBSS.0_control_UT),abs(LDSloss)),0))%>%
  dplyr::filter(LDSloss>-2.8)

supp3e<-ggplot()+geom_vline(xintercept = 0,linetype="dashed")+geom_hline(yintercept = 0,linetype="dashed")+
  geom_point(data=fig3_yip3%>%dplyr::filter(focus_quad == "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),alpha=0.5,color="grey")+
    geom_point(data=fig3_yip3%>%dplyr::filter(focus_quad != "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,color=priority),alpha=0.4)+
  geom_point(data=fig3_yip3%>% dplyr::filter(Gene.Symbol%in% yipf3_list), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),color = "black", shape=21,fill="orange",size=3)+
  geom_label_repel(data=fig3_yip3%>%dplyr::filter(Gene.Symbol %in% yipf3_list ), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+xlim(c(-2.5,2.5))+ylim(c(-1.5,1.5))+theme_classic()+
  labs(x="WT Log2(EBSS+BafA/UT)", y="YIPF3 F47A Log2(EBBS+BafA/UT) - WT Log2(EBBS+BafA/UT)",title="APEX2-YIPF3")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))+scale_color_viridis_c()+scale_y_continuous(breaks=c(-1.5,-1,-0.5,0,0.5,1,1.5),limits=c(-1.5,1.5))

supp3e
  
## zoom
fig3e<-ggplot()+geom_vline(xintercept = 0,linetype="dashed")+geom_hline(yintercept = 0,linetype="dashed")+geom_point(data=fig3_yip3%>%dplyr::filter(focus_quad == "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),alpha=0.5,color="grey")+
    geom_point(data=fig3_yip3%>%dplyr::filter(focus_quad != "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,color=priority),alpha=0.4)+
  geom_point(data=fig3_yip3%>% dplyr::filter(Gene.Symbol%in% yipf3_list), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),color = "black", shape=21,fill="orange",size=3)+
  geom_label_repel(data=fig3_yip3%>%dplyr::filter(Gene.Symbol %in% yipf3_list ), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+xlim(c(0,2.5))+ylim(c(-1.5,0))+theme_classic()+
  labs(x="WT Log2(EBSS+BafA/UT)", y="YIPF3 F47A Log2(EBBS+BafA/UT) - WT Log2(EBBS+BafA/UT)",title="APEX2-YIPF3")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))+scale_color_viridis_c()

fig3e



```




### YIPF4 proximity

```{r}
# fig3_yip4 <- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/result_files/APEX-YIPF4_ut_3hEBSS_wt-LIRmut.csv")
# fig3_yip4 <- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/result_files/APEX-YIPF4_median-norm.csv")


##PA
fig3_yip4 <- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/YIPF4-apex.csv")

yipf4_list<-c("CALCOCO2", "GABARAPL1", "ATG3", "WIPI2",  "RAB5A")



# 
# "NCOA4","CCPG1","TEX264","GABARAPL2", "MAP1LC3B2", "YIPF4", "YIPF3", "SQSTM1", "CALCOCO1", "ULK1","WIPI2","TAX1BP1","SQSTM1","RB1CC1","GABARAP","ZFYVE1","GABARAPL1"

supp3b<-ggplot()+geom_vline(xintercept = -log2(1.5),linetype="dashed")+geom_vline(xintercept = log2(1.5),linetype="dashed")+geom_hline(yintercept = -log10(0.05),linetype="dashed")+
  geom_point(data= fig3_yip4%>%dplyr::filter(Gene.Symbol %!in% yipf4_list ), aes(log2FC_1_control_EBSS.0_control_UT,-log10(q.val_1_control_EBSS.0_control_UT)),alpha=0.1,size=2)+
  geom_point(data=fig3_yip4 %>%dplyr::filter(Gene.Symbol %in% yipf4_list ), aes(log2FC_1_control_EBSS.0_control_UT,-log10(q.val_1_control_EBSS.0_control_UT)),color = "black", shape=21,fill="lightblue",size=2)+
  geom_label_repel(data=fig3_yip4%>%dplyr::filter(Gene.Symbol %in% yipf4_list ), aes(log2FC_1_control_EBSS.0_control_UT,-log10(q.val_1_control_EBSS.0_control_UT),label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+
  theme_classic()+xlim(c(-4,4))+ylim(c(-0,2.5))+
  labs(x="WT Log2(EBSS+BafA/UT)", y="-Log10(q-value)",title="APEX2-YIPF4")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))

supp3b

supp3d<-ggplot()+geom_vline(xintercept = -log2(1.5),linetype="dashed")+geom_vline(xintercept = log2(1.5),linetype="dashed")+geom_hline(yintercept = -log10(0.05),linetype="dashed")+
  geom_point(data= fig3_yip4%>%dplyr::filter(Gene.Symbol %!in% yipf4_list ), aes(log2FC_2_LIR_EBSS.2_LIR_UT,-log10(q.val_2_LIR_EBSS.2_LIR_UT)),alpha=0.1,size=2)+
  geom_point(data=fig3_yip4 %>%dplyr::filter(Gene.Symbol %in% yipf4_list ), aes(log2FC_2_LIR_EBSS.2_LIR_UT,-log10(q.val_2_LIR_EBSS.2_LIR_UT)),color = "black", shape=21,fill="lightblue",size=2)+
  geom_label_repel(data=fig3_yip4%>%dplyr::filter(Gene.Symbol %in% yipf4_list ), aes(log2FC_2_LIR_EBSS.2_LIR_UT,-log10(q.val_2_LIR_EBSS.2_LIR_UT),label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+
  theme_classic()+xlim(c(-4,4))+ylim(c(-0,2.5))+
  labs(x="YIPF4 F17A V20A Log2(EBSS+BafA/UT)", y="-Log10(q-value)",title="APEX2-YIPF4")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))

supp3d
```


### YIPF4 lir dep

```{r}

fig3_yip4_rankUse<-fig3_yip4%>%
  dplyr::mutate(focus_quad = dplyr::if_else(log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT < 0,dplyr::if_else(log2FC_1_control_EBSS.0_control_UT >0,"focus","other" ),"other"),
         LDSloss = log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,
         priority = dplyr::if_else(focus_quad == "focus",dplyr::if_else(abs(LDSloss)>abs(log2FC_1_control_EBSS.0_control_UT),abs(log2FC_1_control_EBSS.0_control_UT),abs(LDSloss)),0))

fig3_yip4<-fig3_yip4%>%
  dplyr::mutate(focus_quad = dplyr::if_else(log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT < 0,if_else(log2FC_1_control_EBSS.0_control_UT >0,"focus","other" ),"other"),
         LDSloss = log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,
         priority = dplyr::if_else(focus_quad == "focus",dplyr::if_else(abs(LDSloss)>abs(log2FC_1_control_EBSS.0_control_UT),abs(log2FC_1_control_EBSS.0_control_UT),abs(LDSloss)),0))%>%
  dplyr::filter(LDSloss>-2.8)

supp3f<-ggplot()+geom_vline(xintercept = 0,linetype="dashed")+geom_hline(yintercept = 0,linetype="dashed")+
  geom_point(data=fig3_yip4%>%dplyr::filter(focus_quad == "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),alpha=0.5,color="grey")+
    geom_point(data=fig3_yip4%>%dplyr::filter(focus_quad != "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,color=priority),alpha=0.4)+
  geom_point(data=fig3_yip4%>% dplyr::filter(Gene.Symbol%in% yipf4_list), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),color = "black", shape=21,fill="orange",size=3)+
  geom_label_repel(data=fig3_yip4%>%dplyr::filter(Gene.Symbol %in% yipf4_list ), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+xlim(c(-2.5,2.5))+ylim(c(-1.5,1.5))+theme_classic()+
  labs(x="WT Log2(EBSS+BafA/UT)", y="YIPF4 F17A V20A Log2(EBBS+BafA/UT) - WT Log2(EBBS+BafA/UT)",title="APEX2-YIPF4")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))+scale_color_viridis_c()+scale_y_continuous(breaks=c(-1.5,-1,-0.5,0,0.5,1,1.5),limits=c(-1.5,1.5))

supp3f
  
## zoom
fig3f<-ggplot()+geom_vline(xintercept = 0,linetype="dashed")+geom_hline(yintercept = 0,linetype="dashed")+geom_point(data=fig3_yip4%>%dplyr::filter(focus_quad == "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),alpha=0.5,color="grey")+
    geom_point(data=fig3_yip4%>%dplyr::filter(focus_quad != "other"), aes(log2FC_1_control_EBSS.0_control_UT,  log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,color=priority),alpha=0.4)+
  geom_point(data=fig3_yip4%>% dplyr::filter(Gene.Symbol%in% yipf4_list), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT),color = "black", shape=21,fill="orange",size=3)+
  geom_label_repel(data=fig3_yip4%>%dplyr::filter(Gene.Symbol %in% yipf4_list ), aes(log2FC_1_control_EBSS.0_control_UT, log2FC_2_LIR_EBSS.2_LIR_UT - log2FC_1_control_EBSS.0_control_UT,label=Gene.Symbol),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=5,alpha=0.75)+xlim(c(0,2.5))+ylim(c(-1.5,0))+theme_classic()+
  labs(x="WT Log2(EBSS+BafA/UT)", y="YIPF4 F17A V20A Log2(EBBS+BafA/UT) - WT Log2(EBBS+BafA/UT)",title="APEX2-YIPF4")+
  theme(axis.text = element_text(size=16),axis.title= element_text(size=18),plot.title = element_text(size=22,hjust=0.5))+scale_color_viridis_c()

fig3f



```


#### figure 3 generation

```{r}


top_sup3<-cowplot::plot_grid(supp3a,supp3b,align="hv", labels=c("A","B"),nrow=1)
mid_sup3<-cowplot::plot_grid(supp3c,supp3d,align="hv", labels=c("C","D"),nrow=1)
bottom_sup3 <- cowplot::plot_grid(supp3e,supp3f,align="hv", labels=c("E","F"),nrow=1 )
sup3<-cowplot::plot_grid(top_sup3,mid_sup3,bottom_sup3,nrow = 3,align="hv")
sup3

# ggsave(sup3,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/supp3_yipf3_yipf4_apex_v2.pdf", width = 13,height = 15)


fig3_row3 <- cowplot::plot_grid(fig3e,fig3f,  labels = c("E","F"),align="hv",nrow=1)

fig3_row3

# ggsave(fig3_row3,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/fig3_yipf3_yipf4_apex_v2.pdf", width = 13,height = 5)
```



## Figure 5 Golgiphagy

### -AA dataset

#### data import

```{r}

### import AA starvation HEK293 experiment

kh_allX<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/HEK293-12h-AA.csv")
 
## extract quant for WT and autophagy KO (+/-AA)
kh_all2<-kh_allX%>%
  tidyr::unite("ProtID", Reference,Gene.Symbol,Annotation, sep="__X__")%>%
  dplyr::select(ProtID, X0_control_1,X0_control_2,X1_control_aa_1,X1_control_aa_2,X1_control_aa_3,
         X2_fip200_1,X2_fip200_2,X3_fip200_aa_1,X3_fip200_aa_2,X3_fip200_aa_3)%>%
  dplyr::ungroup()%>%
  dplyr::distinct()%>%
  dplyr::group_by(ProtID)%>%
  tidyr::gather("sample","log2_int",2:11)%>%
  dplyr::mutate(condition = dplyr::if_else(stringr::str_detect(sample,"control"),dplyr::if_else(stringr::str_detect(sample,"_aa"),"CTL_aa","CTL"),dplyr::if_else(stringr::str_detect(sample,"_aa"),"FIP200_aa","FIP200")))%>%
  tidyr::nest()

## anova t-test function to extract the p-value
anova_test<-function(data){
      df<-data.frame(data)
      test<-aov(log2_int ~ condition, data= df)
      return(summary(test)[[1]][["Pr(>F)"]][1])
    }
# apply anova to all proteins
kh_all2<-kh_all2%>%
  dplyr::mutate(anova_pval = data %>% purrr::map_dbl(anova_test))
# multiple hypothesis correction
kh_all2$anova_qval <- p.adjust(kh_all2$anova_pval,method="BH")
#anova sign. hits
sig<-kh_all2%>%
  dplyr::filter(anova_qval<0.05)


## extract relevant quants for cluster violins
kh_all2X<-kh_allX%>%
  tidyr::unite("ProtID", Reference,Gene.Symbol,Annotation, sep="__X__")%>%
  dplyr::select(ProtID, X0_control_1,X0_control_2,X1_control_aa_1,X1_control_aa_2,X1_control_aa_3,
         X2_fip200_1,X2_fip200_2,X3_fip200_aa_1,X3_fip200_aa_2,X3_fip200_aa_3)%>%
  dplyr::ungroup()%>%
  dplyr::distinct()%>%
  dplyr::group_by(ProtID)%>%
  tidyr::gather("cond_rep","log2_int",2:11)%>%
  dplyr::mutate(condition = dplyr::if_else(stringr::str_detect(cond_rep,"control"),dplyr::if_else(stringr::str_detect(cond_rep,"_aa"),"CTL_aa","CTL"),dplyr::if_else(stringr::str_detect(cond_rep,"_aa"),"FIP200_aa","FIP200")))

### z-score normalize across conditions
heatmap_input<-kh_all2X%>%
      dplyr::ungroup()%>%
      dplyr::group_by(ProtID)%>%
      dplyr::mutate(mean_row = mean(log2_int),
             sd_row = sd(log2_int),
             z_scale = (log2_int - mean_row)/sd_row,
             mean_scale = log2_int - mean_row)

## make matrix of proteins and their z-score values in non-tidy format for pheatmap
heatmap_input2<-heatmap_input%>%
  dplyr::ungroup()%>%
  dplyr::select(ProtID,cond_rep,z_scale)%>%
  dplyr::group_by(ProtID)%>%
  tidyr::spread(cond_rep,z_scale)%>%
  # dplyr::filter(ProtID %in% sig$ProtID)%>%
  tibble::column_to_rownames("ProtID")


# shiny_heat_input_aa<-df4.clust%>%
#   tibble::rownames_to_column("ProtID")

#write.csv(shiny_heat_input_aa,"C:/Harper/Side_analysis/Kelsey_shiny/golgi/ShinyApp/shiny_heat_input_aa.csv",row.names = F)

## produce in tidy format
df4.clust2<-heatmap_input2%>%
  tibble::rownames_to_column("ProtID")%>%
  dplyr::group_by(ProtID)%>%
  tidyr::gather("cond_rep","value",2:11)


### parse protein designation terms and annotate conditions
df_cluster<-df4.clust2%>%
  tidyr::separate(ProtID,c("Reference","Gene.Symbol","Annotation"), sep="__X__")%>%
  dplyr::mutate(condition = dplyr::if_else(stringr::str_detect(cond_rep,"control"),dplyr::if_else(stringr::str_detect(cond_rep,"_aa"),"CTL_aa","CTL"),dplyr::if_else(stringr::str_detect(cond_rep,"_aa"),"FIP200_aa","FIP200")))



```



#### annotate protein locale

```{r}

## add back the annotations on whole data set to include the non-anova sig proteins
ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")

#tidy form annotations for localizations
ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")

###add filter
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  , "Golgi.membrane.associated","Golgi.membrane" ,"Cytosol")

ss_organelle_list<-ss_organelle_list%>%
  filter(Compartment_ss %in% list_compartments)

## Annotate the whole dataframe for organelles
complete_df_ann<-dplyr::left_join(kh_allX,ss_organelle_list,by="Gene.Symbol")
###extract dataframe for the annotation and remove clustering from previous analysis (which included all the plex conditions: distinct removes ones that have different cluster designations between two clustering approaches; this retains only the designations from the autophagy KO and WT clustering)
# complete_df_ann<-complete_df_ann%>%
#   dplyr::select(-cluster_all)%>%
#   dplyr::distinct()
# 
# 
# ### Give all non-anova significant hits the designation of cluster=0 
# complete_df_ann$cluster[is.na(complete_df_ann$cluster)] <- 0

#write.csv(complete_df_ann,"C:/Harper/Side_analysis/Kelsey_shiny/golgi/ShinyApp/shiny_stats_aa.csv",row.names = F)

## ensure 1 unique cluster annotation (compartments result in duplicates in its tidy format)
match_annotation<-complete_df_ann%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,cluster)%>%
  dplyr::distinct()



```


#### proteasome and ribosome

```{r}
proteasome_prots<-c("PSMA1",
"PSMA2",
"PSMA3",
"PSMA4",
"PSMA5",
"PSMA6",
"PSMA7",
"PSMB1",
"PSMB2",
"PSMB3",
"PSMB4",
"PSMB5",
"PSMB6",
"PSMB7",
"PSMC1",
"PSMC2",
"PSMC3",
"PSMC4",
"PSMC5",
"PSMC6",
"PSMD1",
"PSMD10",
"PSMD11",
"PSMD12",
"PSMD13",
"PSMD14",
"PSMD2",
"PSMD3",
"PSMD4",
"PSMD5",
"PSMD6",
"PSMD7",
"PSMD8",
"PSMD9",
"PSME1",
"PSME2",
"PSME3",
"PSME4",
"PSMG1",
"PSMA1",
"PSMA2",
"PSMA3",
"PSMA4",
"PSMA5",
"PSMA6",
"PSMA7",
"PSMB1",
"PSMB2",
"PSMB3",
"PSMB4",
"PSMB5",
"PSMB6",
"PSMB7",
"PSMC1",
"PSMC2",
"PSMC3",
"PSMC4",
"PSMC5",
"PSMC6",
"PSMD1",
"PSMD10",
"PSMD11",
"PSMD12",
"PSMD13",
"PSMD14",
"PSMD2",
"PSMD3",
"PSMD4",
"PSMD5",
"PSMD6",
"PSMD7",
"PSMD8",
"PSMD9",
"PSME1",
"PSME2",
"PSME3",
"PSME4",
"PSMG1")

ribo_prot<-c("RPL10",
"RPL10A",
"RPL11",
"RPL12",
"RPL13",
"RPL13A",
"RPL14",
"RPL15",
"RPL17",
"RPL18",
"RPL18A",
"RPL19",
"RPL21",
"RPL22",
"RPL22L1",
"RPL23",
"RPL23A",
"RPL24",
"RPL26",
"RPL26L1",
"RPL27",
"RPL27A",
"RPL28",
"RPL29",
"RPL3",
"RPL30",
"RPL31",
"RPL32",
"RPL34",
"RPL35",
"RPL35A",
"RPL36",
"RPL36A",
"RPL36AL",
"RPL37",
"RPL37A",
"RPL38",
"RPL4",
"RPL5",
"RPL6",
"RPL7",
"RPL7A",
"RPL7L1",
"RPL8",
"RPL9",
"RPLP0",
"RPLP2",
"RPS10",
"RPS11",
"RPS12",
"RPS13",
"RPS14",
"RPS15",
"RPS15A",
"RPS16",
"RPS17",
"RPS18",
"RPS19",
"RPS19BP1",
"RPS2",
"RPS20",
"RPS21",
"RPS23",
"RPS24",
"RPS25",
"RPS26",
"RPS27",
"RPS27A",
"RPS27L",
"RPS28",
"RPS29",
"RPS3",
"RPS3A",
"RPS4X",
"RPS5",
"RPS6",
"RPS6KA1",
"RPS6KA3",
"RPS6KA4",
"RPS6KC1",
"RPS7",
"RPS8",
"RPS9",
"RPSA",
"RPL10",
"RPL10A",
"RPL11",
"RPL12",
"RPL13",
"RPL13-PS6",
"RPL13A",
"RPL14",
"RPL15",
"RPL17",
"RPL17-PS8",
"RPL18",
"RPL18A",
"RPL19",
"RPL21",
"RPL22",
"RPL23",
"RPL24",
"RPL26",
"RPL27",
"RPL27A",
"RPL28",
"RPL3",
"RPL30",
"RPL31",
"RPL32L",
"RPL34-PS2",
"RPL35",
"RPL35A",
"RPL36-PS12",
"RPL36AL",
"RPL37",
"RPL37A",
"RPL38",
"RPL4",
"RPL5",
"RPL6",
"RPL6L",
"RPL7",
"RPL7A",
"RPL7L1",
"RPL8",
"RPL9",
"RPLP0",
"RPLP2",
"RPS10",
"RPS11",
"RPS12",
"RPS13",
"RPS14",
"RPS15",
"RPS15A",
"RPS16",
"RPS17",
"RPS18",
"RPS19",
"RPS19BP1",
"RPS2",
"RPS20",
"RPS21",
"RPS23",
"RPS24",
"RPS25",
"RPS26",
"RPS27A",
"RPS27L",
"RPS28",
"RPS29",
"RPS3",
"RPS5",
"RPS6",
"RPS6KA1",
"RPS6KA3",
"RPS6KA4",
"RPS6KC1",
"RPS7",
"RPS8",
"RPS9",
"RPSA")

list_autophagy <- c(
  "ACBD5","AMBRA1","ATG10","ATG101","ATG12",
  "ATG13","ATG14","ATG16L1","ATG2A","ATG2B",
  "ATG3","ATG4A","ATG4B","ATG4C","ATG5",
  "ATG7","ATG9A","BAG3","BCL2L13","BECN1",
  "BNIP3L","CALCOCO2","CCPG1","CDK5RAP3","CHMP2B",
  "CHMP4B","EGFR","EIF4G1","ERBB2","FUNDC1",
  "FYCO1","GABARAP","GABARAPL2","GOPC","HDAC6",
  "HGS","HIF1A","HSPA8","ITGB1","LGALS3",
  "LGALS8","MAP1LC3A","MAP1LC3B","MTOR","NBR1",
  "NCOA4","NLRX1","OPTN","PEX13","PEX14",
  "PEX3","PEX5","PIK3C3","PIK3R4","PINK1",
  "PLEKHM1","PRKN","PTEN","RAB11A","RAB1A",
  "RAB24","RAB33B","RAB5A","RAB7A","RAC1",
  "RB1CC1","RETREG1","RPTOR","RUBCN","SH3GLB1",
  "SIRT1","SIRT2","SQSTM1","STBD1","STK11",
  "STX17","TAX1BP1","TBK1","TEX264","TM9SF1",
  "TOLLIP","TRIM5","TSC2","ULK1","ULK2",
  "UVRAG","WDFY3","WDR45","WDR45B","WIPI1",
  "WIPI2","ZFYVE1")

top30_factors<-c("MAP1LC3B2",
"GABARAPL2",
"CCPG1",
"RAB18",
"TEX264",
"RAB32",
"YIPF4",
"SQSTM1",
"GOLIM4",
"ATG2A",
"RAB3D",
"BSCL2",
"FN1",
"PDXDC1",
"CHM",
"CHML",
"RAB3A",
"SEC62",
"CALCOCO1",
"NDUFA8",
"RETSAT",
"SYAP1",
"RABGAP1",
"RHEB",
"ATG2B",
"FYCO1",
"FAM177A1",
"SLC35A1",
"RAB29",
"MFSD12")

known_list<-c("GABARAPL1", "GABARAP", "GABARAPL2", "MAP1LC3B2", "MAP1LC3C", "MAP1LC3A", "SQSTM1", "CCPG1", "TEX264", "SEC62", "RETREG1", "CALCOCO1", "RETREG2", "RETREG3", "OPTN", "ATL3", "RTN3L")

```


### top10 proteome profiling chi analysis

```{r}

# write.csv(df_cluster,"C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/CARGO_Cellular_Autophagy_Regulation_GOlgiphagy/hek293_fig5_minAA_FIP200_Zscores.csv")

# write.csv(complete_df_ann,"C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/CARGO_Cellular_Autophagy_Regulation_GOlgiphagy/hek293_fig5_minAA_FIP200_complete_df_ann.csv")

df_clust_known<-df_cluster%>%
  dplyr::filter(Gene.Symbol %in% known_list)%>%
  dplyr::distinct(Reference,Gene.Symbol,Annotation,cond_rep,value)%>%
  dplyr::mutate(condition = stringr::str_sub(cond_rep,1,-3))%>%
  dplyr::group_by(Reference, Gene.Symbol,Annotation,condition)%>%
  dplyr::summarise(median_value=median(value))%>%
  dplyr::ungroup()%>%
  dplyr::group_by(condition)%>%
  dplyr::summarise(median_condition = median(median_value))


df_clust_known2<-df_cluster%>%
  dplyr::filter(Gene.Symbol %in% known_list)%>%
  dplyr::distinct(Reference,Gene.Symbol,Annotation,cond_rep,value)%>%
  dplyr::mutate(condition = stringr::str_sub(cond_rep,1,-3))%>%
  dplyr::group_by(Reference, Gene.Symbol,Annotation,condition)%>%
  dplyr::mutate(median_value=median(value))%>%
  dplyr::ungroup()%>%
  dplyr::group_by(condition)%>%
  dplyr::mutate(median_condition = median(median_value))

df_clust_known3<-df_cluster%>%
  dplyr::filter(Gene.Symbol %in% known_list)%>%
  dplyr::distinct(Reference,Gene.Symbol,Annotation,cond_rep,value)%>%
  dplyr::mutate(condition = stringr::str_sub(cond_rep,1,-3))




df_clust_known2<-df_clust_known2%>%
  dplyr::distinct(cond_rep,condition,median_condition)

df_clust_known2$index <- c(1,2,3,4,5,6,7,8,9,10)

df_cluster_data<-df_cluster%>%
  # dplyr::filter(Gene.Symbol %in% fig1_fig2_combined_final_ann2_LIR_autophagyAnn$Gene.Symbol[1:30])%>%
  dplyr::distinct(Reference,Gene.Symbol,Annotation,cond_rep,value)%>%
  dplyr::mutate(condition = stringr::str_sub(cond_rep,1,-3))%>%
  dplyr::left_join(.,df_clust_known,by="condition")%>%
  dplyr::mutate(sq_residual = (median_condition - value)^2)%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation)%>%
  dplyr::summarise(RSS = sum(sq_residual),
            RMSE = sqrt(RSS/10))



known_res<-df_cluster_data%>%
  dplyr::filter(Gene.Symbol %in% known_list)

# cutoff<-quantile(known_res$RMSE,0.9)
cutoff<-quantile(df_cluster_data$RMSE,0.1)

candidates<-df_cluster_data%>%
  dplyr::filter(RMSE < cutoff)

known_list_RMSE_AA <- df_cluster_data%>%
  dplyr::filter(Gene.Symbol %in% known_list)%>%
  dplyr::arrange(RMSE)

#### compartment version

## add back the annotations on whole data set to include the non-anova sig proteins
ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")

#tidy form annotations for localizations
ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")

###add filter
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  , "Golgi.membrane.associated","Golgi.membrane" ,"Cytosol")

ss_organelle_list<-ss_organelle_list%>%
  dplyr::filter(Compartment_ss %in% list_compartments)

## Annotate the whole dataframe for organelles
df_cluster_data2<-dplyr::left_join(df_cluster_data,ss_organelle_list,by="Gene.Symbol")


compartment_density<-ggplot()+geom_vline(data=df_cluster_data%>%dplyr::filter(Gene.Symbol %in% known_list),aes(xintercept=RMSE),color="black",linetype="dashed",size=0.1,alpha=0.2)+
  geom_density(data=df_cluster_data%>%dplyr::filter(Gene.Symbol %in% known_list),aes(RMSE),color="darkgrey",size=0.75)+
  theme_classic()+labs(color="cluster")+
  facet_wrap(.~Compartment_ss)+theme(legend.position="none")+
  geom_density(data=df_cluster_data2%>%dplyr::filter( !is.na(Compartment_ss)),aes(RMSE, color=Compartment_ss),size=1)+geom_vline(xintercept = cutoff,size=0.75)

compartment_density

# ggsave(compartment_density, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/SuppFig6Z_compartment_RMSE_distributions_AA.pdf",width = 8,height=5)


## generate profile traces for candidate proteins
knowntype_profile<-ggplot()+
  geom_violin(data=df_cluster%>%dplyr::mutate(color_cond =dplyr::if_else(stringr::str_detect(condition,"CTL"),"CTL","FIP200"),line_cond =dplyr::if_else(stringr::str_detect(condition,"aa"),"NoAA","AA"))%>%dplyr::filter(line_cond=="AA", Gene.Symbol %in% known_list),aes(cond_rep,value,color=color_cond,group=cond_rep,fill=color_cond),draw_quantiles = c(0.5),alpha=0.15,size=1)+
  geom_violin(data=df_cluster%>%dplyr::mutate(color_cond =dplyr::if_else(stringr::str_detect(condition,"CTL"),"CTL","FIP200"),line_cond =dplyr::if_else(stringr::str_detect(condition,"aa"),"NoAA","AA"))%>%dplyr::filter(line_cond=="AA", Gene.Symbol %in% known_list),aes(cond_rep,value,color=color_cond,group=cond_rep,fill=color_cond),draw_quantiles = c(0.25,0.75),alpha=0.15,size=0.5)+
  geom_violin(data=df_cluster%>%dplyr::mutate(color_cond =dplyr::if_else(stringr::str_detect(condition,"CTL"),"CTL","FIP200"),line_cond =dplyr::if_else(stringr::str_detect(condition,"aa"),"NoAA","AA"))%>%dplyr::filter(line_cond!="AA", Gene.Symbol %in% known_list),aes(cond_rep,value,color=color_cond,group=cond_rep,fill=color_cond),draw_quantiles = c(0.5),alpha=0,size=1)+geom_violin(data=df_cluster%>%dplyr::mutate(color_cond =dplyr::if_else(stringr::str_detect(condition,"CTL"),"CTL","FIP200"),line_cond =dplyr::if_else(stringr::str_detect(condition,"aa"),"NoAA","AA"))%>%dplyr::filter(line_cond!="AA", Gene.Symbol %in% known_list),aes(cond_rep,value,color=color_cond,group=cond_rep,fill=color_cond),draw_quantiles = c(0.25,0.75),alpha=0,size=0.5)+
  theme_classic()+labs(x="",y="z-score")+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_hline(yintercept = 0,linetype="dashed")+scale_color_viridis_d(end=0.4)+theme(legend.position = "none")+scale_linetype_manual(values = c(1,11))+scale_fill_viridis_d(end=0.4)+theme(axis.ticks.length = unit(.25, "cm"))
## export cluster 2 profile (-AA)



knowntype_profile

# ggsave(top30_profile, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/Fig5X_top30only_profiles_aa_v1.pdf",width = 6,height=4)




top10based_candidates_profile<-ggplot()+geom_violin(data=df_cluster%>%dplyr::mutate(color_cond =dplyr::if_else(stringr::str_detect(condition,"CTL"),"CTL","FIP200"),line_cond =dplyr::if_else(stringr::str_detect(condition,"aa"),"NoAA","AA"))%>%dplyr::filter(line_cond=="AA", Reference %in% candidates$Reference),aes(cond_rep,value,color=color_cond,group=cond_rep,fill=color_cond),draw_quantiles = c(0.5),alpha=0.15,size=1)+geom_violin(data=df_cluster%>%dplyr::mutate(color_cond =dplyr::if_else(stringr::str_detect(condition,"CTL"),"CTL","FIP200"),line_cond =dplyr::if_else(stringr::str_detect(condition,"aa"),"NoAA","AA"))%>%dplyr::filter(line_cond=="AA", Reference %in% candidates$Reference),aes(cond_rep,value,color=color_cond,group=cond_rep,fill=color_cond),draw_quantiles = c(0.25,0.75),alpha=0.15,size=0.5)+geom_violin(data=df_cluster%>%dplyr::mutate(color_cond=dplyr::if_else(stringr::str_detect(condition,"CTL"),"CTL","FIP200"),line_cond=dplyr::if_else(stringr::str_detect(condition,"aa"),"NoAA","AA"))%>%dplyr::filter(line_cond!="AA", Reference %in% candidates$Reference),aes(cond_rep,value,color=color_cond,group=cond_rep,fill=color_cond),draw_quantiles = c(0.5),alpha=0,size=1)+geom_violin(data=df_cluster%>%dplyr::mutate(color_cond =dplyr::if_else(stringr::str_detect(condition,"CTL"),"CTL","FIP200"),line_cond =dplyr::if_else(stringr::str_detect(condition,"aa"),"NoAA","AA"))%>%dplyr::filter(line_cond!="AA", Reference %in% candidates$Reference),aes(cond_rep,value,color=color_cond,group=cond_rep,fill=color_cond),draw_quantiles = c(0.25,0.75),alpha=0,size=0.5)+theme_classic()+labs(x="",y="z-score")+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_hline(yintercept = 0,linetype="dashed")+scale_color_viridis_d(end=0.4)+theme(legend.position = "none")+scale_linetype_manual(values = c(1,11))+scale_fill_viridis_d(end=0.4)+theme(axis.ticks.length = unit(.25, "cm"))+geom_segment(data=df_clust_known2,aes(x=index-0.5, xend=index+0.5,y=median_condition,yend=median_condition),size=1,color="navy",linetype=2)

top10based_candidates_profile

# ggsave(top10based_candidates_profile, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/Fig5Y_top10percKnown_candidates_profiles_aa_v1.pdf",width = 6,height=4)

df_clust_known4<-df_clust_known2%>%
  select(-index)%>%
  dplyr::distinct(condition,median_condition)

df_clust_known4$index <- c(1,2,3,4)

known_profile_plot<-ggplot(df_clust_known3, aes(condition, value,color=Gene.Symbol))+geom_jitter(width=0.2, alpha=0.2,size=4)+geom_segment(data=df_clust_known4,aes(x=index-0.5, xend=index+0.5,y=median_condition,yend=median_condition),size=1,color="navy",linetype=2)+theme_classic()+labs(x="",y="z-score",color="")+theme(axis.title = element_text(size=18), axis.text = element_text(size = 16),legend.text = element_text(size=11),legend.position = "top")

known_profile_plot

# ggsave(known_profile_plot, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/SuppFig5G_KnownProfile_aa_v1.pdf",width = 7,height=7)

### ribosome proteasome




pos_neg_control_error<-ggplot()+
  geom_density(data=df_cluster_data%>%dplyr::filter(Gene.Symbol %in% ribo_prot)%>%dplyr::mutate(grouping = "Ribosome"),aes(RMSE,color=grouping),size=1)+
  geom_density(data=df_cluster_data%>%dplyr::filter(Reference %in% candidates$Reference)%>%dplyr::mutate(grouping = "Candidates"),aes(RMSE,color=grouping),size=1)+
  geom_density(data=df_cluster_data2%>%dplyr::filter(Compartment_ss == "Nucleus")%>%dplyr::mutate(grouping = "Nucleus"),aes(RMSE,color=grouping),size=1)+
  geom_density(data=df_cluster_data2%>%dplyr::filter(Gene.Symbol %in% list_autophagy)%>%dplyr::mutate(grouping = "Autophagy"),aes(RMSE,color=grouping),size=1)+
  geom_density(data=df_cluster_data%>%dplyr::filter(Gene.Symbol %in% top30_factors)%>%dplyr::mutate(grouping = "Top30"),aes(RMSE,color=grouping),size=1)+
  geom_density(data=df_cluster_data%>%dplyr::filter(Gene.Symbol %in% known_list)%>%dplyr::mutate(grouping = "Known"),aes(RMSE,color=grouping),size=1)+
  theme_classic()+geom_vline(xintercept = cutoff,size=2)+labs(color="")+theme(axis.title = element_text(size=18), axis.text = element_text(size = 16))+
  geom_vline(data=df_cluster_data%>%dplyr::filter(Gene.Symbol %in% known_list),aes(xintercept=RMSE),color="grey",linetype="dashed",size=0.5,alpha=0.75)+
  geom_density(data=df_cluster_data%>%dplyr::mutate(grouping = "All"),aes(RMSE,color=grouping),size=1)

pos_neg_control_error

# ggsave(pos_neg_control_error, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/Fig5X_RMSE_distributions_AA_PosNegControls.pdf",width = 12,height=7)


  
```

```{r}
complete_df_ann_DS5<-complete_df_ann%>%
  mutate(candidates = dplyr::if_else(Reference %in% candidates$Reference, "Candidates","NotCandidate"))
write.csv(complete_df_ann_DS5, "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/DataS5_FIP200_AA_fig56.csv")
```

#### Compartment top10 based candidates

```{r}

## Compartment analysis 
## representation of the cytosol protein representation within the two clusters
not_cytosol <-  c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  )

list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome" ,"Cytosol"  )

fish<-complete_df_ann%>%
  dplyr::select(Gene.Symbol,Reference,cluster,Compartment_ss)%>%
  dplyr::mutate(top10cand = dplyr::if_else(Reference %in% candidates$Reference, "top10cand","other"),
         Compartment2 = dplyr::if_else(Compartment_ss %in% not_cytosol, "Other Compartment",dplyr::if_else(Compartment_ss == "Cytosol", "Cytosol","other2")),
         Compartment2 = stringr::str_replace_all(Compartment2,"\\."," "))%>%
  dplyr::group_by(top10cand,Compartment2)%>%
  dplyr::summarise(count=n())%>%
  dplyr::filter(Compartment2 != "other2")



fish_top10cand<-fish%>%
  dplyr::filter(top10cand == "top10cand")
fish_other<-fish%>%
  dplyr::filter(top10cand != "top10cand")

#export 6 by 10

pie(fish_top10cand$count, labels = fish_top10cand$Compartment2, main="Candidate 'Autophagy' proteins (-AA)",col = c("lightgreen","#C9EBEF","#FCADB0","#69A6D1"
                                                                           ,"#D3D3D3","#CBAACB",
                                                                           "#FFD4B1","#C29BA3",
                                                                           "#FFFFB5","#FFCCB6",
                                                                           "#F3B0C3"))

pie(fish_other$count, labels = fish_other$Compartment2, main="Other proteins (-AA)",col =c("lightgreen","#C9EBEF","#FCADB0",
                                                                                     "#69A6D1","#D3D3D3",
                                                                                     "#CBAACB",
                                                                           "#FFD4B1","#C29BA3",
                                                                           "#FFFFB5","#FFCCB6",
                                                                           "#F3B0C3"))




#### all locales minus cytosol

list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"   )

fish<-complete_df_ann%>%
  dplyr::select(Gene.Symbol,Reference,cluster,Compartment_ss)%>%
  dplyr::mutate(top10cand = dplyr::if_else(Reference %in% candidates$Reference, "top10cand","other"),
         Compartment2 = dplyr::if_else(Compartment_ss%in% list_compartments, Compartment_ss,"other"),
         Compartment2 = stringr::str_replace_all(Compartment2,"\\."," "))%>%
  dplyr::group_by(top10cand,Compartment2)%>%
  dplyr::summarise(count=n())%>%
  dplyr::filter(Compartment2 != "other")



fish_top10cand<-fish%>%dplyr::filter(top10cand == "top10cand")
fish_other<-fish%>%dplyr::filter(top10cand != "top10cand")


# remove color "#CBAACB", because mito is missing


pie(fish_top10cand$count, labels = fish_top10cand$Compartment2, main="Candidate 'Autophagy' proteins (-AA)",col = c("#C9EBEF","#FCADB0","#69A6D1"
                                                                           ,"#D3D3D3","#CBAACB",
                                                                           "#FFD4B1","#C29BA3",
                                                                           "#FFFFB5","#FFCCB6",
                                                                           "#F3B0C3"))

pie(fish_other$count, labels = fish_other$Compartment2, main="Other proteins (-AA)",col =c("#C9EBEF","#FCADB0",
                                                                                     "#69A6D1","#D3D3D3",
                                                                                     "#CBAACB",
                                                                           "#FFD4B1","#C29BA3",
                                                                           "#FFFFB5","#FFCCB6",
                                                                           "#F3B0C3"))







## golgi split 


list_compartments<- c("Golgi.membrane.associated","Golgi.membrane"  )

fish<-complete_df_ann%>%
  dplyr::select(Gene.Symbol,Reference,cluster,Compartment_ss)%>%
  dplyr::mutate(top10cand = dplyr::if_else(Reference %in% candidates$Reference, "top10cand","other"),
         Compartment2 = dplyr::if_else(Compartment_ss%in% list_compartments, Compartment_ss,"other"),
         Compartment2 = stringr::str_replace_all(Compartment2,"\\."," "))%>%
  dplyr::group_by(top10cand,Compartment2)%>%
  dplyr::summarise(count=n())%>%
  dplyr::filter(Compartment2 != "other")



fish_top10cand<-fish%>%
  dplyr::filter(top10cand == "top10cand")
fish_other<-fish%>%
  dplyr::filter(top10cand != "top10cand")

pie(fish_top10cand$count, labels = fish_top10cand$Compartment2, main="Candidate 'Autophagy' proteins (-AA)",col = c("#69A6D1","#D2E1E6"))

pie(fish_other$count, labels = fish_other$Compartment2, main="Other proteins (-AA)",col = c("#69A6D1","#D2E1E6"))


```



### GO enrichment 



#### GO based on top10

```{r}

goinput_start<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/human_mouse_go.csv")%>%
  dplyr::mutate(GO=dplyr::if_else(stringr::str_sub(GO,1,1)==" ",stringr::str_sub(GO,2,-1),GO))%>%
  dplyr::filter(GO != "")

go.df <- goinput_start%>%
      dplyr::filter(organism == "human")%>%
      dplyr::select(-organism)



filt_ttest2<-kh_allX%>%
    dplyr::ungroup()%>%
    dplyr::mutate(set = dplyr::if_else(Reference %in% candidates$Reference, "sig","n.s."))%>%
    tidyr::separate(Reference,into = c("type","Reference","Description"),sep="\\|")%>%
    dplyr::select(Reference,set)

  
  
  
df.bg <- filt_ttest2 %>% 
  dplyr::distinct(Reference) %>% 
  dplyr::left_join(go.df) %>% 
  dplyr::mutate(all = dplyr::n_distinct(Reference)) %>% 
  dplyr::group_by(GO,GO_cat) %>% 
  dplyr::summarise("pos" = dplyr::n_distinct(Reference),
            "neg" = all - pos) %>% 
  dplyr::distinct() %>% 
  dplyr::mutate(selection="background") %>% 
  dplyr::ungroup()


go.df <- df.bg %>%
  dplyr::select(GO,GO_cat) %>%
  dplyr::left_join(go.df)


df.fg <- filt_ttest2 %>%  
  dplyr::mutate(selection = "foreground") %>% 
  dplyr::distinct(Reference, selection, set) %>% 
  dplyr::right_join(go.df) %>% 
  dplyr::group_by(selection, set) %>% 
  dplyr::mutate(term_all = dplyr::n_distinct(Reference)) %>% 
  dplyr::group_by(GO,GO_cat, selection, set) %>% 
  dplyr::summarise("pos" = dplyr::n_distinct(Reference),
            "neg" = term_all - pos) %>% 
  dplyr::ungroup() %>% 
  dplyr::filter(set == "sig")%>%
  dplyr::distinct()

df.nest <- df.bg %>% dplyr::left_join(df.fg %>% dplyr::distinct(GO,GO_cat, set)) %>% 
  dplyr::distinct() %>% 
  dplyr::full_join(df.fg) %>% 
  tidyr::drop_na(set) %>% 
  tidyr::drop_na(GO) %>% 
  dplyr::distinct() %>% 
  dplyr::group_by(GO,GO_cat, set) %>% 
  tidyr::nest() 


exact_pval_fun<-function(data){
  dataframe<-data.frame(data) %>%
    tibble::column_to_rownames(var = "selection")
  matrix<-as.matrix(dataframe) 
  exact_test_result<-fisher.test(matrix, alternative = "two.sided")
  return(exact_test_result$p.value)
}

## function to perform fisher test and get enrichment
enrich_fun<-function(data){
  dataframe<-data.frame(data) %>% 
    dplyr::mutate(frac = pos/neg) %>% 
    dplyr::select(-c(pos,neg)) %>% 
    tidyr::pivot_wider(names_from = selection, values_from = frac) %>% 
    dplyr::summarise(enrichment = foreground/background) 
  
  return(dataframe$enrichment[1])
}


fish.df <- df.nest %>% 
  dplyr::mutate(p.val = data %>% purrr::map_dbl(exact_pval_fun)) %>% #calc p val
  dplyr::mutate(enrich = data %>% purrr::map_dbl(enrich_fun)) %>%   #calc enrichment
  dplyr::select(-c(data)) %>%
  dplyr::filter(GO != "")%>%
  dplyr::arrange(p.val)
# print("fifth")


fish.df$p.val.adj <- p.adjust(fish.df$p.val,method="fdr")

fish.df<-fish.df%>%
  dplyr::arrange(p.val.adj)%>%    
  tibble::rownames_to_column("GORank")%>%
  dplyr::mutate(GORank=as.numeric(as.character(GORank)))


fish.df.sig<-fish.df%>%
  dplyr::mutate(sig_GO = dplyr::if_else(p.val.adj<0.05,"sig","n.s."))%>%
  dplyr::mutate(GO_id = stringr::str_sub(GO,-11,-2),
         GO_shrink1 = stringr::str_sub(GO,1,-13),
         GO_shrink = stringr::str_sub(GO_shrink1,1,70))

fish.df.sig$GO_cat <- factor(fish.df.sig$GO_cat, levels = c("molecular_function","cellular_component","biological_process"))
  
  
ggplot(fish.df.sig,  aes(enrich, -log10(p.val.adj), color=sig_GO,label=GO_id,label1=GO_shrink,key=GORank))+geom_point(alpha=0.75)+theme_classic()+
    geom_hline(yintercept = -log10(0.05))+scale_color_viridis_d(end=0.8)+ 
    labs(x="Enrichment", y="-log10(q-value)",title=paste("Cluster ",2, sep=""))+
    theme(axis.title = element_text(size=20),axis.text = element_text(size = 18))




GO_sig<-ggplot(fish.df.sig[1:6,],  aes(reorder(GO_shrink, p.val.adj, FUN=median),-log10(p.val.adj), size=enrich,color=GO_cat,key=GORank))+
      geom_point()+theme_classic()+coord_flip()+
      scale_color_viridis_d(end=0.8)+ 
      labs(x="GO terms", y="-log10(q-value)",title=paste("Cluster ",2, sep=""))+
      theme(axis.title = element_text(size=16),axis.text = element_text(size = 12))+
  scale_size( range = c(1, 4))+theme(legend.title = element_blank())

fish.df.sig2<-fish.df.sig%>%
  dplyr::arrange(p.val.adj)

# write.csv(fish.df.sig2,"C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/CARGO_Cellular_Autophagy_Regulation_GOlgiphagy/fig5_fip200_aa_GOterms.csv")


go_slimed_top6<-fish.df.sig[1:10,]%>%
  dplyr::arrange(p.val.adj)



GO_sig<-ggplot(go_slimed_top6,  aes(reorder(GO_shrink, p.val.adj, FUN=median),-log10(p.val.adj)))+
      geom_col()+theme_classic()+coord_flip()+
      labs(x="GO terms", y="-log10(q-value)",title=paste("Candidate \'Autophagy\' Proteins (-AA)"))+
      theme(axis.title = element_text(size=16),axis.text = element_text(size = 12))+theme(legend.title = element_blank())+ylim(c(0,22))+geom_hline(yintercept = -log10(0.05),linetype="dashed")

  
GO_sig

# ggsave(GO_sig, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/Fig5D1a_AA_top30basedAutophagy_top10_GOterms_withoutEnrichmentNum_v2_.pdf",width = 7,height=6)


```





## EBSS dataset

### ebss data import

```{r}

kh_allX_EBSS<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/HEK293_12h_EBSS.csv")

## extract quant for WT and autophagy KO (+/-AA)
kh_all2_EBSS<-kh_allX_EBSS%>%
  tidyr::unite("ProtID", Reference,Gene.Symbol,Annotation, sep="__X__")%>%
  dplyr::select(ProtID, X0_control_1,X0_control_2,X1_control_EBSS_1,X1_control_EBSS_2,X1_control_EBSS_3,
         X2_ATG7.KO_1,X2_ATG7.KO_2,X3_ATG7.KO_EBSS_1,X3_ATG7.KO_EBSS_2,X3_ATG7.KO_EBSS_3)%>%
  dplyr::ungroup()%>%
  dplyr::distinct()%>%
  dplyr::group_by(ProtID)%>%
  tidyr::gather("sample","log2_int",2:11)%>%
  dplyr::mutate(condition = dplyr::if_else(stringr::str_detect(sample,"control"),dplyr::if_else(stringr::str_detect(sample,"_EBSS"),"CTL_EBSS","CTL"),dplyr::if_else(stringr::str_detect(sample,"_EBSS"),"ATG7_EBSS","ATG7")))%>%
  tidyr::nest()

## anova t-test function to extract the p-value
anova_test<-function(data){
      df<-data.frame(data)
      test<-aov(log2_int ~ condition, data= df)
      return(summary(test)[[1]][["Pr(>F)"]][1])
    }
# apply anova to all proteins
kh_all2_EBSS<-kh_all2_EBSS%>%
  dplyr::mutate(anova_pval = data %>% purrr::map_dbl(anova_test))
# multiple hypothesis correction
kh_all2_EBSS$anova_qval <- p.adjust(kh_all2_EBSS$anova_pval,method="BH")
#anova sign. hits
sig_EBSS<-kh_all2_EBSS%>%
  dplyr::filter(anova_qval<0.05)


## extract relevant quants for cluster violins
kh_all2X_EBSS<-kh_allX_EBSS%>%
  tidyr::unite("ProtID", Reference,Gene.Symbol,Annotation, sep="__X__")%>%
  dplyr::select(ProtID,X0_control_1,X0_control_2,X1_control_EBSS_1,X1_control_EBSS_2,X1_control_EBSS_3,
         X2_ATG7.KO_1,X2_ATG7.KO_2,X3_ATG7.KO_EBSS_1,X3_ATG7.KO_EBSS_2,X3_ATG7.KO_EBSS_3)%>%
  dplyr::ungroup()%>%
  dplyr::distinct()%>%
  dplyr::group_by(ProtID)%>%
  tidyr::gather("cond_rep","log2_int",2:11)%>%
  dplyr::mutate(condition = dplyr::if_else(stringr::str_detect(cond_rep,"control"),dplyr::if_else(stringr::str_detect(cond_rep,"_EBSS"),"CTL_EBSS","CTL"),dplyr::if_else(stringr::str_detect(cond_rep,"_EBSS"),"ATG7_EBSS","ATG7")))

### z-score normalize across conditions
heatmap_input_EBSS<-kh_all2X_EBSS%>%
      dplyr::ungroup()%>%
      dplyr::group_by(ProtID)%>%
      dplyr::mutate(mean_row = mean(log2_int),
             sd_row = sd(log2_int),
             z_scale = (log2_int - mean_row)/sd_row,
             mean_scale = log2_int - mean_row)

## make matrix of proteins and their z-score values in non-tidy format for pheatmap
heatmap_input2_EBSS<-heatmap_input_EBSS%>%
  dplyr::ungroup()%>%
  dplyr::select(ProtID,cond_rep,z_scale)%>%
  dplyr::group_by(ProtID)%>%
  tidyr::spread(cond_rep,z_scale)%>%
  # dplyr::filter(ProtID %in% sig$ProtID)%>%
  tibble::column_to_rownames("ProtID")


## generate matrix with the addition of the cluster annotation to z-score values
# df4.clust <- cbind(heatmap_input2,
#                    cluster = cutree(heatmap_export$tree_row,
#                                     k = 6))
# shiny_heat_input_aa<-df4.clust%>%
#   tibble::rownames_to_column("ProtID")

#write.csv(shiny_heat_input_aa,"C:/Harper/Side_analysis/Kelsey_shiny/golgi/ShinyApp/shiny_heat_input_aa.csv",row.names = F)

## produce in tidy format
df4.clust2_EBSS<-heatmap_input2_EBSS%>%
  tibble::rownames_to_column("ProtID")%>%
  dplyr::group_by(ProtID)%>%
  tidyr::gather("cond_rep","value",2:11)


### parse protein designation terms and annotate conditions
df_cluster_EBSS<-df4.clust2_EBSS%>%
  tidyr::separate(ProtID,c("Reference","Gene.Symbol","Annotation"), sep="__X__")%>%
  dplyr::mutate(condition = dplyr::if_else(stringr::str_detect(cond_rep,"control"),dplyr::if_else(stringr::str_detect(cond_rep,"_EBSS"),"CTL_EBSS","CTL"),dplyr::if_else(stringr::str_detect(cond_rep,"_EBSS"),"ATG7_EBSS","ATG7")))




```


### Annotate Protein locale

```{r}
## add back the annotations on whole data set to include the non-anova sig proteins
ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")

#tidy form annotations for localizations
ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")

###add filter
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  , "Golgi.membrane.associated","Golgi.membrane" ,"Cytosol")

ss_organelle_list<-ss_organelle_list%>%
  dplyr::filter(Compartment_ss %in% list_compartments)

## Annotate the whole dataframe for organelles
complete_df_ann_EBSS<-dplyr::left_join(kh_allX_EBSS,ss_organelle_list,by="Gene.Symbol")
###extract dataframe for the annotation and remove clustering from previous analysis (which included all the plex conditions: distinct removes ones that have different cluster designations between two clustering approaches; this retains only the designations from the autophagy KO and WT clustering)
# complete_df_ann<-complete_df_ann%>%
#   dplyr::select(-cluster_all)%>%
#   dplyr::distinct()
# 
# 
# ### Give all non-anova significant hits the designation of cluster=0 
# complete_df_ann$cluster[is.na(complete_df_ann$cluster)] <- 0

#write.csv(complete_df_ann,"C:/Harper/Side_analysis/Kelsey_shiny/golgi/ShinyApp/shiny_stats_aa.csv",row.names = F)

## ensure 1 unique cluster annotation (compartments result in duplicates in its tidy format)
match_annotation_EBSS<-complete_df_ann_EBSS%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,cluster)%>%
  dplyr::distinct()
```


### top10 proteome profiling chi analysis

```{r}

top30_factors<-c("MAP1LC3B2",
"GABARAPL2",
"CCPG1",
"RAB18",
"TEX264",
"RAB32",
"YIPF4",
"SQSTM1",
"GOLIM4",
"ATG2A",
"RAB3D",
"BSCL2",
"FN1",
"PDXDC1",
"CHM",
"CHML",
"RAB3A",
"SEC62",
"CALCOCO1",
"NDUFA8",
"RETSAT",
"SYAP1",
"RABGAP1",
"RHEB",
"ATG2B",
"FYCO1",
"FAM177A1",
"SLC35A1",
"RAB29",
"MFSD12")

known_list<-c("GABARAPL1", "GABARAP", "GABARAPL2", "MAP1LC3B2", "MAP1LC3C", "MAP1LC3A", "SQSTM1", "CCPG1", "TEX264", "SEC62", "RETREG1", "CALCOCO1", "RETREG2", "RETREG3", "OPTN", "ATL3", "RTN3L")


# write.csv(df_cluster_EBSS,"C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/CARGO_Cellular_Autophagy_Regulation_GOlgiphagy/hek293_fig5_EBSS_ATG7_Zscores.csv")


df_clust_known_EBSS<-df_cluster_EBSS%>%
  dplyr::filter(Gene.Symbol %in% known_list)%>%
  dplyr::distinct(Reference,Gene.Symbol,Annotation,cond_rep,value)%>%
  dplyr::mutate(condition = stringr::str_sub(cond_rep,1,-3))%>%
  dplyr::group_by(Reference, Gene.Symbol,Annotation,condition)%>%
  dplyr::summarise(median_value=median(value))%>%
  dplyr::ungroup()%>%
  dplyr::group_by(condition)%>%
  dplyr::summarise(median_condition = median(median_value))

df_clust_known2_EBSS<-df_cluster_EBSS%>%
  dplyr::filter(Gene.Symbol %in% known_list)%>%
  dplyr::distinct(Reference,Gene.Symbol,Annotation,cond_rep,value)%>%
  dplyr::mutate(condition = stringr::str_sub(cond_rep,1,-3))%>%
  dplyr::group_by(Reference, Gene.Symbol,Annotation,condition)%>%
  dplyr::mutate(median_value=median(value))%>%
  dplyr::ungroup()%>%
  dplyr::group_by(condition)%>%
  dplyr::mutate(median_condition = median(median_value))

df_clust_known3_EBSS<-df_cluster_EBSS%>%
  dplyr::filter(Gene.Symbol %in% known_list)%>%
  dplyr::distinct(Reference,Gene.Symbol,Annotation,cond_rep,value)%>%
  dplyr::mutate(condition = stringr::str_sub(cond_rep,1,-3))



df_clust_known2_EBSS<-df_clust_known2_EBSS%>%
  dplyr::distinct(cond_rep,condition,median_condition)

df_clust_known2_EBSS$index <- c(1,2,3,4,5,6,7,8,9,10)

df_cluster_data_EBSS<-df_cluster_EBSS%>%
  # dplyr::filter(Gene.Symbol %in% fig1_fig2_combined_final_ann2_LIR_autophagyAnn$Gene.Symbol[1:30])%>%
  dplyr::distinct(Reference,Gene.Symbol,Annotation,cond_rep,value)%>%
  dplyr::mutate(condition = stringr::str_sub(cond_rep,1,-3))%>%
  dplyr::left_join(.,df_clust_known_EBSS,by="condition")%>%
  dplyr::mutate(sq_residual = (median_condition - value)^2)%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation)%>%
  dplyr::summarise(RSS = sum(sq_residual),
            RMSE = sqrt(RSS/10))

# ggplot()+geom_density(data=df_cluster_data,aes(RMSE, color=factor(cluster)),size=1.5)+geom_density(data=df_cluster_data%>%dplyr::filter(Gene.Symbol %in% known_list),aes(RMSE),color="black",linetype="dashed",size=1.5)+theme_classic()

known_res_EBSS<-df_cluster_data_EBSS%>%
  dplyr::filter(Gene.Symbol %in% known_list)

# cutoff_EBSS<-quantile(known_res_EBSS$RMSE,0.9)

cutoff_EBSS<-quantile(df_cluster_data_EBSS$RMSE,0.1)

candidates_EBSS<-df_cluster_data_EBSS%>%
  dplyr::filter(RMSE < cutoff_EBSS)


known_list_RMSE_EBSS <- df_cluster_data_EBSS%>%
  dplyr::filter(Gene.Symbol %in% known_list)%>%
  dplyr::arrange(RMSE)
  

#### compartment version

## add back the annotations on whole data set to include the non-anova sig proteins
ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")

#tidy form annotations for localizations
ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")

###add filter
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  , "Golgi.membrane.associated","Golgi.membrane" ,"Cytosol")

ss_organelle_list<-ss_organelle_list%>%
  filter(Compartment_ss %in% list_compartments)

## Annotate the whole dataframe for organelles
df_cluster_data2_EBSS<-dplyr::left_join(df_cluster_data_EBSS,ss_organelle_list,by="Gene.Symbol")




compartment_density<-ggplot()+geom_vline(data=df_cluster_data_EBSS%>%dplyr::filter(Gene.Symbol %in% known_list),aes(xintercept=RMSE),color="black",linetype="dashed",size=0.1,alpha=0.2)+geom_density(data=df_cluster_data_EBSS%>%dplyr::filter(Gene.Symbol %in% known_list),aes(RMSE),color="darkgrey",size=0.75)+theme_classic()+labs(color="cluster")+facet_wrap(.~Compartment_ss)+theme(legend.position="none")+geom_density(data=df_cluster_data2_EBSS%>%dplyr::filter( !is.na(Compartment_ss)),aes(RMSE, color=Compartment_ss),size=1)+geom_vline(xintercept = cutoff_EBSS,size=0.75)

compartment_density

# ggsave(compartment_density, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/SuppFig6Z_compartment_RMSE_distributions_EBSS.pdf",width = 8,height=5)




top10based_candidates_profile<-ggplot()+geom_violin(data=df_cluster_EBSS%>%dplyr::mutate(color_cond =dplyr::if_else(stringr::str_detect(condition,"CTL"),"CTL","ATG7"),line_cond =dplyr::if_else(stringr::str_detect(condition,"EBSS"),"EBSS","NoEBSS"))%>%dplyr::filter(line_cond!="EBSS", Reference %in% candidates_EBSS$Reference),aes(cond_rep,value,color=color_cond,group=cond_rep,fill=color_cond),draw_quantiles = c(0.5),alpha=0.15,size=1)+geom_violin(data=df_cluster_EBSS%>%dplyr::mutate(color_cond =dplyr::if_else(stringr::str_detect(condition,"CTL"),"CTL","ATG7"),line_cond =dplyr::if_else(stringr::str_detect(condition,"EBSS"),"EBSS","NoEBSS"))%>%dplyr::filter(line_cond!="EBSS", Reference %in% candidates_EBSS$Reference),aes(cond_rep,value,color=color_cond,group=cond_rep,fill=color_cond),draw_quantiles = c(0.25,0.75),alpha=0.15,size=0.5)+geom_violin(data=df_cluster_EBSS%>%dplyr::mutate(color_cond=dplyr::if_else(stringr::str_detect(condition,"CTL"),"CTL","ATG7"),line_cond=dplyr::if_else(stringr::str_detect(condition,"EBSS"),"EBSS","NoEBSS"))%>%dplyr::filter(line_cond=="EBSS", Reference %in% candidates_EBSS$Reference),aes(cond_rep,value,color=color_cond,group=cond_rep,fill=color_cond),draw_quantiles = c(0.5),alpha=0,size=1)+geom_violin(data=df_cluster_EBSS%>%dplyr::mutate(color_cond =dplyr::if_else(stringr::str_detect(condition,"CTL"),"CTL","ATG7"),line_cond =dplyr::if_else(stringr::str_detect(condition,"EBSS"),"EBSS","NoEBSS"))%>%dplyr::filter(line_cond=="EBSS", Reference %in% candidates_EBSS$Reference),aes(cond_rep,value,color=color_cond,group=cond_rep,fill=color_cond),draw_quantiles = c(0.25,0.75),alpha=0,size=0.5)+theme_classic()+labs(x="",y="z-score")+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+geom_hline(yintercept = 0,linetype="dashed")+scale_color_viridis_d(end=0.4)+theme(legend.position = "none")+scale_linetype_manual(values = c(1,11))+scale_fill_viridis_d(end=0.4)+theme(axis.ticks.length = unit(.25, "cm"))+geom_segment(data=df_clust_known2_EBSS,aes(x=index-0.5, xend=index+0.5,y=median_condition,yend=median_condition),size=1,color="navy",linetype=2)


top10based_candidates_profile

# ggsave(top10based_candidates_profile, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/Fig5Y_top10percKnown_candidates_profiles_ebss_v1.pdf",width = 6,height=4)

  
  
### ribosome proteasome

list_autophagy <- c(
  "ACBD5","AMBRA1","ATG10","ATG101","ATG12",
  "ATG13","ATG14","ATG16L1","ATG2A","ATG2B",
  "ATG3","ATG4A","ATG4B","ATG4C","ATG5",
  "ATG7","ATG9A","BAG3","BCL2L13","BECN1",
  "BNIP3L","CALCOCO2","CCPG1","CDK5RAP3","CHMP2B",
  "CHMP4B","EGFR","EIF4G1","ERBB2","FUNDC1",
  "FYCO1","GABARAP","GABARAPL2","GOPC","HDAC6",
  "HGS","HIF1A","HSPA8","ITGB1","LGALS3",
  "LGALS8","MAP1LC3A","MAP1LC3B","MTOR","NBR1",
  "NCOA4","NLRX1","OPTN","PEX13","PEX14",
  "PEX3","PEX5","PIK3C3","PIK3R4","PINK1",
  "PLEKHM1","PRKN","PTEN","RAB11A","RAB1A",
  "RAB24","RAB33B","RAB5A","RAB7A","RAC1",
  "RB1CC1","RETREG1","RPTOR","RUBCN","SH3GLB1",
  "SIRT1","SIRT2","SQSTM1","STBD1","STK11",
  "STX17","TAX1BP1","TBK1","TEX264","TM9SF1",
  "TOLLIP","TRIM5","TSC2","ULK1","ULK2",
  "UVRAG","WDFY3","WDR45","WDR45B","WIPI1",
  "WIPI2","ZFYVE1")



df_clust_known4_EBSS<-df_clust_known2_EBSS%>%
  select(-index)%>%
  dplyr::distinct(condition,median_condition)

df_clust_known4_EBSS$index <- c(1,2,3,4)

known_profile_plot<-ggplot(df_clust_known3_EBSS, aes(condition, value,color=Gene.Symbol))+geom_jitter(width=0.2, alpha=0.2,size=4)+geom_segment(data=df_clust_known4_EBSS,aes(x=index-0.5, xend=index+0.5,y=median_condition,yend=median_condition),size=1,color="navy",linetype=2)+theme_classic()+labs(x="",y="z-score",color="")+theme(axis.title = element_text(size=18), axis.text = element_text(size = 16),legend.text = element_text(size=11),legend.position = "top")

known_profile_plot

# ggsave(known_profile_plot, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/SuppFig5B_KnownProfile_ebss_v1.pdf",width = 7,height=7)





pos_neg_control_error<-ggplot()+
  # geom_vline(data=df_cluster_data%>%dplyr::filter(Gene.Symbol %in% top30_factors),aes(xintercept=RMSE),color="black",linetype="dashed",size=0.15,alpha=0.2)+
  geom_density(data=df_cluster_data_EBSS%>%dplyr::filter(Gene.Symbol %in% ribo_prot)%>%dplyr::mutate(grouping = "Ribosome"),aes(RMSE,color=grouping),size=1)+
  geom_density(data=df_cluster_data_EBSS%>%dplyr::filter(Reference %in% candidates_EBSS$Reference)%>%dplyr::mutate(grouping = "Candidates"),aes(RMSE,color=grouping),size=1)+
  geom_density(data=df_cluster_data2_EBSS%>%dplyr::filter(Compartment_ss == "Nucleus")%>%dplyr::mutate(grouping = "Nucleus"),aes(RMSE,color=grouping),size=1)+
  geom_density(data=df_cluster_data_EBSS%>%dplyr::filter(Gene.Symbol %in% list_autophagy)%>%dplyr::mutate(grouping = "Autophagy"),aes(RMSE,color=grouping),size=1)+
  geom_density(data=df_cluster_data_EBSS%>%dplyr::filter(Gene.Symbol %in% top30_factors)%>%dplyr::mutate(grouping = "Top30"),aes(RMSE,color=grouping),size=1)+
  geom_density(data=df_cluster_data_EBSS%>%dplyr::filter(Gene.Symbol %in% known_list)%>%dplyr::mutate(grouping = "Known"),aes(RMSE,color=grouping),size=1)+
  theme_classic()+geom_vline(xintercept = cutoff_EBSS,size=2)+labs(color="")+
  theme(axis.title = element_text(size=18), axis.text = element_text(size = 16))+
  geom_vline(data=df_cluster_data_EBSS%>%dplyr::filter(Gene.Symbol %in% known_list),aes(xintercept=RMSE),color="grey",linetype="dashed",size=0.5,alpha=0.75)+
  geom_density(data=df_cluster_data_EBSS%>%dplyr::mutate(grouping = "All"),aes(RMSE,color=grouping),size=1)

pos_neg_control_error

# ggsave(pos_neg_control_error, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/Fig5X_RMSE_distributions_ebss_PosNegControls.pdf",width = 12,height=7)

  
```



```{r}
complete_df_ann_EBSS_DS5<-complete_df_ann_EBSS%>%
  mutate(candidates = dplyr::if_else(Reference %in% candidates_EBSS$Reference, "Candidates","NotCandidate"))
write.csv(complete_df_ann_EBSS_DS5, "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/DataS5B_ATG7_EBSS_fig56.csv")
```


#### Compartment top10 based candidates

```{r}

## Compartment analysis 
## representation of the cytosol protein representation within the two clusters
not_cytosol <-  c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  )

list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome" ,"Cytosol"  )

fish<-complete_df_ann_EBSS%>%
  dplyr::select(Gene.Symbol,Reference,cluster,Compartment_ss)%>%
  dplyr::mutate(top10cand = dplyr::if_else(Reference %in% candidates_EBSS$Reference, "top10cand","other"),
         Compartment2 = dplyr::if_else(Compartment_ss %in% not_cytosol, "Other Compartment",dplyr::if_else(Compartment_ss == "Cytosol", "Cytosol","other2")),
         Compartment2 = stringr::str_replace_all(Compartment2,"\\."," "))%>%
  dplyr::group_by(top10cand,Compartment2)%>%
  dplyr::summarise(count=n())%>%
  dplyr::filter(Compartment2 != "other2")



fish_top10cand<-fish%>%
  dplyr::filter(top10cand == "top10cand")
fish_other<-fish%>%
  dplyr::filter(top10cand != "top10cand")

#export 6 by 10

pie(fish_top10cand$count, labels = fish_top10cand$Compartment2, main="Candidate 'Autophagy' proteins (EBSS)",col = c("lightgreen","#C9EBEF","#FCADB0","#69A6D1"
                                                                           ,"#D3D3D3","#CBAACB",
                                                                           "#FFD4B1","#C29BA3",
                                                                           "#FFFFB5","#FFCCB6",
                                                                           "#F3B0C3"))

pie(fish_other$count, labels = fish_other$Compartment2, main="Other proteins (EBSS)",col =c("lightgreen","#C9EBEF","#FCADB0",
                                                                                     "#69A6D1","#D3D3D3",
                                                                                     "#CBAACB",
                                                                           "#FFD4B1","#C29BA3",
                                                                           "#FFFFB5","#FFCCB6",
                                                                           "#F3B0C3"))




#### all locales minus cytosol

list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"   )

fish<-complete_df_ann_EBSS%>%
  dplyr::select(Gene.Symbol,Reference,cluster,Compartment_ss)%>%
  dplyr::mutate(top10cand = dplyr::if_else(Reference %in% candidates_EBSS$Reference, "top10cand","other"),
         Compartment2 = dplyr::if_else(Compartment_ss%in% list_compartments, Compartment_ss,"other"),
         Compartment2 = stringr::str_replace_all(Compartment2,"\\."," "))%>%
  dplyr::group_by(top10cand,Compartment2)%>%
  dplyr::summarise(count=n())%>%
  dplyr::filter(Compartment2 != "other")



fish_top10cand<-fish%>%
  dplyr::filter(top10cand == "top10cand")
fish_other<-fish%>%
  dplyr::filter(top10cand != "top10cand")


# remove color "#CBAACB", because mito is missing


pie(fish_top10cand$count, labels = fish_top10cand$Compartment2, main="Candidate 'Autophagy' proteins (EBSS)",col = c("#C9EBEF","#FCADB0","#69A6D1"
                                                                           ,"#D3D3D3","#CBAACB",
                                                                           "#FFD4B1","#C29BA3",
                                                                           "#FFFFB5","#FFCCB6",
                                                                           "#F3B0C3"))

pie(fish_other$count, labels = fish_other$Compartment2, main="Other proteins (EBSS)",col =c("#C9EBEF","#FCADB0",
                                                                                     "#69A6D1","#D3D3D3",
                                                                                     "#CBAACB",
                                                                           "#FFD4B1","#C29BA3",
                                                                           "#FFFFB5","#FFCCB6",
                                                                           "#F3B0C3"))







## golgi split 


list_compartments<- c("Golgi.membrane.associated","Golgi.membrane"  )

fish<-complete_df_ann_EBSS%>%
  dplyr::select(Gene.Symbol,Reference,cluster,Compartment_ss)%>%
  dplyr::mutate(top10cand = dplyr::if_else(Reference %in% candidates_EBSS$Reference, "top10cand","other"),
         Compartment2 = dplyr::if_else(Compartment_ss%in% list_compartments, Compartment_ss,"other"),
         Compartment2 = stringr::str_replace_all(Compartment2,"\\."," "))%>%
  dplyr::group_by(top10cand,Compartment2)%>%
  dplyr::summarise(count=n())%>%
  dplyr::filter(Compartment2 != "other")



fish_top10cand<-fish%>%
  dplyr::filter(top10cand == "top10cand")
fish_other<-fish%>%
  dplyr::filter(top10cand != "top10cand")

pie(fish_top10cand$count, labels = fish_top10cand$Compartment2, main="Candidate 'Autophagy' proteins (EBSS)",col = c("#69A6D1","#D2E1E6"))

pie(fish_other$count, labels = fish_other$Compartment2, main="Other proteins (EBSS)",col = c("#69A6D1","#D2E1E6"))


```



#### GO based on top10

```{r}


goinput_start<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/human_mouse_go.csv")%>%
  dplyr::mutate(GO=dplyr::if_else(stringr::str_sub(GO,1,1)==" ",stringr::str_sub(GO,2,-1),GO))%>%
  dplyr::filter(GO != "")

go.df <- goinput_start%>%
      dplyr::filter(organism == "human")%>%
      dplyr::select(-organism)



filt_ttest2<-kh_allX_EBSS%>%
    dplyr::ungroup()%>%
    dplyr::mutate(set = dplyr::if_else(Reference %in% candidates_EBSS$Reference, "sig","n.s."))%>%
    tidyr::separate(Reference,into = c("type","Reference","Description"),sep="\\|")%>%
    dplyr::select(Reference,set)

  
  
df.bg <- filt_ttest2 %>% 
  dplyr::distinct(Reference) %>% 
  dplyr::left_join(go.df) %>% 
  dplyr::mutate(all = dplyr::n_distinct(Reference)) %>% 
  dplyr::group_by(GO,GO_cat) %>% 
  dplyr::summarise("pos" = dplyr::n_distinct(Reference),
            "neg" = all - pos) %>% 
  dplyr::distinct() %>% 
  dplyr::mutate(selection="background") %>% 
  dplyr::ungroup()


go.df <- df.bg %>%
  dplyr::select(GO,GO_cat) %>%
  dplyr::left_join(go.df)


df.fg <- filt_ttest2 %>%  
  dplyr::mutate(selection = "foreground") %>% 
  dplyr::distinct(Reference, selection, set) %>% 
  dplyr::right_join(go.df) %>% 
  dplyr::group_by(selection, set) %>% 
  dplyr::mutate(term_all = dplyr::n_distinct(Reference)) %>% 
  dplyr::group_by(GO,GO_cat, selection, set) %>% 
  dplyr::summarise("pos" = dplyr::n_distinct(Reference),
            "neg" = term_all - pos) %>% 
  dplyr::ungroup() %>% 
  dplyr::filter(set == "sig")%>%
  dplyr::distinct()

df.nest <- df.bg %>% dplyr::left_join(df.fg %>% dplyr::distinct(GO,GO_cat, set)) %>% 
  dplyr::distinct() %>% 
  dplyr::full_join(df.fg) %>% 
  tidyr::drop_na(set) %>% 
  tidyr::drop_na(GO) %>% 
  dplyr::distinct() %>% 
  dplyr::group_by(GO,GO_cat, set) %>% 
  tidyr::nest() 


exact_pval_fun<-function(data){
  dataframe<-data.frame(data) %>%
    tibble::column_to_rownames(var = "selection")
  matrix<-as.matrix(dataframe) 
  exact_test_result<-fisher.test(matrix, alternative = "two.sided")
  return(exact_test_result$p.value)
}

## function to perform fisher test and get enrichment
enrich_fun<-function(data){
  dataframe<-data.frame(data) %>% 
    dplyr::mutate(frac = pos/neg) %>% 
    dplyr::select(-c(pos,neg)) %>% 
    tidyr::pivot_wider(names_from = selection, values_from = frac) %>% 
    dplyr::summarise(enrichment = foreground/background) 
  
  return(dataframe$enrichment[1])
}


fish.df <- df.nest %>% 
  dplyr::mutate(p.val = data %>% purrr::map_dbl(exact_pval_fun)) %>% #calc p val
  dplyr::mutate(enrich = data %>% purrr::map_dbl(enrich_fun)) %>%   #calc enrichment
  dplyr::select(-c(data)) %>%
  dplyr::filter(GO != "")%>%
  dplyr::arrange(p.val)
# print("fifth")


fish.df$p.val.adj <- p.adjust(fish.df$p.val,method="fdr")

fish.df<-fish.df%>%
  dplyr::arrange(p.val.adj)%>%    
  tibble::rownames_to_column("GORank")%>%
  dplyr::mutate(GORank=as.numeric(as.character(GORank)))


fish.df.sig<-fish.df%>%
  dplyr::mutate(sig_GO = dplyr::if_else(p.val.adj<0.05,"sig","n.s."))%>%
  dplyr::mutate(GO_id = stringr::str_sub(GO,-11,-2),
         GO_shrink1 = stringr::str_sub(GO,1,-13),
         GO_shrink = stringr::str_sub(GO_shrink1,1,70))

fish.df.sig$GO_cat <- factor(fish.df.sig$GO_cat, levels = c("molecular_function","cellular_component","biological_process"))
  
  
ggplot(fish.df.sig,  aes(enrich, -log10(p.val.adj), color=sig_GO,label=GO_id,label1=GO_shrink,key=GORank))+geom_point(alpha=0.75)+theme_classic()+
    geom_hline(yintercept = -log10(0.05))+scale_color_viridis_d(end=0.8)+ 
    labs(x="Enrichment", y="-log10(q-value)",title=paste("Cluster ",2, sep=""))+
    theme(axis.title = element_text(size=20),axis.text = element_text(size = 18))




GO_sig<-ggplot(fish.df.sig[1:6,],  aes(reorder(GO_shrink, p.val.adj, FUN=median),-log10(p.val.adj), size=enrich,color=GO_cat,key=GORank))+
      geom_point()+theme_classic()+coord_flip()+
      scale_color_viridis_d(end=0.8)+ 
      labs(x="GO terms", y="-log10(q-value)",title=paste("Cluster ",2, sep=""))+
      theme(axis.title = element_text(size=16),axis.text = element_text(size = 12))+
  scale_size( range = c(1, 4))+theme(legend.title = element_blank())


fish.df.sig2<-fish.df.sig%>%
  dplyr::arrange(p.val.adj)

# write.csv(fish.df.sig2,"C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/CARGO_Cellular_Autophagy_Regulation_GOlgiphagy/fig5_atg7_ebss_GOterms.csv")


go_slimed_top6<-fish.df.sig[1:10,]%>%
  dplyr::arrange(p.val.adj)



GO_sig<-ggplot(go_slimed_top6,  aes(reorder(GO_shrink, p.val.adj, FUN=median),-log10(p.val.adj)))+
      geom_col()+theme_classic()+coord_flip()+
      labs(x="GO terms", y="-log10(q-value)",title=paste("Candidate \'Autophagy\' Proteins (-AA)"))+
      theme(axis.title = element_text(size=16),axis.text = element_text(size = 12))+theme(legend.title = element_blank())+ylim(c(0,22))+geom_hline(yintercept = -log10(0.05),linetype="dashed")

  
GO_sig

# ggsave(GO_sig, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/Fig5D2a_EBSS_top30basedAutophagy_top10_GOterms_withoutEnrichmentNum_v2_.pdf",width = 7,height=6)


```


## Overlap -AA and EBSS



### Overlap AA and EBSS candidates

```{r}

AA_join<-kh_allX%>%
  dplyr::select(Reference,Gene.Symbol)%>%
  dplyr::distinct()%>%
  dplyr::filter(Reference %in% candidates$Reference )%>%
  dplyr::mutate(sig = "sig")



EBSS_join<-kh_allX_EBSS%>%
  dplyr::select(Reference,Gene.Symbol)%>%
  dplyr::distinct()%>%
  dplyr::filter(Reference %in% candidates_EBSS$Reference )%>%
  dplyr::mutate(sig = "sig")



AA_EBSS_join <- dplyr::full_join(AA_join ,EBSS_join , by=c("Reference","Gene.Symbol"),
                           suffix=c("_AA","_EBSS"))%>%
  dplyr::select(sig_AA,sig_EBSS)



AA_EBSS_join <- (AA_EBSS_join == "sig")

a<-as.matrix(AA_EBSS_join)
    
a[is.na(a)] = F

a[a == "sig"] = T


v = gsub("sig_","",colnames(a)) #Specific nomenclature
library(eulerr)
fit = eulerr::euler(a)
    #brewer.pal(ncol(a),"Set3")
plot(fit,
               quantities = list(cex = 0.5),
               adjust_labels=T,
               labels = list(labels=v, font = 12, cex=1),
               main = paste("Candidate Proteins Overlap"))


AA_EBSS_join2 <- dplyr::full_join(AA_join ,EBSS_join , by=c("Reference","Gene.Symbol"),
                           suffix=c("_AA","_EBSS"))



ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")



ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")


###added
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"   )

ss_organelle_list<-ss_organelle_list%>%
  filter(Compartment_ss %in% list_compartments)
###
AA_EBSS_join3<-dplyr::left_join(AA_EBSS_join2,ss_organelle_list,by="Gene.Symbol")

# write.csv(AA_EBSS_join3, "C:/Harper/Side_analysis/Kelsey_shiny/golgi/Final_manuscript/AA_c2_EBSS_c3_AutophagyCluster.csv")



fish<-AA_EBSS_join3%>%
  dplyr::mutate(sig_EBSS= dplyr::if_else(is.na(sig_EBSS),"n.s.",sig_EBSS),
         sig_AA= dplyr::if_else(is.na(sig_AA),"n.s.",sig_AA),
         overlap = dplyr::if_else(sig_AA == "sig", dplyr::if_else( sig_EBSS == "sig" ,"Overlap","NoOverlap"),"NoOverlap"),
         Compartment2 = dplyr::if_else(Compartment_ss%in% list_compartments, Compartment_ss,"other"),
         Compartment2 = stringr::str_replace_all(Compartment2,"\\."," "))%>%
  dplyr::group_by(overlap,Compartment2)%>%
  dplyr::summarise(count=n())%>%
  dplyr::filter(Compartment2 != "other")



fish_overlap<-fish%>%dplyr::filter(overlap == "Overlap")
fish_notoverlap<-fish%>%dplyr::filter(overlap != "Overlap")


#"#C29BA3",

pie(fish_overlap$count, labels = fish_overlap$Compartment2, main="Overlap (-AA and EBSS)",col = c("#C9EBEF","#FCADB0","#69A6D1"
                                                                           ,"#D3D3D3","#CBAACB",
                                                                           "#FFD4B1",
                                                                           "#FFFFB5","#FFCCB6",
                                                                           "#F3B0C3"))

pie(fish_notoverlap$count, labels = fish_notoverlap$Compartment2, main="Not Overlap (-AA and EBSS)",col =c("#C9EBEF","#FCADB0",
                                                                                     "#69A6D1","#D3D3D3",
                                                                                     "#CBAACB",
                                                                           "#FFD4B1","#C29BA3",
                                                                           "#FFFFB5","#FFCCB6",
                                                                           "#F3B0C3"))




fish2<-AA_EBSS_join3%>%
  dplyr::mutate(sig_EBSS= dplyr::if_else(is.na(sig_EBSS),"n.s.",sig_EBSS),
         sig_AA= dplyr::if_else(is.na(sig_AA),"n.s.",sig_AA),
         overlap = dplyr::if_else(sig_AA == "sig", dplyr::if_else( sig_EBSS == "sig" ,"Overlap","NoOverlap"),"NoOverlap"),
         Compartment2 = dplyr::if_else(Compartment_ss%in% list_compartments, Compartment_ss,"other"),
         Compartment2 = stringr::str_replace_all(Compartment2,"\\."," "))

# fish2%>%filter(overlap == "Overlap")%>%select(Gene.Symbol)

list_compartments4<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome","Cytosol"   )


## all c2 and c3 proteins with localizations
fish3<-AA_EBSS_join3%>%
  dplyr::mutate(sig_EBSS= if_else(is.na(sig_EBSS),"n.s.",sig_EBSS),
         sig_AA= dplyr::if_else(is.na(sig_AA),"n.s.",sig_AA),
         overlap = dplyr::if_else(sig_AA == "sig", dplyr::if_else( sig_EBSS == "sig" ,"Overlap","NoOverlap"),"NoOverlap"),
         Compartment2 = dplyr::if_else(Compartment_ss%in% list_compartments4, Compartment_ss,"other"),
         Compartment2 = stringr::str_replace_all(Compartment2,"\\."," "))%>%
  dplyr::arrange(dplyr::desc(overlap),Compartment2)%>%
  tidyr::separate(Reference, into=c("type","Accession","Name"), sep="\\|")


```


### Overlap by compartments

```{r}


ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")



ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")


###added
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome" ,"Cytosol"  )

ss_organelle_list<-ss_organelle_list%>%
  dplyr::filter(Compartment_ss %in% list_compartments)

### Golgi overlap

AA_EBSS_join_golgi <- dplyr::full_join(AA_join ,EBSS_join , by=c("Reference","Gene.Symbol"),
                           suffix=c("_AA","_EBSS"))%>%
  dplyr::distinct(Reference,Gene.Symbol, sig_AA,sig_EBSS)%>%
  dplyr::left_join(.,ss_organelle_list, by="Gene.Symbol")%>%
  dplyr::filter(Compartment_ss == "Golgi")%>%
  dplyr::distinct(Reference,Gene.Symbol, sig_AA,sig_EBSS)%>%
  dplyr::select(-Gene.Symbol,-Reference)


AA_EBSS_join_golgi <- (AA_EBSS_join_golgi == "sig")

a<-as.matrix(AA_EBSS_join_golgi)
    
a[is.na(a)] = F

a[a == "sig"] = T


v = gsub("sig_","",colnames(a)) #Specific nomenclature
library(eulerr)
fit = eulerr::euler(a)
    #brewer.pal(ncol(a),"Set3")
plot(fit,
               quantities = list(cex = 1.5),
               #fills = list(fill = brewer.pal(ncol(a),"Set3"), alpha = 0.8, cex=0.7),
               # lty = 1:3,
               adjust_labels=T,
               labels = list(labels=v, font = 12, cex=2),
               main = paste("Protein Candidate Overlap Golgi"))


### ER overlap

AA_EBSS_join_ER <- dplyr::full_join(AA_join ,EBSS_join , by=c("Reference","Gene.Symbol"),
                           suffix=c("_AA","_EBSS"))%>%
  dplyr::distinct(Reference,Gene.Symbol, sig_AA,sig_EBSS)%>%
  dplyr::left_join(.,ss_organelle_list, by="Gene.Symbol")%>%
  dplyr::filter(Compartment_ss == "ER")%>%
  dplyr::distinct(Reference,Gene.Symbol, sig_AA,sig_EBSS)%>%
  dplyr::select(-Gene.Symbol,-Reference)


AA_EBSS_join_ER <- (AA_EBSS_join_ER == "sig")

a<-as.matrix(AA_EBSS_join_ER)
    
a[is.na(a)] = F

a[a == "sig"] = T


v = gsub("sig_","",colnames(a)) #Specific nomenclature
library(eulerr)
fit = eulerr::euler(a)
    #brewer.pal(ncol(a),"Set3")
plot(fit,
               quantities = list(cex = 1.5),
               #fills = list(fill = brewer.pal(ncol(a),"Set3"), alpha = 0.8, cex=0.7),
               # lty = 1:3,
               adjust_labels=T,
               labels = list(labels=v, font = 12, cex=2),
               main = paste("Protein Candidate Overlap ER"))


### ER overlap

AA_EBSS_join_cytosol <- dplyr::full_join(AA_join ,EBSS_join , by=c("Reference","Gene.Symbol"),
                           suffix=c("_AA","_EBSS"))%>%
  dplyr::distinct(Reference,Gene.Symbol, sig_AA,sig_EBSS)%>%
  dplyr::left_join(.,ss_organelle_list, by="Gene.Symbol")%>%
  dplyr::filter(Compartment_ss == "Cytosol")%>%
  dplyr::distinct(Reference,Gene.Symbol, sig_AA,sig_EBSS)%>%
  dplyr::select(-Gene.Symbol,-Reference)


AA_EBSS_join_cytosol <- (AA_EBSS_join_cytosol == "sig")

a<-as.matrix(AA_EBSS_join_cytosol)
    
a[is.na(a)] = F

a[a == "sig"] = T


v = gsub("sig_","",colnames(a)) #Specific nomenclature
library(eulerr)
fit = eulerr::euler(a)
    #brewer.pal(ncol(a),"Set3")
plot(fit,
               quantities = list(cex = 1.5),
               #fills = list(fill = brewer.pal(ncol(a),"Set3"), alpha = 0.8, cex=0.7),
               # lty = 1:3,
               adjust_labels=T,
               labels = list(labels=v, font = 12, cex=2),
               main = paste("Protein Candidate Overlap Cytosol"))


### Nucleus overlap 3x4

AA_EBSS_join_nucleus <- dplyr::full_join(AA_join ,EBSS_join , by=c("Reference","Gene.Symbol"),
                           suffix=c("_AA","_EBSS"))%>%
  dplyr::distinct(Reference,Gene.Symbol, sig_AA,sig_EBSS)%>%
  dplyr::left_join(.,ss_organelle_list, by="Gene.Symbol")%>%
  dplyr::filter(Compartment_ss == "Nucleus")%>%
  dplyr::distinct(Reference,Gene.Symbol, sig_AA,sig_EBSS)%>%
  dplyr::select(-Gene.Symbol,-Reference)


AA_EBSS_join_nucleus <- (AA_EBSS_join_nucleus == "sig")

a<-as.matrix(AA_EBSS_join_nucleus)
    
a[is.na(a)] = F

a[a == "sig"] = T


v = gsub("sig_","",colnames(a)) #Specific nomenclature
library(eulerr)
fit = eulerr::euler(a)
    #brewer.pal(ncol(a),"Set3")
plot(fit,
               quantities = list(cex = 1.5),
               adjust_labels=T,
               labels = list(labels=v, font = 12, cex=2),
               main = paste("Protein Candidate Overlap Nucleus"))
```


## Fig 6 YIPF4 abolish the signal

### Candidate data 

```{r}
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  , "Golgi.membrane.associated","Golgi.membrane" ,"Cytosol")


# 

ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")



ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")


###added
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome" ,"Cytosol"  )

ss_organelle_list<-ss_organelle_list%>%
  dplyr::filter(Compartment_ss %in% list_compartments)

#### YIP flux t-test

kh_allX_ann <- dplyr::left_join(kh_allX,ss_organelle_list, by="Gene.Symbol")

candidate_df<-kh_allX_ann%>%
  dplyr::filter(Reference %in% candidates$Reference, Compartment_ss %in% list_compartments )%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,cluster,Compartment_ss, matches("Log2"))%>%
  dplyr::mutate(delta_yipf4flux_minCtlflux = log2FC_5_yipf4_aa.4_yipf4 -  log2FC_1_control_aa.0_control)

nest_compartment<-candidate_df%>%
  dplyr::group_by(Compartment_ss)%>%
  tidyr::nest()

one_sample_ttest<- function(data){
  df<-data.frame(data)
  return(t.test(df$delta_yipf4flux_minCtlflux, mu = 0, alternative = "two.sided")$p.value)
}

nest_compartment<-nest_compartment%>%
  dplyr::mutate(p.value_deltaflux = data %>% purrr::map_dbl(one_sample_ttest))

counts_fun<- function(data){
  df<-data.frame(data)
  return(dim(df)[1])
}


nest_compartment$q.value_deltaflux <- p.adjust(nest_compartment$p.value_deltaflux,method="BH")

nest_compartment<-nest_compartment%>%
  dplyr::mutate(counts_total = data %>% purrr::map_dbl(counts_fun))%>%
  dplyr::arrange(q.value_deltaflux)



### fip200 flux dependence

nest_compartment_fip<-candidate_df%>%
  dplyr::mutate(delta_fip200flux_minCtlflux =log2FC_3_fip200_aa.2_fip200 - log2FC_1_control_aa.0_control)%>%
  dplyr::group_by(Compartment_ss)%>%
  tidyr::nest()

one_sample_ttest_fip<- function(data){
  df<-data.frame(data)
  return(t.test(df$delta_fip200flux_minCtlflux, mu = 0, alternative = "two.sided")$p.value)
}

nest_compartment_fip<-nest_compartment_fip%>%
  dplyr::mutate(p.value_deltaflux = data %>% purrr::map_dbl(one_sample_ttest_fip))

counts_fun<- function(data){
  df<-data.frame(data)
  return(dim(df)[1])
}


nest_compartment_fip$q.value_deltaflux <- p.adjust(nest_compartment_fip$p.value_deltaflux,method="BH")

nest_compartment_fip<-nest_compartment_fip%>%
  dplyr::mutate(counts_total = data %>% purrr::map_dbl(counts_fun))%>%
  dplyr::arrange(q.value_deltaflux)





```

### Point Plot



```{r}


ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")



ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")


###added
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  , "Golgi.membrane.associated","Golgi.membrane" ,"Cytosol")

ss_organelle_list<-ss_organelle_list%>%
  dplyr::filter(Compartment_ss %in% list_compartments)

#### YIP flux t-test

kh_allX_ann <- dplyr::left_join(kh_allX,ss_organelle_list, by="Gene.Symbol")



### extra based on all proteins by compartment



### Figure 6 point plot
med_top10<-kh_allX_ann%>%
  dplyr::filter(Compartment_ss %in% list_compartments )%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,cluster,Compartment_ss, matches("Log2"))%>%
  dplyr::mutate(delta_yipf4flux_minCtlflux = log2FC_5_yipf4_aa.4_yipf4 -  log2FC_1_control_aa.0_control,
         delta_fip200flux_minCtlflux = log2FC_3_fip200_aa.2_fip200 - log2FC_1_control_aa.0_control )%>%
  dplyr::ungroup()%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarise(med_fip200Ct=median(delta_fip200flux_minCtlflux),
            med_yipf4Ct = median(delta_yipf4flux_minCtlflux),
            q1_fip200Ct= quantile(delta_fip200flux_minCtlflux,0.25),
            q3_fip200Ct= quantile(delta_fip200flux_minCtlflux,0.75),
            q1_yipf4Ct= quantile(delta_yipf4flux_minCtlflux,0.25),
            q3_yipf4Ct= quantile(delta_yipf4flux_minCtlflux,0.75),
            num_proteins = n())



med_top10<-med_top10%>%
  dplyr::mutate(Compartment_ss = stringr::str_replace_all(Compartment_ss,"\\.","\\ "),
                Compartment_ss = stringr::str_replace_all(Compartment_ss,"Membrane","membrane"),
                Compartment_ss = stringr::str_replace_all(Compartment_ss,"membrane associated","associated")
                                )



point_plot<-ggplot(med_top10%>%dplyr::mutate(Compartment_ss = stringr::str_replace_all(Compartment_ss,"\\.","\\ ")),aes(med_fip200Ct,med_yipf4Ct,color=Compartment_ss))+geom_point(size=4,alpha=0.6)+geom_segment(aes(x=q1_fip200Ct,xend=q3_fip200Ct,y=med_yipf4Ct,yend=med_yipf4Ct,color=Compartment_ss),alpha=0.5,size=0.5)+geom_segment(aes(x=med_fip200Ct,xend=med_fip200Ct,y=q1_yipf4Ct,yend=q3_yipf4Ct,color=Compartment_ss),alpha=0.5,size=0.5)+xlim(c(-.2,.5))+ylim(c(-.15,.2))+theme_classic()+geom_hline(yintercept = 0,linetype="dashed")+geom_vline(xintercept = 0,linetype="dashed")+geom_text_repel(data=med_top10,aes(med_fip200Ct,med_yipf4Ct,color=Compartment_ss, label=Compartment_ss),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=10)+theme(legend.position = "none",axis.title = element_text(size=14),axis.text = element_text(size=14))+labs(y="YIPF4 KO Log2FC(-AA/UT) - WT Log2FC(-AA/UT)",x="FIP200 KO Log2FC(-AA/UT) - WT Log2FC(-AA/UT)")

point_plot


# ggsave(point_plot, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/SuppFig6Z_ScatterPlot_Compartment_AllProteins_FIP200Ct_YIPF4Ct_v1_50x_v2.pdf",width = 8.5,height=7)

### based on candidates

### Figure 6 point plot
med_top10<-kh_allX_ann%>%
  dplyr::filter(Reference %in% candidates$Reference,Compartment_ss %in% list_compartments )%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,cluster,Compartment_ss, matches("Log2"))%>%
  dplyr::mutate(delta_yipf4flux_minCtlflux = log2FC_5_yipf4_aa.4_yipf4 -  log2FC_1_control_aa.0_control,
         delta_fip200flux_minCtlflux = log2FC_3_fip200_aa.2_fip200 - log2FC_1_control_aa.0_control )%>%
  dplyr::ungroup()%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarise(med_fip200Ct=median(delta_fip200flux_minCtlflux),
            med_yipf4Ct = median(delta_yipf4flux_minCtlflux),
            q1_fip200Ct= quantile(delta_fip200flux_minCtlflux,0.25),
            q3_fip200Ct= quantile(delta_fip200flux_minCtlflux,0.75),
            q1_yipf4Ct= quantile(delta_yipf4flux_minCtlflux,0.25),
            q3_yipf4Ct= quantile(delta_yipf4flux_minCtlflux,0.75),
            num_proteins = n())



med_top10<-med_top10%>%
  dplyr::mutate(Compartment_ss = stringr::str_replace_all(Compartment_ss,"\\.","\\ "),
                Compartment_ss = stringr::str_replace_all(Compartment_ss,"Membrane","membrane"),
                Compartment_ss = stringr::str_replace_all(Compartment_ss,"membrane associated","associated")
                                )



point_plot<-ggplot(med_top10%>%dplyr::mutate(Compartment_ss = stringr::str_replace_all(Compartment_ss,"\\.","\\ ")),aes(med_fip200Ct,med_yipf4Ct,color=Compartment_ss))+geom_point(size=4,alpha=0.6)+geom_segment(aes(x=q1_fip200Ct,xend=q3_fip200Ct,y=med_yipf4Ct,yend=med_yipf4Ct,color=Compartment_ss),alpha=0.5,size=0.5)+geom_segment(aes(x=med_fip200Ct,xend=med_fip200Ct,y=q1_yipf4Ct,yend=q3_yipf4Ct,color=Compartment_ss),alpha=0.5,size=0.5)+xlim(c(-.2,.5))+ylim(c(-.15,.2))+theme_classic()+geom_hline(yintercept = 0,linetype="dashed")+geom_vline(xintercept = 0,linetype="dashed")+geom_text_repel(data=med_top10,aes(med_fip200Ct,med_yipf4Ct,color=Compartment_ss, label=Compartment_ss),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=10)+theme(legend.position = "none",axis.title = element_text(size=14),axis.text = element_text(size=14))+labs(y="YIPF4 KO Log2FC(-AA/UT) - WT Log2FC(-AA/UT)",x="FIP200 KO Log2FC(-AA/UT) - WT Log2FC(-AA/UT)")

point_plot

# ggsave(point_plot, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/Fig6C_ScatterPlot_Compartment_Autophagycandidates_FIP200Ct_YIPF4Ct_v1_50x_v2.pdf",width = 8.5,height=7)


list_golgi_ER<-c("Golgi.membrane.associated","Golgi.membrane")


med_cand_ind_protein<-kh_allX_ann%>%
  dplyr::filter(Reference %in% candidates$Reference,Compartment_ss %in% list_golgi_ER )%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss, matches("Log2"))%>%
  dplyr::mutate(delta_yipf4flux_minCtlflux = log2FC_5_yipf4_aa.4_yipf4 -  log2FC_1_control_aa.0_control,
         delta_fip200flux_minCtlflux =   log2FC_3_fip200_aa.2_fip200 - log2FC_1_control_aa.0_control)%>%
  dplyr::arrange((delta_yipf4flux_minCtlflux))%>%
  tibble::rownames_to_column(var="index")%>%
  dplyr::mutate(index=as.numeric(as.character(index)),
         index2=index+0.9)%>%
  dplyr::mutate(yip4_col = dplyr::if_else(delta_yipf4flux_minCtlflux<0.1,0.1,dplyr::if_else(delta_yipf4flux_minCtlflux<0.2,0.2,dplyr::if_else(delta_yipf4flux_minCtlflux<0.3,0.3,0.4))),
         fip200_col = dplyr::if_else(delta_fip200flux_minCtlflux>0,0.1,dplyr::if_else(delta_fip200flux_minCtlflux > -0.2,0.2,dplyr::if_else(delta_fip200flux_minCtlflux > -0.4,0.3,0.4))))



p14<-ggplot()+geom_rect(data=med_cand_ind_protein,aes(ymin=index,ymax=index2,xmin=1,xmax=2,fill=as.factor(-yip4_col),alpha=delta_fip200flux_minCtlflux))+theme_classic()+scale_fill_viridis_d(end=0.8)+geom_text(data= med_cand_ind_protein, aes(y = (index+index2)/2, x=1.5,label=Gene.Symbol),size=3)+facet_wrap(.~Compartment_ss)

p14

# write.csv(kh_allX_ann%>%
#   dplyr::filter(Reference %in% candidates$Reference,Compartment_ss == "Golgi.membrane" ),"C:/Users/ian9s/Downloads/golgi_membrane_proteins.csv")
golgi_rect<-med_cand_ind_protein%>%
  dplyr::filter(Reference %in% candidates$Reference)%>%
  dplyr::filter(Compartment_ss == "Golgi.membrane" | Compartment_ss == "Golgi.membrane.associated" )

TM_annotation <- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/TM_annotation_golgimembrane.csv")

golgi_rect<-golgi_rect%>%
  dplyr::left_join(., TM_annotation, by=c("Reference","Gene.Symbol"))%>%
  dplyr::mutate(NumberTM = if_else(is.na(NumberTM),"Associated", NumberTM))


golgi_rect$TMval[is.na(golgi_rect$TMval)] <- 7

golgi_rect2<-golgi_rect%>%
  dplyr::arrange(dplyr::desc(delta_yipf4flux_minCtlflux))%>%
  dplyr::group_by(TMval)%>%
  dplyr::mutate(Rank = rank(-delta_yipf4flux_minCtlflux))

tm1_1<-golgi_rect2%>%
  dplyr::filter(TMval == 1 )%>%
  dplyr::mutate(Rank_mod = Rank %% 2)%>%
  dplyr::filter(Rank_mod == 1)%>%
  dplyr::select(-Rank_mod)%>%
  dplyr::mutate(TMval = 0)%>%
  dplyr::group_by(TMval)%>%
  dplyr::mutate(Rank = rank(-delta_yipf4flux_minCtlflux))

tm1_2<-golgi_rect2%>%
  dplyr::filter(TMval == 1 )%>%
  dplyr::mutate(Rank_mod = Rank %% 2)%>%
  dplyr::filter(Rank_mod == 0)%>%
  dplyr::select(-Rank_mod)%>%
  dplyr::mutate(TMval = 1)%>%
  dplyr::group_by(TMval)%>%
  dplyr::mutate(Rank = rank(-delta_yipf4flux_minCtlflux))

golgi_all_rect<-dplyr::bind_rows(golgi_rect2 %>% filter(TMval != 1 ),tm1_1,tm1_2)

golgi_all_rect<-golgi_all_rect%>%
  dplyr::mutate(TMval = as.numeric(as.character(TMval)))

write.csv(golgi_all_rect, "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/CARGO_Cellular_Autophagy_Regulation_GOlgiphagy/rectangle_input_data.csv",row.names = F)

rect_plot<-ggplot()+geom_rect(data=golgi_all_rect,aes(ymin=-Rank,ymax=-Rank-0.9,xmin=TMval,xmax=TMval+1,fill=as.factor(-yip4_col),alpha=delta_fip200flux_minCtlflux))+theme_classic()+scale_fill_viridis_d(end=0.8)+
  geom_text(data= golgi_all_rect%>%dplyr::filter(Gene.Symbol %!in% c("RXYLT1","EXTL3","TRIP11","TMEM115")), aes(y = (-Rank+-Rank-0.9)/2, x=(2*TMval+1)/2,label=Gene.Symbol),size=3,color="black")+
  geom_text(data= golgi_all_rect%>%dplyr::filter(Gene.Symbol %in% c("RXYLT1","EXTL3","TRIP11","TMEM115")), aes(y = (-Rank+-Rank-0.9)/2, x=(2*TMval+1)/2,label=Gene.Symbol),size=3,color="white")+
  geom_text(data = golgi_all_rect%>%dplyr::distinct(TMval,NumberTM), aes(x=(2*TMval+1)/2,y=0,label=NumberTM),size=4)+ylim(c(-27,0))+theme(axis.text = element_blank(),axis.title = element_blank(),axis.line = element_blank(),axis.ticks = element_blank())+labs(alpha="FIP200-/- - WT (-AA/UT)",fill="YIPF4-/- - WT (-AA/UT)")

rect_plot

# ggsave(rect_plot, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/Fig6c_Golgi_TMannotation_v1.pdf",height = 6,width=8)



```

### Export list of proteins in candidate list

```{r}
export_output_df<-kh_allX%>%
  dplyr::mutate(candidate = if_else(Reference %in% candidates$Reference,"candidate","not"))


# candidate_export <- write.csv(kh_allX%>%dplyr::mutate(candidate = if_else(Reference %in% candidates$Reference,"candidate","not")), "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/candidate_list_10perc.csv")
```



### Point plot other data set


```{r}
yipf3_yipf4<- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/HeLa-18h-EBSS_control_ATG7KO_YIPF3KO_YIPF4KO.csv")



ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")



ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")


###added
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  , "Golgi.membrane.associated","Golgi.membrane" ,"Cytosol")

ss_organelle_list<-ss_organelle_list%>%
  dplyr::filter(Compartment_ss %in% list_compartments)

#### YIP flux t-test

yipf3_yipf4_ann <- dplyr::left_join(yipf3_yipf4,ss_organelle_list, by="Gene.Symbol")



### extra based on all proteins by compartment



### Figure 6 point plot
all_yipf3_yipf4<-yipf3_yipf4_ann%>%
  dplyr::filter(Compartment_ss %in% list_compartments )%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,cluster,Compartment_ss, matches("Log2"))%>%
  dplyr::mutate(delta_yipf4flux_minCtlflux = log2FC_YIPF4.KO..EBSS.YIPF4.KO -  log2FC_control_EBSS.control,
                delta_yipf3flux_minCtlflux = log2FC_YIPF3.KO..EBSS.YIPF3.KO -  log2FC_control_EBSS.control,
         delta_atg7flux_minCtlflux = log2FC_ATG7.KO..EBSS.ATG7.KO - log2FC_control_EBSS.control )%>%
  dplyr::ungroup()%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarise(med_atg7Ct=median(delta_atg7flux_minCtlflux),
            med_yipf4Ct = median(delta_yipf4flux_minCtlflux),
            med_yipf3Ct = median(delta_yipf3flux_minCtlflux),
            q1_atg7Ct= quantile(delta_atg7flux_minCtlflux,0.25),
            q3_atg7Ct= quantile(delta_atg7flux_minCtlflux,0.75),
            q1_yipf4Ct= quantile(delta_yipf4flux_minCtlflux,0.25),
            q3_yipf4Ct= quantile(delta_yipf4flux_minCtlflux,0.75),
            q1_yipf3Ct= quantile(delta_yipf3flux_minCtlflux,0.25),
            q3_yipf3Ct= quantile(delta_yipf3flux_minCtlflux,0.75),
            num_proteins = n())



all_yipf3_yipf4<-all_yipf3_yipf4%>%
  dplyr::mutate(Compartment_ss = stringr::str_replace_all(Compartment_ss,"\\.","\\ "),
                Compartment_ss = stringr::str_replace_all(Compartment_ss,"Membrane","membrane"),
                Compartment_ss = stringr::str_replace_all(Compartment_ss,"membrane associated","associated")
                                )



yipf4_point_plot<-ggplot(all_yipf3_yipf4%>%dplyr::mutate(Compartment_ss = stringr::str_replace_all(Compartment_ss,"\\.","\\ ")),aes(med_atg7Ct,med_yipf4Ct,color=Compartment_ss))+geom_point(size=4,alpha=0.6)+geom_segment(aes(x=q1_atg7Ct,xend=q3_atg7Ct,y=med_yipf4Ct,yend=med_yipf4Ct,color=Compartment_ss),alpha=0.5,size=0.5)+geom_segment(aes(x=med_atg7Ct,xend=med_atg7Ct,y=q1_yipf4Ct,yend=q3_yipf4Ct,color=Compartment_ss),alpha=0.5,size=0.5)+xlim(c(-.31,.4))+ylim(c(-.4,.44))+theme_classic()+geom_hline(yintercept = 0,linetype="dashed")+geom_vline(xintercept = 0,linetype="dashed")+geom_text_repel(data=all_yipf3_yipf4,aes(med_atg7Ct,med_yipf4Ct,color=Compartment_ss, label=Compartment_ss),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=10)+theme(legend.position = "none",axis.title = element_text(size=14),axis.text = element_text(size=14))+labs(y="YIPF4 KO Log2FC(EBSS/UT) - WT Log2FC(EBSS/UT)",x="ATG7 KO Log2FC(EBSS/UT) - WT Log2FC(EBSS/UT)")

yipf4_point_plot

yipf3_point_plot<-ggplot(all_yipf3_yipf4%>%dplyr::mutate(Compartment_ss = stringr::str_replace_all(Compartment_ss,"\\.","\\ ")),aes(med_atg7Ct,med_yipf3Ct,color=Compartment_ss))+geom_point(size=4,alpha=0.6)+geom_segment(aes(x=q1_atg7Ct,xend=q3_atg7Ct,y=med_yipf3Ct,yend=med_yipf3Ct,color=Compartment_ss),alpha=0.5,size=0.5)+geom_segment(aes(x=med_atg7Ct,xend=med_atg7Ct,y=q1_yipf3Ct,yend=q3_yipf3Ct,color=Compartment_ss),alpha=0.5,size=0.5)+xlim(c(-.31,.4))+ylim(c(-.4,.44))+theme_classic()+geom_hline(yintercept = 0,linetype="dashed")+geom_vline(xintercept = 0,linetype="dashed")+geom_text_repel(data=all_yipf3_yipf4,aes(med_atg7Ct,med_yipf3Ct,color=Compartment_ss, label=Compartment_ss),max.overlaps = Inf,box.padding=1,show.legend=FALSE,size=10)+theme(legend.position = "none",axis.title = element_text(size=14),axis.text = element_text(size=14))+labs(y="YIPF3 KO Log2FC(EBSS/UT) - WT Log2FC(EBSS/UT)",x="ATG7 KO Log2FC(EBSS/UT) - WT Log2FC(EBSS/UT)")

yipf3_point_plot

# ggsave(yipf4_point_plot, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/SuppFig6W1_ScatterPlot_Compartment_AllProteins_ATG7Ct_YIPF4Ct_v1_50x_v2.pdf",width = 8.5,height=7)
# ggsave(yipf3_point_plot, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/SuppFig6W2_ScatterPlot_Compartment_AllProteins_ATG7Ct_YIPF3Ct_v1_50x_v2.pdf",width = 8.5,height=7)



```



### Ribosome Proteasome


```{r}
kh_allX<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/HEK293-12h-AA.csv")

ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")

#tidy form annotations for localizations
ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")

###add filter
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  , "Golgi.membrane.associated","Golgi.membrane" ,"Cytosol")

ss_organelle_list<-ss_organelle_list%>%
  dplyr::filter(Compartment_ss %in% list_compartments)

## Annotate the whole dataframe for organelles
complete_df_ann<-dplyr::left_join(kh_allX,ss_organelle_list,by="Gene.Symbol")

#### EXTRA Proteasome Ribo

proteasome_values<-complete_df_ann%>%
  dplyr::filter(Gene.Symbol %in% proteasome_prots)%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss,log2FC_1_control_aa.0_control,log2FC_3_fip200_aa.2_fip200,log2FC_5_yipf4_aa.4_yipf4)%>%
  dplyr::mutate(designation = "All",
         Compartment_ss = "Proteasome")%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation,Compartment_ss,designation)%>%
  tidyr::gather("Comparison","Log2_minAA_plusAA",5:7)%>%
  dplyr::mutate(comp_loc = paste(Comparison,Compartment_ss,sep="_"))

ribosome_values<-complete_df_ann%>%
  dplyr::filter(Gene.Symbol %in% ribo_prot)%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss,log2FC_1_control_aa.0_control,log2FC_3_fip200_aa.2_fip200,log2FC_5_yipf4_aa.4_yipf4)%>%
  dplyr::mutate(designation = "All",
         Compartment_ss = "Ribosome")%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation,Compartment_ss,designation)%>%
  tidyr::gather("Comparison","Log2_minAA_plusAA",5:7)%>%
  dplyr::mutate(comp_loc = paste(Comparison,Compartment_ss,sep="_"))

cytosol_values<-complete_df_ann%>%
  dplyr::filter(Compartment_ss == "Cytosol")%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss,log2FC_1_control_aa.0_control,log2FC_3_fip200_aa.2_fip200,log2FC_5_yipf4_aa.4_yipf4)%>%
  dplyr::mutate(designation = "All",
         Compartment_ss = "Cytosol")%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation,Compartment_ss,designation)%>%
  tidyr::gather("Comparison","Log2_minAA_plusAA",5:7)%>%
  dplyr::mutate(comp_loc = paste(Comparison,Compartment_ss,sep="_"))


##
Cyto_Ribo_Proteasome<-dplyr::bind_rows(proteasome_values,ribosome_values,cytosol_values)%>%
  dplyr::mutate(Comparison2= dplyr::if_else(stringr::str_detect(Comparison,"fip"),"FIP200 KO",dplyr::if_else(stringr::str_detect(Comparison,"yipf4"),"YIPF4 KO","WT")))


Cyto_Ribo_Proteasome$Comparison2 <- factor(Cyto_Ribo_Proteasome$Comparison2 , levels = c("WT","FIP200 KO","YIPF4 KO"))


Cyto_Ribo_Proteasome$Compartment_ss <- factor(Cyto_Ribo_Proteasome$Compartment_ss , levels = c("Cytosol","Proteasome","Ribosome"))


s8_proteasome_ribosome <- ggplot(Cyto_Ribo_Proteasome,aes(Compartment_ss,  Log2_minAA_plusAA,group=comp_loc,color=Comparison2,fill=Comparison2)) +geom_violin(draw_quantiles = c(0.5),size=1.25)+geom_violin(draw_quantiles = c(0.25,0.75),size=0.5)+theme_classic()+geom_hline(yintercept = 0,linetype="dashed")+scale_color_viridis_d(end=0.8)+scale_fill_viridis_d(end=0.8,alpha = 0.1)+labs(y=bquote(""~Log[2]~"FC(-AA/UT)"),x="")+theme(legend.title = element_blank(),axis.title = element_text(size=20),axis.text = element_text(size=18),plot.title = element_text(hjust = 0.5,size=26),legend.text = element_text(size=18) )+ylim(c(-1.2,1))

s8_proteasome_ribosome

# ggsave(s8_proteasome_ribosome, filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/SuppFig8a_Violin_ProteasomeRibosome_Autophagycandidates_FIP200Ct_YIPF4Ct_v1_50x_v2.pdf",width = 14,height=7)



```




### Final Plot differential Candidates

```{r}
list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  , "Golgi.membrane.associated","Golgi.membrane" ,"Cytosol")


c2_df<-complete_df_ann%>%
  dplyr::filter(Reference %in% candidates$Reference,Compartment_ss %in% list_compartments)%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss,log2FC_1_control_aa.0_control,log2FC_3_fip200_aa.2_fip200,log2FC_5_yipf4_aa.4_yipf4)%>%
  dplyr::mutate(designation = "Candidates")%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation,Compartment_ss,designation)%>%
  tidyr::gather("Comparison","Log2_minAA_plusAA",5:7)%>%
  dplyr::mutate(comp_loc = paste(Comparison,Compartment_ss,sep="_"))

other_df_notc2<-complete_df_ann%>%
  dplyr::filter(Reference %!in% candidates$Reference,Compartment_ss %in% list_compartments)%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss,log2FC_1_control_aa.0_control,log2FC_3_fip200_aa.2_fip200,log2FC_5_yipf4_aa.4_yipf4)%>%
  dplyr::mutate(designation = "Other")%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation,Compartment_ss,designation)%>%
  tidyr::gather("Comparison","Log2_minAA_plusAA",5:7)%>%
  dplyr::mutate(comp_loc = paste(Comparison,Compartment_ss,sep="_"))


list_compartments_other<- c("Nucleus","Endosome","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome" ,"Cytosol"  )

c2_df_all<-complete_df_ann%>%
  dplyr::filter(Reference %in% candidates$Reference,Compartment_ss %in% list_compartments_other)%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss,log2FC_1_control_aa.0_control,log2FC_3_fip200_aa.2_fip200,log2FC_5_yipf4_aa.4_yipf4)%>%
  dplyr::mutate(designation = "Candidates",
         Compartment_ss = "Other")%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation,Compartment_ss,designation)%>%
  tidyr::gather("Comparison","Log2_minAA_plusAA",5:7)%>%
  dplyr::mutate(comp_loc = paste(Comparison,Compartment_ss,sep="_"))


short_list<-c("Other","Golgi","Golgi.membrane","Golgi.membrane.associated")

fig_c2<-bind_rows(c2_df,c2_df_all)%>%
  dplyr::filter(Compartment_ss %in% short_list)%>%
  dplyr::mutate(Comparison2= dplyr::if_else(str_detect(Comparison,"fip"),"FIP200 KO",dplyr::if_else(str_detect(Comparison,"yipf4"),"YIPF4 KO","WT")),
          Compartment_ss2= dplyr::if_else(str_detect(Compartment_ss,"associated"),"Golgi \n Associated",dplyr::if_else(str_detect(Compartment_ss,"membrane"),"Golgi \n Membrane",dplyr::if_else(Compartment_ss=="Other","Other","Golgi"))))


fig_c2$Comparison2 <- factor(fig_c2$Comparison2 , levels = c("WT","FIP200 KO","YIPF4 KO"))


fig_c2$Compartment_ss2 <- factor(fig_c2$Compartment_ss2 , levels = c("Other","Golgi","Golgi \n Associated","Golgi \n Membrane"))

```



### Other comaparison

```{r}

other_df_notc2_all<-complete_df_ann%>%
  dplyr::filter(Reference %in% candidates$Reference,Compartment_ss %in% list_compartments_other)%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss,log2FC_1_control_aa.0_control,log2FC_3_fip200_aa.2_fip200,log2FC_5_yipf4_aa.4_yipf4)%>%
  dplyr::mutate(designation = "Other",
         Compartment_ss = "Other")%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation,Compartment_ss,designation)%>%
  tidyr::gather("Comparison","Log2_minAA_plusAA",5:7)%>%
  dplyr::mutate(comp_loc = paste(Comparison,Compartment_ss,sep="_"))


short_list<-c("Other","Golgi","Golgi.membrane","Golgi.membrane.associated")

fig_other<-dplyr::bind_rows(other_df_notc2,other_df_notc2_all)%>%
  dplyr::filter(Compartment_ss %in% short_list)%>%
  dplyr::mutate(Comparison2= dplyr::if_else(stringr::str_detect(Comparison,"fip"),"FIP200 KO",dplyr::if_else(stringr::str_detect(Comparison,"yipf4"),"YIPF4 KO","WT")),
          Compartment_ss2= dplyr::if_else(stringr::str_detect(Compartment_ss,"associated"),"Golgi \n Associated",dplyr::if_else(stringr::str_detect(Compartment_ss,"membrane"),"Golgi \n Membrane",dplyr::if_else(Compartment_ss=="Other","Other","Golgi"))))


fig_other$Comparison2 <- factor(fig_other$Comparison2 , levels = c("WT","FIP200 KO","YIPF4 KO"))


fig_other$Compartment_ss2 <- factor(fig_other$Compartment_ss2 , levels = c("Other","Golgi","Golgi \n Associated","Golgi \n Membrane"))

p2<-ggplot(fig_other,aes(Compartment_ss2,  Log2_minAA_plusAA,group=comp_loc,color=Comparison2,fill=Comparison2)) +geom_violin(draw_quantiles = c(0.5),size=1.25)+geom_violin(draw_quantiles = c(0.25,0.75),size=0.5)+theme_classic()+geom_hline(yintercept = 0,linetype="dashed")+labs(title="Other Proteins")+scale_color_viridis_d(end=0.8)+scale_fill_viridis_d(end=0.8,alpha = 0.1)+labs(y=bquote(""~Log[2]~"FC(-AA/UT)"),x="")+theme(legend.title = element_blank(),axis.title = element_text(size=20),axis.text = element_text(size=18),plot.title = element_text(hjust = 0.5,size=26),legend.text = element_text(size=18) )+ylim(c(-1.2,1))

p2



p12<-ggplot(fig_c2,aes(Compartment_ss2,  Log2_minAA_plusAA,group=comp_loc,color=Comparison2,fill=Comparison2)) +geom_violin(draw_quantiles = c(0.5),size=1.25)+geom_violin(draw_quantiles = c(0.25,0.75),size=0.5)+theme_classic()+geom_hline(yintercept = 0,linetype="dashed")+labs(title="\'Autophagy\' Candidates")+scale_color_viridis_d(end=0.8)+scale_fill_viridis_d(end=0.8,alpha = 0.1)+labs(y=bquote(""~Log[2]~"FC(-AA/UT)"),x="")+theme(legend.title = element_blank(),axis.title = element_text(size=20),axis.text = element_text(size=18),plot.title = element_text(hjust = 0.5,size=26),legend.text = element_text(size=18) )+ylim(c(-1.3,1))

p12

# ggsave(p12,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/Fig6A_AutophagyCandidates_fig_golgi_v1.pdf",height=6,width = 9)




other_forSUPP<-complete_df_ann%>%
  dplyr::filter(Reference %!in% candidates$Reference,Compartment_ss %in% list_compartments)%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss,log2FC_1_control_aa.0_control,log2FC_3_fip200_aa.2_fip200,log2FC_5_yipf4_aa.4_yipf4)%>%
  dplyr::mutate(designation = "Other")%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation,Compartment_ss,designation)%>%
  tidyr::gather("Comparison","Log2_minAA_plusAA",5:7)%>%
  dplyr::mutate(comp_loc = paste(Comparison,Compartment_ss,sep="_"))

other_df_notc2_all_forSUPP<-complete_df_ann%>%
  dplyr::filter(Reference %!in% candidates$Reference,Compartment_ss %in% list_compartments_other)%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss,log2FC_1_control_aa.0_control,log2FC_3_fip200_aa.2_fip200,log2FC_5_yipf4_aa.4_yipf4)%>%
  dplyr::mutate(designation = "Other",
         Compartment_ss = "Other")%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation,Compartment_ss,designation)%>%
  tidyr::gather("Comparison","Log2_minAA_plusAA",5:7)%>%
  dplyr::mutate(comp_loc = paste(Comparison,Compartment_ss,sep="_"))


other_df_notc2_all_forSUPP_NA<-complete_df_ann%>%
  dplyr::filter(Reference %!in% candidates$Reference,Compartment_ss %!in% list_compartments)%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss,log2FC_1_control_aa.0_control,log2FC_3_fip200_aa.2_fip200,log2FC_5_yipf4_aa.4_yipf4)%>%
  dplyr::mutate(designation = "Other",
         Compartment_ss = "Unannotated")%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation,Compartment_ss,designation)%>%
  tidyr::gather("Comparison","Log2_minAA_plusAA",5:7)%>%
  dplyr::mutate(comp_loc = paste(Comparison,Compartment_ss,sep="_"))


#short_list<-c("Other","Golgi","Golgi.membrane","Golgi.membrane.associated")

fig_other_supp<-dplyr::bind_rows(other_df_notc2_all_forSUPP,other_df_notc2_all_forSUPP_NA)
fig_other_supp2<-dplyr::bind_rows(fig_other_supp,other_forSUPP)%>%
  dplyr::mutate(Comparison2= dplyr::if_else(str_detect(Comparison,"fip"),"FIP200 KO",dplyr::if_else(stringr::str_detect(Comparison,"yipf4"),"YIPF4 KO","WT")),
          Compartment_ss2= dplyr::if_else(stringr::str_detect(Compartment_ss,"associated"),"Golgi \n Associated",dplyr::if_else(stringr::str_detect(Compartment_ss,"Golgi.membrane"),"Golgi \n Membrane",dplyr::if_else(stringr::str_detect(Compartment_ss,"Plasma.Membrane"),"Plasma \n Membrane",Compartment_ss))))


fig_other_supp2$Comparison2 <- factor(fig_other_supp2$Comparison2 , levels = c("WT","FIP200 KO","YIPF4 KO"))


# 
fig_other_supp2$Compartment_ss2 <- factor(fig_other_supp2$Compartment_ss2 , levels = c( "Other","Unannotated","Cytosol","Golgi","Golgi \n Associated","Golgi \n Membrane","Endosome","ER","Lysosome","Mitochondria","Nucleus","Peroxisome","Plasma \n Membrane" ))

supp1<-ggplot(fig_other_supp2,aes(Compartment_ss2,  Log2_minAA_plusAA,group=comp_loc,color=Comparison2,fill=Comparison2)) +geom_violin(draw_quantiles = c(0.5),size=1.25)+geom_violin(draw_quantiles = c(0.25,0.75),size=0.5)+theme_classic()+geom_hline(yintercept = 0,linetype="dashed")+labs(title="Other Proteins")+scale_color_viridis_d(end=0.8)+scale_fill_viridis_d(end=0.8,alpha = 0.1)+labs(y=bquote(""~Log[2]~"FC(-AA/UT)"),x="")+theme(legend.title = element_blank(),axis.title = element_text(size=20),axis.text = element_text(size=14),plot.title = element_text(hjust = 0.5,size=26),legend.text = element_text(size=18) )+ylim(c(-1.2,1))

supp1

#### C2 

c2_forSUPP<-complete_df_ann%>%
  dplyr::filter(Reference %in% candidates$Reference,Compartment_ss %in% list_compartments)%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss,log2FC_1_control_aa.0_control,log2FC_3_fip200_aa.2_fip200,log2FC_5_yipf4_aa.4_yipf4)%>%
  dplyr::mutate(designation = "Candidates")%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation,Compartment_ss,designation)%>%
  tidyr::gather("Comparison","Log2_minAA_plusAA",5:7)%>%
  dplyr::mutate(comp_loc = paste(Comparison,Compartment_ss,sep="_"))

other_df_c2_all_forSUPP<-complete_df_ann%>%
  dplyr::filter(Reference %in% candidates$Reference,Compartment_ss %in% list_compartments_other)%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss,log2FC_1_control_aa.0_control,log2FC_3_fip200_aa.2_fip200,log2FC_5_yipf4_aa.4_yipf4)%>%
  dplyr::mutate(designation = "Candidates",
         Compartment_ss = "Other")%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation,Compartment_ss,designation)%>%
  tidyr::gather("Comparison","Log2_minAA_plusAA",5:7)%>%
  dplyr::mutate(comp_loc = paste(Comparison,Compartment_ss,sep="_"))


other_df_c2_all_forSUPP_NA<-complete_df_ann%>%
  dplyr::filter(Reference %in% candidates$Reference,Compartment_ss %!in% list_compartments)%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,Compartment_ss,log2FC_1_control_aa.0_control,log2FC_3_fip200_aa.2_fip200,log2FC_5_yipf4_aa.4_yipf4)%>%
  dplyr::mutate(designation = "Candidates",
         Compartment_ss = "Unannotated")%>%
  dplyr::group_by(Reference,Gene.Symbol,Annotation,Compartment_ss,designation)%>%
  tidyr::gather("Comparison","Log2_minAA_plusAA",5:7)%>%
  dplyr::mutate(comp_loc = paste(Comparison,Compartment_ss,sep="_"))


#short_list<-c("Other","Golgi","Golgi.membrane","Golgi.membrane.associated")

fig_c2_supp<-dplyr::bind_rows(other_df_c2_all_forSUPP,other_df_c2_all_forSUPP_NA)
fig_c2_supp2<-dplyr::bind_rows(fig_c2_supp,c2_forSUPP)%>%
  dplyr::mutate(Comparison2= dplyr::if_else(stringr::str_detect(Comparison,"fip"),"FIP200 KO",dplyr::if_else(stringr::str_detect(Comparison,"yipf4"),"YIPF4 KO","WT")),
          Compartment_ss2= dplyr::if_else(stringr::str_detect(Compartment_ss,"associated"),"Golgi \n Associated",dplyr::if_else(stringr::str_detect(Compartment_ss,"Golgi.membrane"),"Golgi \n Membrane",dplyr::if_else(stringr::str_detect(Compartment_ss,"Plasma.Membrane"),"Plasma \n Membrane",Compartment_ss))))


fig_c2_supp2$Comparison2 <- factor(fig_c2_supp2$Comparison2 , levels = c("WT","FIP200 KO","YIPF4 KO"))


# 
fig_c2_supp2$Compartment_ss2 <- factor(fig_c2_supp2$Compartment_ss2 , levels = c( "Other","Unannotated","Cytosol","Golgi","Golgi \n Associated","Golgi \n Membrane","Endosome","ER","Lysosome","Mitochondria","Nucleus","Peroxisome","Plasma \n Membrane" ))

supp2<-ggplot(fig_c2_supp2,aes(Compartment_ss2,  Log2_minAA_plusAA,group=comp_loc,color=Comparison2,fill=Comparison2)) +geom_violin(draw_quantiles = c(0.5),size=1.25)+geom_violin(draw_quantiles = c(0.25,0.75),size=0.5)+theme_classic()+geom_hline(yintercept = 0,linetype="dashed")+labs(title="\'Autophagy\' Candidates")+scale_color_viridis_d(end=0.8)+scale_fill_viridis_d(end=0.8,alpha = 0.1)+labs(y=bquote(""~Log[2]~"FC(-AA/UT)"),x="")+theme(legend.title = element_blank(),axis.title = element_text(size=20),axis.text = element_text(size=14),plot.title = element_text(hjust = 0.5,size=26),legend.text = element_text(size=18) )+ylim(c(-1.2,1))

p121<-plot_grid(supp2,supp1,nrow = 2)

p121

# ggsave(p121,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/SuppFig8b_AutophagyCandidates_AllLocales_withcytosol.pdf",height=12,width = 20)


fig_c2_supp2%>%dplyr::filter(Comparison2 == "WT")%>%
  group_by(Compartment_ss2)%>%summarise(counts=n())

fig_other_supp2%>%dplyr::filter(Comparison2 == "WT")%>%
  group_by(Compartment_ss2)%>%summarise(counts=n())
```




## Figure 6 Proteome Ruler

### DIA input data

```{r}
# dia<-read.csv("C:/DIA-NN/1.8.1/E11_KH/protein_level_results_input_dia.csv")
dia<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/protein_level_results_input_dia.csv")
dia[is.na(dia)] <- 0

dia_tidy <- dia%>%
  dplyr::group_by(Protein.Group,Protein.Ids,Protein.Names,Genes,First.Protein.Description)%>%
  tidyr::gather("Sample","Intensity",6:13)%>%
  dplyr::filter(str_detect(Sample, "UT")==T)%>%
  dplyr::filter(Intensity >0)%>%
  dplyr::group_by(Protein.Group,Protein.Ids,Protein.Names,Genes,First.Protein.Description)%>%
  dplyr::summarise(counts = n(),
            Intensity = mean(Intensity))

dia_tidy_aa <- dia%>%
  dplyr::group_by(Protein.Group,Protein.Ids,Protein.Names,Genes,First.Protein.Description)%>%
  tidyr::gather("Sample","Intensity",6:13)%>%
  dplyr::filter(str_detect(Sample, "UT")==F)%>%
  dplyr::filter(Intensity >0)%>%
  dplyr::group_by(Protein.Group,Protein.Ids,Protein.Names,Genes,First.Protein.Description)%>%
  dplyr::summarise(counts = n(),
            Intensity = mean(Intensity))

# dia_tidy2<- full_join(dia_tidy, dia_tidy_aa, by= c("Protein.Group","Protein.Ids","Protein.Names","Genes","First.Protein.Description"),suffix=c("_ut","_aa"))

dia_tidy2<- dplyr::inner_join(dia_tidy, dia_tidy_aa, by= c("Protein.Group","Protein.Ids","Protein.Names","Genes","First.Protein.Description"),suffix=c("_ut","_aa"))


dia_tidy2<-dia_tidy2%>%
  dplyr::mutate(Protein.Group2 = Protein.Group)%>%
  tidyr::separate(Protein.Group,into=c("accession","second") ,sep = "\\;")%>%
  dplyr::select(-second)%>%
  ## filter found in at least 2 reps each
  dplyr::filter(counts_ut >1 , counts_aa > 1)

Histones<-c("H2BC12;H2BC12L;H2BC4",
"MACROH2A1",
"H1-0",
"H2AZ1;H2AZ2",
"H1-4",
"H2AX",
"H4C1",
"H3-3A;H3-4;H3C1;H3C15",
"H2AC18;H2AC20",
"H2BC19P;H2BC20P",
"H2AC21",
"H2BU1",
"H1-10",
"H2BC1",
"MACROH2A2")
# c2_proteins <- read.csv("C:/DIA-NN/1.8.1/E11_KH/c2_protein_list.csv")

final_tmt_results<-read.csv( "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/candidate_list_10perc.csv")

# c2_proteins <- final_tmt_results %>% filter(candidate == "candidate")

final_tmt_results<-final_tmt_results%>%
  dplyr::mutate(Reference2 = Reference)%>%
  tidyr::separate(Reference2, into = c("type","accession","gene_name_2"),sep="\\|")

c2_proteins <- final_tmt_results %>%
  dplyr::filter(candidate == "candidate")

dia_tidy2<-dia_tidy2%>%
  dplyr::filter(accession %in% final_tmt_results$accession)

# proteome_ruler_compare2_locale_c2<-proteome_ruler_compare2_locale%>%filter(Gene.Symbol %in% c2_proteins$Gene.Symbol)
# proteome_ruler_compare2_locale_c2<-proteome_ruler_compare2_locale%>%filter(accession %in% final_tmt_results$accession)


dia_tidy2_histones<- dia_tidy2%>%
  dplyr::filter(Genes %in% Histones)

histone_sum_int <- sum(dia_tidy2_histones$Intensity_ut)

histone_sum_int/sum(dia_tidy2$Intensity_ut)

# uniprot<- read.csv("C:/DIA-NN/1.8.1/E11_KH/uniprot-download_true_fields_accession_2Cid_2Cprotein_name_2Cgene_na-2022.11.06-22.27.28.68.csv")
uniprot<- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/uniprot-download_true_fields_accession_2Cid_2Cprotein_name_2Cgene_na-2022.11.06-22.27.28.68.csv")%>%
  dplyr::rename(accession = Entry)




dia_tidy3<-dplyr::left_join(dia_tidy2,uniprot,by="accession")%>%
  dplyr::mutate(prot_ruler_copyNum_ut= Intensity_ut * (602214080000000000000000/Mass) * (0.00000000000685 / histone_sum_int))%>%
  dplyr::arrange(dplyr::desc(prot_ruler_copyNum_ut))%>%
  tibble::rownames_to_column("Rank")%>%
  dplyr::mutate(Rank = as.numeric(as.character(Rank)),
                foldchange = log2(Intensity_aa/Intensity_ut),
                prot_ruler_copyNum_aa = dplyr::if_else(foldchange < 0 ,prot_ruler_copyNum_ut * 2^foldchange ,-10))




dia_tidy4<-dia_tidy3%>%
  dplyr::mutate(Gene.Symbol = Genes)%>%
  tidyr::separate(Gene.Symbol, into=c("Gene.Symbol"), sep = "\\;")
  


opencell<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/opencell-protein-abundance.csv")

opencell<-opencell%>%
  dplyr::rename(Gene.Symbol = gene_name)

proteome_ruler_compare2<- dplyr::left_join(dia_tidy4,opencell, by="Gene.Symbol")




ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")
### produce organelle annotation in a tidy format for mapping to data
ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")%>%
  dplyr::distinct()

###add filter
# list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  ,"Cytosol")
list_compartments<- c("Nucleus","Endosome","Golgi.membrane.associated","Golgi.membrane","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  ,"Cytosol")
ss_organelle_list<-ss_organelle_list%>%
  dplyr::filter(Compartment_ss %in% list_compartments)

proteome_ruler_compare2_locale <- left_join(proteome_ruler_compare2, ss_organelle_list , by="Gene.Symbol")%>%
  dplyr::mutate(locale = Compartment_ss)



# write.csv(proteome_ruler_compare2_locale%>%dplyr::mutate(candidate = dplyr::if_else(accession %in% c2_proteins$accession,"Candidate","NotCandidate")), "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/DataS8A_dia_proteome_ruler_results.csv")


## correlation between published and the calculation here
corrplot_2<-ggplot(proteome_ruler_compare2,aes(log10(prot_ruler_copyNum_ut),log10(hek_protein_copy_number) ))+geom_bin_2d(bins=100)+stat_cor(method="spearman",size=8)+theme_classic()+scale_fill_viridis_c()+labs(y="Wisniewski et al. Log10(Protein Copy Number/Cell WT)", x="DIA Log10(Protein Copy Number/Cell WT)")+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))

corrplot_2


# ggsave(corrplot_2,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/supp9F_CorrPlot_DIA_Wisniewski_.pdf",height=7,width = 7)

```

#### DIA ranked plot


```{r}

proteome_ruler_compare2_locale_rank <- proteome_ruler_compare2_locale


rankplot_supp1<-ggplot()+geom_point(data=proteome_ruler_compare2_locale_rank%>%dplyr::filter(accession %in% c2_proteins$accession)%>%dplyr::mutate(locale = stringr::str_replace_all(locale,"\\."," ")), aes(Rank,log10(prot_ruler_copyNum_ut)),size=0.75)+geom_point(data=proteome_ruler_compare2_locale_rank%>%dplyr::filter(accession %in% c2_proteins$accession,locale != "Golgi.membrane",locale != "Golgi.membrane.associated" )%>%dplyr::mutate(locale = stringr::str_replace_all(locale,"\\."," ")), aes(Rank,log10(prot_ruler_copyNum_aa),color=locale),size=0.75)+geom_point(data=proteome_ruler_compare2_locale_rank%>%dplyr::filter(accession %in% c2_proteins$accession,locale == "Golgi.membrane")%>%dplyr::mutate(locale = stringr::str_replace_all(locale,"\\."," ")), aes(Rank,log10(prot_ruler_copyNum_aa),color=locale),size=2)+geom_point(data=proteome_ruler_compare2_locale_rank%>%dplyr::filter(accession %in% c2_proteins$accession,locale == "Golgi.membrane.associated")%>%dplyr::mutate(locale = stringr::str_replace_all(locale,"\\."," ")), aes(Rank,log10(prot_ruler_copyNum_aa),color=locale),size=2)+theme_classic()+theme(legend.title = element_blank(),legend.position = "right")+labs(x="Protein Rank (WT)", y=bquote(""~Log[10]~"(Protein Copy Number/Cell WT)"))+ guides(colour = guide_legend(override.aes = list(size=2)))+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))

rankplot_supp1

# ggsave(rankplot_supp1,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/supp9a_DIA_ProteomeRuler_rankPlot.pdf",height=7,width = 7)

```





#### DIA numbers


```{r}

ALL<-proteome_ruler_compare2_locale%>%
  dplyr::ungroup()%>%
  dplyr::filter(!is.na(prot_ruler_copyNum_ut), Compartment_ss %in% list_compartments)%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarize(
         numberProtWithLoss = n(),
         total_molecules_compartment = sum(prot_ruler_copyNum_ut),
         avg_molecules_compartment = sum(prot_ruler_copyNum_ut)/n())

c2_calls<-proteome_ruler_compare2_locale%>%
  dplyr::ungroup()%>%
  dplyr::filter(!is.na(prot_ruler_copyNum_ut),accession %in% c2_proteins$accession, Compartment_ss %in% list_compartments,foldchange<0)%>%
  dplyr::mutate(controlstarve_control = 2^foldchange,
         delta_abundance = 1- controlstarve_control,
         final_loss = delta_abundance*prot_ruler_copyNum_ut)%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarize(avg_loss=sum(final_loss)/n(),
         all_molecules_lost = sum(final_loss),
         numberProtWithLoss = n(),
         total_molecules_compartment = sum(prot_ruler_copyNum_ut),
         avg_molecules_compartment = sum(prot_ruler_copyNum_ut)/n())



proteins_loss<-proteome_ruler_compare2_locale%>%
  dplyr::ungroup()%>%
  dplyr::filter(!is.na(prot_ruler_copyNum_ut), Compartment_ss %in% list_compartments,foldchange<0)%>%
  dplyr::mutate(controlstarve_control = 2^foldchange,
         delta_abundance = 1- controlstarve_control,
         final_loss = delta_abundance*prot_ruler_copyNum_ut)%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarize(avg_loss=sum(final_loss)/n(),
         all_molecules_lost = sum(final_loss),
         numberProtWithLoss = n(),
         total_molecules_compartment = sum(prot_ruler_copyNum_ut),
         avg_molecules_compartment = sum(prot_ruler_copyNum_ut)/n())

c2_protLoss<-dplyr::inner_join(c2_calls,proteins_loss,by="Compartment_ss",suffix=c("_c2","_allLoss"))

c2_protLoss<-dplyr::inner_join(c2_protLoss, ALL, by="Compartment_ss")


c2_protLoss<-c2_protLoss%>%
  dplyr::mutate(Compartment_ss2= dplyr::if_else(stringr::str_detect(Compartment_ss,"associated"),"Golgi \n Associated",dplyr::if_else(stringr::str_detect(Compartment_ss,"Golgi.membrane"),"Golgi \n Membrane",dplyr::if_else(stringr::str_detect(Compartment_ss,"Plasma.Membrane"),"Plasma \n Membrane",dplyr::if_else(is.na(Compartment_ss),"Unannotated",Compartment_ss)))),
         Compartment_ss2= dplyr::if_else(is.na(Compartment_ss2),"Unannotated",Compartment_ss2),
         percent_loss_c2 = all_molecules_lost_c2 / total_molecules_compartment *100,
         percent_loss_allProt = all_molecules_lost_allLoss / total_molecules_compartment *100)


# write.csv(c2_protLoss, "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/DataS8C_dia_summary.csv")

total_loss_cand_DIA<-sum(c2_protLoss$all_molecules_lost_c2)

p40<-ggplot()+geom_col(data=c2_protLoss, aes(reorder(Compartment_ss2,all_molecules_lost_c2,by=min),all_molecules_lost_c2/total_loss_cand_DIA*100),fill="#440154FF")+labs(x="", y= "Percentage Protein Copies Lost of Total Candidates Loss")+theme_classic()+theme(axis.text.x=element_text(angle=45,hjust=1),legend.position = "none")+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))

p41<-ggplot()+geom_col(data=c2_protLoss, aes(reorder(Compartment_ss2,percent_loss_c2,by=min),percent_loss_allProt),fill="#5DC863FF")+geom_col(data=c2_protLoss, aes(reorder(Compartment_ss2,percent_loss_c2,by=min),percent_loss_c2),fill="#440154FF")+geom_text(data=c2_protLoss,aes(x=reorder(Compartment_ss2,percent_loss_c2,by=min),y=percent_loss_allProt,label=paste(round(percent_loss_allProt,1),"%",sep="")),vjust=-1,color="black",size=5)+geom_text(data=c2_protLoss,aes(x=reorder(Compartment_ss2,percent_loss_c2,by=min),y=percent_loss_c2,label=paste(round(percent_loss_c2,1),"%",sep="")),vjust=-1,color="#440154FF",size=5)+labs(x="", y= "Percentage of Protein Molecules Lost")+theme_classic()+theme(axis.text.x=element_text(angle=45,hjust=1),legend.position = "none")+ylim(c(0,20))+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))


eating_plot <-cowplot::plot_grid(p40,p41,nrow=2,align = "hv")
eating_plot



# ggsave(eating_plot,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/supp9bc_DIA_ProteomeRuler.pdf",height=7,width = 7)


```

#### Based on Wis's numbers


```{r}

  
# list_compartments<- c("Cytosol","Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome","Cytosol")
list_compartments<- c("Nucleus","Endosome","Golgi.membrane.associated","Golgi.membrane","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  ,"Cytosol")

ALL_PRDIA<-proteome_ruler_compare2_locale%>%
  dplyr::ungroup()%>%
  dplyr::filter(!is.na(hek_protein_copy_number), Compartment_ss %in% list_compartments)%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarize(
         numberProtWithLoss = n(),
         total_molecules_compartment = sum(hek_protein_copy_number),
         avg_molecules_compartment = sum(hek_protein_copy_number)/n())

c2_calls_PRDIA<-proteome_ruler_compare2_locale%>%
  dplyr::ungroup()%>%
  dplyr::filter(!is.na(hek_protein_copy_number),accession %in% c2_proteins$accession, Compartment_ss %in% list_compartments,foldchange<0)%>%
  dplyr::mutate(controlstarve_control = 2^foldchange,
         delta_abundance = 1- controlstarve_control,
         final_loss = delta_abundance*hek_protein_copy_number)%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarize(avg_loss=sum(final_loss)/n(),
         all_molecules_lost = sum(final_loss),
         numberProtWithLoss = n(),
         total_molecules_compartment = sum(hek_protein_copy_number),
         avg_molecules_compartment = sum(hek_protein_copy_number)/n())



proteins_loss_PRDIA<-proteome_ruler_compare2_locale%>%
  dplyr::ungroup()%>%
  dplyr::filter(!is.na(hek_protein_copy_number), Compartment_ss %in% list_compartments,foldchange<0)%>%
  dplyr::mutate(controlstarve_control = 2^foldchange,
         delta_abundance = 1- controlstarve_control,
         final_loss = delta_abundance*hek_protein_copy_number)%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarize(avg_loss=sum(final_loss)/n(),
         all_molecules_lost = sum(final_loss),
         numberProtWithLoss = n(),
         total_molecules_compartment = sum(hek_protein_copy_number),
         avg_molecules_compartment = sum(hek_protein_copy_number)/n())

c2_protLoss_PRDIA<-dplyr::inner_join(c2_calls_PRDIA,proteins_loss_PRDIA,by="Compartment_ss",suffix=c("_c2","_allLoss"))

c2_protLoss_PRDIA<-dplyr::inner_join(c2_protLoss_PRDIA, ALL_PRDIA, by="Compartment_ss")


c2_protLoss2_PRDIA<-c2_protLoss_PRDIA%>%
  dplyr::mutate(Compartment_ss2= dplyr::if_else(stringr::str_detect(Compartment_ss,"associated"),"Golgi \n Associated",dplyr::if_else(stringr::str_detect(Compartment_ss,"Golgi.membrane"),"Golgi \n Membrane",dplyr::if_else(stringr::str_detect(Compartment_ss,"Plasma.Membrane"),"Plasma \n Membrane",dplyr::if_else(is.na(Compartment_ss),"Unannotated",Compartment_ss)))),
         Compartment_ss2= dplyr::if_else(is.na(Compartment_ss2),"Unannotated",Compartment_ss2),
         percent_loss_c2 = all_molecules_lost_c2 / total_molecules_compartment *100,
         percent_loss_allProt = all_molecules_lost_allLoss / total_molecules_compartment *100)



total_loss_cand_PRDIA<-sum(c2_protLoss2_PRDIA$all_molecules_lost_c2)


# write.csv(c2_protLoss2_PRDIA, "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/DataS8D_dia_Wis_summary.csv")

p40<-ggplot()+geom_col(data=c2_protLoss2_PRDIA, aes(reorder(Compartment_ss2,all_molecules_lost_c2,by=min),all_molecules_lost_c2/total_loss_cand_PRDIA*100),fill="#440154FF")+labs(x="", y= "Percentage Protein Copies Lost of Total Candidates Loss")+theme_classic()+theme(axis.text.x=element_text(angle=45,hjust=1),legend.position = "none")+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))

p41<-ggplot()+geom_col(data=c2_protLoss2_PRDIA, aes(reorder(Compartment_ss2,percent_loss_c2,by=min),percent_loss_allProt),fill="#5DC863FF")+geom_col(data=c2_protLoss2_PRDIA, aes(reorder(Compartment_ss2,percent_loss_c2,by=min),percent_loss_c2),fill="#440154FF")+
  geom_text(data=c2_protLoss2_PRDIA,aes(x=reorder(Compartment_ss2,percent_loss_c2,by=min),y=percent_loss_allProt,label=paste(round(percent_loss_allProt,1),"%",sep="")),vjust=-1,color="black",size=5)+
  geom_text(data=c2_protLoss2_PRDIA,aes(x=reorder(Compartment_ss2,percent_loss_c2,by=min),y=percent_loss_c2,label=paste(round(percent_loss_c2,1),"%",sep="")),vjust=-1,color="#440154FF",size=5)+labs(x="", y= "Percentage of Protein Molecules Lost")+theme_classic()+theme(axis.text.x=element_text(angle=45,hjust=1),legend.position = "none")+ylim(c(0,20))+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))


eating_plot <- cowplot::plot_grid(p40,p41,nrow=2,align = "hv")
eating_plot

# ggsave(eating_plot,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/supp9de_DIA_Wis_ProteomeRuler.pdf",height=7,width = 7)

```



### Scaled TMT results


```{r}
# tmt_results<- read.csv("C:/DIA-NN/1.8.1/E11_KH/TMT_FIP200resultsAA_precursorQuant.csv")

tmt_results<- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/HEK293_-aa_12h_control_fip200_yipf4.csv")

exp_design<- read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/shiny-design_Hek293-aa_control_FIP200KO_YIPF4KO.csv")

df2<-tmt_results%>%
      dplyr::select(Peptide,Protein.ID,PA.Gene.Symbol,PA.Annotation,Isolation.Specificity,Sum.Sn,
                    X126.Raw.Intensity,X127n.Raw.Intensity,X127c.Raw.Intensity,X128n.Raw.Intensity,
                    X128c.Raw.Intensity,X129n.Raw.Intensity,X129c.Raw.Intensity,X130n.Raw.Intensity,
                    X130c.Raw.Intensity,X131n.Raw.Intensity,X131c.Raw.Intensity,X132n.Raw.Intensity,
                    X132c.Raw.Intensity,X133n.Raw.Intensity,X133c.Raw.Intensity,X134n.Raw.Intensity,
                    Precursor.Intensity,Area)%>%
  dplyr::rename(Reference = Protein.ID,
                Gene.Symbol = PA.Gene.Symbol,
                Annotation = PA.Annotation)%>%
      dplyr::filter(Sum.Sn > 200 , Isolation.Specificity > 0.5)%>%
      dplyr::filter(str_detect(Reference,"contaminant")==F)%>%
      dplyr::distinct()%>%
      dplyr::group_by(Reference,Gene.Symbol,Annotation)%>%
      dplyr::mutate(numPep = n())%>%
      dplyr::filter(numPep > 1-1)%>%
      dplyr::ungroup()%>%
      dplyr::select(-Sum.Sn,-Isolation.Specificity,-numPep)%>%
      tidyr::unite("ProtID",Reference,Gene.Symbol,Annotation, sep="__X__")%>%
      tidyr::gather("channel","intensity",3:18)%>%
      dplyr::mutate(intensity = if_else(intensity == 0, 0.001,intensity))%>%
      dplyr::inner_join(.,exp_design,by="channel")%>%
      dplyr::filter(condition != "empty")%>%
      dplyr::mutate(cond_rep = paste(condition, replicate,sep="_"))


df3<-df2%>%
  dplyr::select(-Peptide)%>%
      dplyr::group_by(ProtID,condition,replicate,cond_rep,priority)%>%
      dplyr::summarise(intensity = sum(intensity))%>%
      dplyr::filter(str_detect(ProtID,"\\#\\#")==F)%>%
      dplyr::ungroup()

df3_MS1<-df2%>%
  dplyr::select(Peptide,ProtID,Precursor.Intensity,Area)%>%
  distinct()%>%
  dplyr::ungroup()%>%
  dplyr::select(-Peptide)%>%
  dplyr::group_by(ProtID)%>%
  dplyr::summarise(MS1_intensity = sum(Precursor.Intensity),
                   MS1_area = sum(Area))%>%
  dplyr::filter(str_detect(ProtID,"\\#\\#")==F)%>%
  dplyr::ungroup()





norm_sum2 <- df3%>%
        dplyr::ungroup()%>%
        dplyr::group_by(condition,cond_rep,priority)%>%
        dplyr::summarise(sum_int = sum(intensity))
    
    # df2$condition<-reorder(df2$condition,df2$priority,min)
    # df2$cond_rep<-reorder(df2$cond_rep,df2$priority,min)
    
    
    
med_med <- median(norm_sum2$sum_int)
max_val <- max(norm_sum2$sum_int)

norm_sum3<-norm_sum2%>%
  dplyr::mutate(correct_factor = med_med / sum_int,
                relative_intensity = sum_int / max_val)%>%
  dplyr::select(-sum_int)
    
    

df_final<-dplyr::full_join(df3, norm_sum3, by=c("condition","cond_rep","priority"))
df_final<-df_final%>%
  dplyr::mutate(norm_int = intensity * correct_factor,
         log2_int = log2(norm_int))%>%
  dplyr::ungroup()%>%
  dplyr::mutate(log2_int=if_else(log2_int<=0,0,log2_int))


df_final_ms1_init<-df_final%>%
  dplyr::left_join(.,df3_MS1, by="ProtID")%>%
  dplyr::select(ProtID,condition,replicate,cond_rep,norm_int,MS1_intensity,MS1_area)%>%
  dplyr::mutate(cond_wt = dplyr::if_else(condition == "0_control","yes","no"))


df_final_ms1_init_wt<-df_final_ms1_init%>%filter(cond_wt == "yes")%>%
  dplyr::ungroup()%>%
  dplyr::group_by(ProtID)%>%
  dplyr::summarise(wt_int = sum(norm_int),
            MS1_area  = unique(MS1_area),
            MS1_intensity = unique(MS1_intensity))


df_final_ms1_init_all<-df_final_ms1_init%>%
  dplyr::ungroup()%>%
  dplyr::group_by(ProtID)%>%
  dplyr::summarise(wt_all = sum(norm_int),
            MS1_area  = unique(MS1_area),
            MS1_intensity = unique(MS1_intensity))

annotated_uniprot<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/uniprot-compressed_true_download_true_fields_accession_2Creviewed_2C-2022.08.09-18.53.29.34.csv")

slim_annotated_uniprot<-annotated_uniprot%>%
  dplyr::select(From,Length,Mass,Sequence)%>%
  dplyr::rename(accession = From)
  

adjust_values <- dplyr::full_join(df_final_ms1_init_wt,df_final_ms1_init_all, by=c("ProtID" ,"MS1_area", "MS1_intensity") )


adjust_values<-adjust_values%>%
  dplyr::mutate(adj_norm_int = wt_int/wt_all,
         prot_adj_MS1_int = MS1_intensity *adj_norm_int,
         prot_adj_MS1_area = MS1_area *adj_norm_int)%>%
  tidyr::separate(ProtID,into=c("Reference","Gene.Symbol","Annotation"),sep="__X__")%>%
  tidyr::separate(Reference,into = c("type","accession","sub_gene"),sep="\\|")%>%
  dplyr::left_join(.,slim_annotated_uniprot, by="accession")


####
ss_organelle_list<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/ss_organelle_list2_wh_annotation_cytoAddedBasedGO.csv")

#tidy form annotations for localizations
ss_organelle_list<-ss_organelle_list%>%
  tidyr::gather("Compartment_ss","Gene.Symbol",1:16)%>%
  dplyr::filter(!is.na(Gene.Symbol), Gene.Symbol != "")

###add filter
# list_compartments<- c("Nucleus","Endosome","Golgi","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  ,"Cytosol")
list_compartments<- c("Nucleus","Endosome","Golgi.membrane.associated","Golgi.membrane","ER","Plasma.Membrane"   ,"Mitochondria","Lysosome","Peroxisome"  ,"Cytosol")

ss_organelle_list<-ss_organelle_list%>%
  dplyr::filter(Compartment_ss %in% list_compartments)

## Annotate the whole dataframe for organelles
adjust_values_ann<-dplyr::left_join(adjust_values,ss_organelle_list,by="Gene.Symbol")

adjust_values_ann<-adjust_values_ann%>%
  tidyr::unite("Reference",type,accession,sub_gene, sep="|")%>%
  dplyr::distinct()
  

### Import old fold changes
# kh_allX<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/result_files/HEK293_12h-AA_control_FIP200KO_YIPF4KO.csv")





kh_allX<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/HEK293-12h-AA.csv")%>%
  dplyr::select(Reference,Gene.Symbol,Annotation,log2FC_1_control_aa.0_control)
  

match_oldFC<-dplyr::left_join(adjust_values_ann, kh_allX ,by=c("Reference","Gene.Symbol","Annotation"))


# Histones <- c('H1FX',
# 'H2AC11',
# 'H2AFJ',
# "H2AFX",
# "H2AFY",
# "H2AFY2",
# "H2AZ1",
# "HIST1H1T",
# "HIST2H2AA3",
# "HIST2H2BC",
# "HIST2H2BF",
# "HIST2H3A",
# "HIST3H2BB",
# "H1-0",
# "H1-2",
# "H1-3",
# "H1-4",
# "H1-5"
# )

Histones<-c(
"H2AFY",
"H1-0",
"H2AZ1",
"H1-4",
"H2AFX",
"H1-5",
"H1-3",
"H1-2",
"HIST1H1T",
"H4C1",
"H3-3A",
"HIST2H2BF",
"HIST2H2AA3",
"HIST2H3A",
"HIST3H2BB",
"H1FX",
"H2AFY2")


histone_data<-match_oldFC%>%
  dplyr::filter(Gene.Symbol %in% Histones)

ms1_int_histones <- sum(histone_data$prot_adj_MS1_int)

ms1_area_histones <- sum(histone_data$prot_adj_MS1_area)


match_oldFC2<-match_oldFC%>%
  dplyr::mutate(prot_ruler_copyNum_TMT_int= prot_adj_MS1_int * (602214080000000000000000/Mass) * (0.00000000000685 / ms1_int_histones),
                prot_ruler_copyNum_TMT_area= prot_adj_MS1_area * (602214080000000000000000/Mass) * (0.00000000000685 / ms1_area_histones))

ms1_area_histones/sum(match_oldFC$prot_adj_MS1_area)
ms1_int_histones/sum(match_oldFC$prot_adj_MS1_int)

opencell<-read.csv("C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/PaperCode/opencell-protein-abundance.csv")

opencell<-opencell%>%
  dplyr::rename(Gene.Symbol = gene_name)

match_oldFC3<- dplyr::left_join(match_oldFC2,opencell, by="Gene.Symbol")

# write.csv(match_oldFC3%>%dplyr::mutate(candidate = dplyr::if_else(Reference %in% c2_proteins$Reference,"Candidate","NotCandidate")), "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/DataS8B_TMT_proteome_ruler_results.csv")

## correlation between published and the calculation here
corrplot_3<-ggplot(match_oldFC3,aes(log10(prot_ruler_copyNum_TMT_area),log10(hek_protein_copy_number) ))+geom_bin_2d(bins=100)+stat_cor(method="spearman",size=8)+theme_classic()+scale_fill_viridis_c()+labs(y="Wisniewski et al. Log10(Protein Copy Number/Cell WT)", x="MS1-scaled TMT Log10(Protein Copy Number/Cell WT)")+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))

corrplot_3

# corrplot_3<-ggplot(match_oldFC3,aes(log10(prot_ruler_copyNum_TMT_int),log10(hek_protein_copy_number) ))+geom_bin_2d(bins=100)+stat_cor(method="spearman",size=8)+theme_classic()+scale_fill_viridis_c()+labs(y="Wisniewski et al. Log10(Protein Copy Number/Cell WT)", x="MS1-scaled TMT Log10(Protein Copy Number/Cell WT)")+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))
# 
# corrplot_3

ggsave(corrplot_3,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/supp9I_CorrPlot_ScaleTMT_Wisniewski_.pdf",height=7,width = 7)

```

#### TMT-scaled MS1 numbers


```{r}
# write.csv(match_oldFC3,"C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/CARGO_Cellular_Autophagy_Regulation_GOlgiphagy/TMT_proteome_rulerResults.csv")

ALL_TMT<-match_oldFC3%>%
  dplyr::ungroup()%>%
  dplyr::filter(!is.na(prot_ruler_copyNum_TMT_area), Compartment_ss %in% list_compartments)%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarize(
         numberProtWithLoss = n(),
         total_molecules_compartment = sum(prot_ruler_copyNum_TMT_area),
         avg_molecules_compartment = sum(prot_ruler_copyNum_TMT_area)/n())

c2_calls_TMT<-match_oldFC3%>%
  dplyr::ungroup()%>%
  dplyr::filter(!is.na(prot_ruler_copyNum_TMT_area),Reference %in% c2_proteins$Reference, Compartment_ss %in% list_compartments,log2FC_1_control_aa.0_control<0)%>%
  dplyr::mutate(controlstarve_control = 2^log2FC_1_control_aa.0_control,
         delta_abundance = 1- controlstarve_control,
         final_loss = delta_abundance*prot_ruler_copyNum_TMT_area)%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarize(avg_loss=sum(final_loss)/n(),
         all_molecules_lost = sum(final_loss),
         numberProtWithLoss = n(),
         total_molecules_compartment = sum(prot_ruler_copyNum_TMT_area),
         avg_molecules_compartment = sum(prot_ruler_copyNum_TMT_area)/n())



proteins_loss_TMT<-match_oldFC3%>%
  dplyr::ungroup()%>%
  dplyr::filter(!is.na(prot_ruler_copyNum_TMT_area), Compartment_ss %in% list_compartments,log2FC_1_control_aa.0_control<0)%>%
  dplyr::mutate(controlstarve_control = 2^log2FC_1_control_aa.0_control,
         delta_abundance = 1- controlstarve_control,
         final_loss = delta_abundance*prot_ruler_copyNum_TMT_area)%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarize(avg_loss=sum(final_loss)/n(),
         all_molecules_lost = sum(final_loss),
         numberProtWithLoss = n(),
         total_molecules_compartment = sum(prot_ruler_copyNum_TMT_area),
         avg_molecules_compartment = sum(prot_ruler_copyNum_TMT_area)/n())

c2_protLoss_TMT<-dplyr::inner_join(c2_calls_TMT,proteins_loss_TMT,by="Compartment_ss",suffix=c("_c2","_allLoss"))

c2_protLoss_TMT<-dplyr::inner_join(c2_protLoss_TMT, ALL_TMT, by="Compartment_ss")


c2_protLoss_TMT<-c2_protLoss_TMT%>%
  dplyr::mutate(Compartment_ss2= dplyr::if_else(stringr::str_detect(Compartment_ss,"associated"),"Golgi \n Associated",dplyr::if_else(stringr::str_detect(Compartment_ss,"Golgi.membrane"),"Golgi \n Membrane",dplyr::if_else(stringr::str_detect(Compartment_ss,"Plasma.Membrane"),"Plasma \n Membrane",dplyr::if_else(is.na(Compartment_ss),"Unannotated",Compartment_ss)))),
         Compartment_ss2= dplyr::if_else(is.na(Compartment_ss2),"Unannotated",Compartment_ss2),
         percent_loss_c2 = all_molecules_lost_c2 / total_molecules_compartment *100,
         percent_loss_allProt = all_molecules_lost_allLoss / total_molecules_compartment *100)


# write.csv(c2_protLoss_TMT, "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/DataS8E_TMT_summary.csv")

total_loss_cand_TMT<-sum(c2_protLoss_TMT$all_molecules_lost_c2)


p40<-ggplot()+geom_col(data=c2_protLoss_TMT, aes(reorder(Compartment_ss2,all_molecules_lost_c2,by=min),all_molecules_lost_c2/total_loss_cand_TMT*100),fill="#440154FF")+labs(x="", y= "Percentage Protein Copies Lost of Total Candidates Loss")+theme_classic()+theme(axis.text.x=element_text(angle=45,hjust=1),legend.position = "none")+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))

p41<-ggplot()+geom_col(data=c2_protLoss_TMT, aes(reorder(Compartment_ss2,percent_loss_c2,by=min),percent_loss_allProt),fill="#5DC863FF")+geom_col(data=c2_protLoss_TMT, aes(reorder(Compartment_ss2,percent_loss_c2,by=min),percent_loss_c2),fill="#440154FF")+geom_text(data=c2_protLoss_TMT,aes(x=reorder(Compartment_ss2,percent_loss_c2,by=min),y=percent_loss_allProt,label=paste(round(percent_loss_allProt,1),"%",sep="")),vjust=-1,color="black",size=5)+geom_text(data=c2_protLoss_TMT,aes(x=reorder(Compartment_ss2,percent_loss_c2,by=min),y=percent_loss_c2,label=paste(round(percent_loss_c2,1),"%",sep="")),vjust=-1,color="#440154FF",size=5)+labs(x="", y= "Percentage of Protein Molecules Lost")+theme_classic()+theme(axis.text.x=element_text(angle=45,hjust=1),legend.position = "none")+ylim(c(0,20))+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))


eating_plot <- cowplot::plot_grid(p40,p41,nrow=2,align = "hv")
eating_plot

# ggsave(eating_plot,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/fig6ef_TMTscaled_ProteomeRuler.pdf",height=7,width = 7)
```






#### Wis's  append


```{r}
ALL_PRTMT<-match_oldFC3%>%
  dplyr::ungroup()%>%
  dplyr::filter(!is.na(hek_protein_copy_number), Compartment_ss %in% list_compartments)%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarize(
         numberProtWithLoss = n(),
         total_molecules_compartment = sum(hek_protein_copy_number),
         avg_molecules_compartment = sum(hek_protein_copy_number)/n())

c2_calls_PRTMT<-match_oldFC3%>%
  dplyr::ungroup()%>%
  dplyr::filter(!is.na(hek_protein_copy_number),Reference %in% c2_proteins$Reference, Compartment_ss %in% list_compartments,log2FC_1_control_aa.0_control<0)%>%
  dplyr::mutate(controlstarve_control = 2^log2FC_1_control_aa.0_control,
         delta_abundance = 1- controlstarve_control,
         final_loss = delta_abundance*hek_protein_copy_number)%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarize(avg_loss=sum(final_loss)/n(),
         all_molecules_lost = sum(final_loss),
         numberProtWithLoss = n(),
         total_molecules_compartment = sum(hek_protein_copy_number),
         avg_molecules_compartment = sum(hek_protein_copy_number)/n())


proteins_loss_PRTMT<-match_oldFC3%>%
  dplyr::ungroup()%>%
  dplyr::filter(!is.na(hek_protein_copy_number), Compartment_ss %in% list_compartments,log2FC_1_control_aa.0_control<0)%>%
  dplyr::mutate(controlstarve_control = 2^log2FC_1_control_aa.0_control,
         delta_abundance = 1- controlstarve_control,
         final_loss = delta_abundance*hek_protein_copy_number)%>%
  dplyr::group_by(Compartment_ss)%>%
  dplyr::summarize(avg_loss=sum(final_loss)/n(),
         all_molecules_lost = sum(final_loss),
         numberProtWithLoss = n(),
         total_molecules_compartment = sum(hek_protein_copy_number),
         avg_molecules_compartment = sum(hek_protein_copy_number)/n())

c2_protLoss_PRTMT<-dplyr::inner_join(c2_calls_PRTMT,proteins_loss_PRTMT,by="Compartment_ss",suffix=c("_c2","_allLoss"))

c2_protLoss_PRTMT<-dplyr::inner_join(c2_protLoss_PRTMT, ALL_PRTMT, by="Compartment_ss")


c2_protLoss_PRTMT<-c2_protLoss_PRTMT%>%
  dplyr::mutate(Compartment_ss2= dplyr::if_else(stringr::str_detect(Compartment_ss,"associated"),"Golgi \n Associated",dplyr::if_else(stringr::str_detect(Compartment_ss,"Golgi.membrane"),"Golgi \n Membrane",dplyr::if_else(stringr::str_detect(Compartment_ss,"Plasma.Membrane"),"Plasma \n Membrane",dplyr::if_else(is.na(Compartment_ss),"Unannotated",Compartment_ss)))),
         Compartment_ss2= dplyr::if_else(is.na(Compartment_ss2),"Unannotated",Compartment_ss2),
         percent_loss_c2 = all_molecules_lost_c2 / total_molecules_compartment *100,
         percent_loss_allProt = all_molecules_lost_allLoss / total_molecules_compartment *100)


total_loss_cand_PRTMT<-sum(c2_protLoss_PRTMT$all_molecules_lost_c2)

# write.csv(c2_protLoss_PRTMT, "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/DataS8F_TMT_Wis_summary.csv")

p40<-ggplot()+geom_col(data=c2_protLoss_PRTMT, aes(reorder(Compartment_ss2,all_molecules_lost_c2,by=min),all_molecules_lost_c2/total_loss_cand_PRTMT*100),fill="#440154FF")+labs(x="", y= "Percentage Protein Copies Lost of Total Candidates Loss")+theme_classic()+theme(axis.text.x=element_text(angle=45,hjust=1),legend.position = "none")+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))

p41<-ggplot()+geom_col(data=c2_protLoss_PRTMT, aes(reorder(Compartment_ss2,percent_loss_c2,by=min),percent_loss_allProt),fill="#5DC863FF")+geom_col(data=c2_protLoss_PRTMT, aes(reorder(Compartment_ss2,percent_loss_c2,by=min),percent_loss_c2),fill="#440154FF")+geom_text(data=c2_protLoss_PRTMT,aes(x=reorder(Compartment_ss2,percent_loss_c2,by=min),y=percent_loss_allProt,label=paste(round(percent_loss_allProt,1),"%",sep="")),vjust=-1,color="black",size=5)+geom_text(data=c2_protLoss_PRTMT,aes(x=reorder(Compartment_ss2,percent_loss_c2,by=min),y=percent_loss_c2,label=paste(round(percent_loss_c2,1),"%",sep="")),vjust=-1,color="#440154FF",size=5)+labs(x="", y= "Percentage of Protein Molecules Lost")+theme_classic()+theme(axis.text.x=element_text(angle=45,hjust=1),legend.position = "none")+ylim(c(0,20))+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))


eating_plot <- cowplot::plot_grid(p40,p41,nrow=2,align = "hv")
eating_plot

# ggsave(eating_plot,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/supp9gh_TMTscaled_Wis_ProteomeRuler.pdf",height=7,width = 7)
```

#### Rank plot


```{r}

match_oldFC4<-match_oldFC3%>%
  dplyr::arrange(dplyr::desc(prot_ruler_copyNum_TMT_area))%>%
  tibble::rownames_to_column("Rank")%>%
  dplyr::mutate(Rank = as.numeric(as.character(Rank)),
                prot_ruler_copyNum_TMT_area_AA = if_else(log2FC_1_control_aa.0_control < 0 ,prot_ruler_copyNum_TMT_area * 2^log2FC_1_control_aa.0_control ,-10))



rankplot_fig6d<-ggplot()+
  geom_point(data=match_oldFC4%>%dplyr::filter(Reference %in% c2_proteins$Reference)%>%dplyr::mutate(Compartment_ss = stringr::str_replace_all(Compartment_ss,"\\."," ")), aes(Rank,log10(prot_ruler_copyNum_TMT_area)),size=0.35)+
  geom_point(data=match_oldFC4%>%dplyr::filter(Reference %in% c2_proteins$Reference,Compartment_ss != "Golgi.membrane.associated",Compartment_ss != "Golgi.membrane")%>%dplyr::mutate(Compartment_ss = stringr::str_replace_all(Compartment_ss,"\\."," ")), aes(Rank,log10(prot_ruler_copyNum_TMT_area_AA),color=Compartment_ss),size=0.35)+
  geom_point(data=match_oldFC4%>%dplyr::filter(Reference %in% c2_proteins$Reference,Compartment_ss == "Golgi.membrane")%>%dplyr::mutate(Compartment_ss = stringr::str_replace_all(Compartment_ss,"\\."," ")), aes(Rank,log10(prot_ruler_copyNum_TMT_area_AA),color=Compartment_ss),size=1)+
  geom_point(data=match_oldFC4%>%dplyr::filter(Reference %in% c2_proteins$Reference,Compartment_ss == "Golgi.membrane.associated")%>%dplyr::mutate(Compartment_ss = stringr::str_replace_all(Compartment_ss,"\\."," ")), aes(Rank,log10(prot_ruler_copyNum_TMT_area_AA),color=Compartment_ss),size=1)+theme_classic()+theme(legend.title = element_blank(),legend.position = "right")+labs(x="Protein Rank (WT)", y=bquote("Log10(Protein Copy Number/Cell WT)"))+ guides(colour = guide_legend(override.aes = list(size=2)))+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))

rankplot_fig6d

ggsave(rankplot_fig6d,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/fig6d_TMTscaled_ProteomeRuler_rankPlot_3pt5by3p5pt7.pdf",height=3.5,width = 7.05)


rankplot_suppfig8c<-ggplot()+
  geom_point(data=match_oldFC4%>%dplyr::filter(Reference %in% c2_proteins$Reference,Compartment_ss %in% c("Golgi.membrane","Golgi.membrane.associated","ER","Cytosol") )%>%dplyr::mutate(Compartment_ss = stringr::str_replace_all(Compartment_ss,"\\."," ")), aes(Rank,log10(prot_ruler_copyNum_TMT_area)),size=1)+
  geom_point(data=match_oldFC4%>%dplyr::filter(Reference %in% c2_proteins$Reference,Compartment_ss %in% c("Golgi.membrane", "Golgi.membrane.associated","ER","Cytosol"))%>%dplyr::mutate(Compartment_ss = stringr::str_replace_all(Compartment_ss,"\\."," ")), aes(Rank,log10(prot_ruler_copyNum_TMT_area_AA),color=Compartment_ss),size=1)+
  facet_wrap(.~Compartment_ss,nrow=1)+theme_classic()+theme(legend.title = element_blank(),legend.position = "right")+labs(x="Protein Rank (WT)", y=bquote("Log10(Protein Copy Number/Cell WT)"))+ guides(colour = guide_legend(override.aes = list(size=2)))+scale_color_viridis_d(end=0.8)+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))

rankplot_suppfig8c

ggsave(rankplot_suppfig8c,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/Suppfig8c_TMTscaled_ProteomeRuler_rankPlot_Golgi_ER_Cytosol.pdf",height=5,width = 16)

```



### Correlation DIA to MS1-scaled TMT

```{r}
dia_tmt<-dplyr::full_join(match_oldFC3%>%dplyr::mutate(Reference2 = Reference)%>%tidyr::separate(Reference2, into = c("type","accession","gene_name_2"),sep="\\|")
, proteome_ruler_compare2_locale,by="accession")

corrplot_4<-ggplot(dia_tmt,aes(log10(prot_ruler_copyNum_TMT_area),log10(prot_ruler_copyNum_ut) ))+geom_bin_2d(bins=100)+stat_cor(method="spearman",size=8)+theme_classic()+scale_fill_viridis_c()+labs(x="MS1-scaled TMT Log10(Protein Copy Number/Cell WT)", y="DIA Log10(Protein Copy Number/Cell WT)")+theme(axis.title = element_text(size=20),axis.text = element_text(size=18))

corrplot_4

ggsave(corrplot_4,filename = "C:/Harper/Side_analysis/Kelsey_shiny/Golgiphagy_final/figures_PA/supp9J_CorrPlot_ScaleTMT_DIA_7by10.pdf",height=7,width = 7)

```



